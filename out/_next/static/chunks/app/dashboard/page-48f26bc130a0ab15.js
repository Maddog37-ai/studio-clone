(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{4884:(e,t,s)=>{"use strict";s.d(t,{bL:()=>N,zi:()=>j});var a=s(12115),l=s(85185),r=s(6101),i=s(46081),d=s(5845),n=s(45503),o=s(11275),c=s(63655),u=s(95155),m="Switch",[h,p]=(0,i.A)(m),[x,f]=h(m),g=a.forwardRef((e,t)=>{let{__scopeSwitch:s,name:i,checked:n,defaultChecked:o,required:h,disabled:p,value:f="on",onCheckedChange:g,form:v,...b}=e,[N,j]=a.useState(null),k=(0,r.s)(t,e=>j(e)),C=a.useRef(!1),A=!N||v||!!N.closest("form"),[I,T]=(0,d.i)({prop:n,defaultProp:null!=o&&o,onChange:g,caller:m});return(0,u.jsxs)(x,{scope:s,checked:I,disabled:p,children:[(0,u.jsx)(c.sG.button,{type:"button",role:"switch","aria-checked":I,"aria-required":h,"data-state":y(I),"data-disabled":p?"":void 0,disabled:p,value:f,...b,ref:k,onClick:(0,l.m)(e.onClick,e=>{T(e=>!e),A&&(C.current=e.isPropagationStopped(),C.current||e.stopPropagation())})}),A&&(0,u.jsx)(w,{control:N,bubbles:!C.current,name:i,value:f,checked:I,required:h,disabled:p,form:v,style:{transform:"translateX(-100%)"}})]})});g.displayName=m;var v="SwitchThumb",b=a.forwardRef((e,t)=>{let{__scopeSwitch:s,...a}=e,l=f(v,s);return(0,u.jsx)(c.sG.span,{"data-state":y(l.checked),"data-disabled":l.disabled?"":void 0,...a,ref:t})});b.displayName=v;var w=a.forwardRef((e,t)=>{let{__scopeSwitch:s,control:l,checked:i,bubbles:d=!0,...c}=e,m=a.useRef(null),h=(0,r.s)(m,t),p=(0,n.Z)(i),x=(0,o.X)(l);return a.useEffect(()=>{let e=m.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(p!==i&&t){let s=new Event("click",{bubbles:d});t.call(e,i),e.dispatchEvent(s)}},[p,i,d]),(0,u.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...c,tabIndex:-1,ref:h,style:{...c.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function y(e){return e?"checked":"unchecked"}w.displayName="SwitchBubbleInput";var N=g,j=b},17313:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>o,av:()=>c,j7:()=>n,tU:()=>d});var a=s(95155),l=s(12115),r=s(60704),i=s(59434);let d=r.bL,n=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(r.B8,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...l})});n.displayName=r.B8.displayName;let o=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(r.l9,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...l})});o.displayName=r.l9.displayName;let c=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(r.UC,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...l})});c.displayName=r.UC.displayName},45687:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ea});var a=s(95155),l=s(12115),r=s(98030),i=s(91689),d=s(56104),n=s(35317),o=s(22715),c=s(66695),u=s(91394),m=s(40157);let h=(0,m.A)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var p=s(50172);let x=(0,m.A)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),f=(0,m.A)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),g=(0,m.A)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);var v=s(73926),b=s(80333),w=s(85057),y=s(30285),N=s(54165),j=s(26126),k=s(45731),C=s(91721),A=s(19637),I=s(10518);let T=(0,m.A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var S=s(31554);function D(e){let{isOpen:t,onClose:s,profile:r}=e,{toast:d}=(0,i.dj)(),[n,o]=(0,l.useState)(null),c=r.name||r.displayName||"Unknown User",m=r.email,h=r.phone||r.phoneNumber,p=r.role||"User",x=r.avatarUrl||"https://ui-avatars.com/api/?name=".concat(c.replace(/\s+/g,"+"),"&background=random&color=fff"),f=async(e,t)=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(e),o(t),d({title:"Copied!",description:"".concat(t," copied to clipboard")}),setTimeout(()=>o(null),2e3);else{let s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();try{document.execCommand("copy"),o(t),d({title:"Copied!",description:"".concat(t," copied to clipboard")}),setTimeout(()=>o(null),2e3)}catch(e){throw Error("Copy operation not supported")}finally{document.body.removeChild(s)}}}catch(e){d({title:"Copy Failed",description:"Could not copy to clipboard. Please copy manually.",variant:"destructive"})}};return(0,a.jsx)(N.lG,{open:t,onOpenChange:e=>!e&&s(),children:(0,a.jsxs)(N.Cf,{className:"sm:max-w-md dark:card-glass dark:glow-turquoise",children:[(0,a.jsx)(N.c7,{children:(0,a.jsxs)(N.L3,{className:"font-headline flex items-center justify-center",children:[(0,a.jsx)(C.A,{className:"mr-2 h-6 w-6 text-primary"}),"Team Member Profile"]})}),(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-6 py-4",children:[(0,a.jsxs)(u.eu,{className:"h-20 w-20 border-2 border-primary shadow-lg",children:[(0,a.jsx)(u.BK,{src:x,alt:c}),(0,a.jsx)(u.q5,{className:"bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-800 dark:to-blue-900 text-blue-900 dark:text-blue-100 font-bold text-lg",children:c.substring(0,2).toUpperCase()})]}),(0,a.jsxs)("div",{className:"text-center space-y-2",children:[(0,a.jsx)("h3",{className:"text-xl font-bold font-headline",children:c}),(0,a.jsxs)(j.E,{variant:(e=>{switch(e.toLowerCase()){case"manager":return"default";case"closer":default:return"secondary";case"setter":return"outline"}})(p),className:"flex items-center gap-1",children:["manager"===p.toLowerCase()?(0,a.jsx)(k.A,{className:"h-3 w-3"}):(0,a.jsx)(C.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{className:"capitalize",children:p})]})]}),(0,a.jsxs)("div",{className:"w-full space-y-3",children:[m&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 dark:bg-slate-800/40 dark:border dark:border-turquoise/20 rounded-lg dark:glow-turquoise",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[(0,a.jsx)(A.A,{className:"h-4 w-4 text-muted-foreground dark:text-turquoise/80 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground dark:text-gray-400 uppercase tracking-wide",children:"Email"}),(0,a.jsx)("p",{className:"font-medium truncate dark:text-gray-200",children:m})]})]}),(0,a.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0 dark:hover:bg-turquoise/10",onClick:()=>f(m,"Email"),children:"Email"===n?(0,a.jsx)(I.A,{className:"h-4 w-4 text-green-600 dark:text-turquoise"}):(0,a.jsx)(T,{className:"h-4 w-4 dark:text-gray-300"})})]}),h&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 dark:bg-slate-800/40 dark:border dark:border-cyan/20 rounded-lg dark:glow-cyan",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 text-muted-foreground dark:text-cyan/80 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground dark:text-gray-400 uppercase tracking-wide",children:"Phone"}),(0,a.jsx)("p",{className:"font-medium dark:text-gray-200",children:h})]})]}),(0,a.jsx)(y.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0 dark:hover:bg-cyan/10",onClick:()=>f(h,"Phone"),children:"Phone"===n?(0,a.jsx)(I.A,{className:"h-4 w-4 text-green-600 dark:text-cyan"}):(0,a.jsx)(T,{className:"h-4 w-4 dark:text-gray-300"})})]}),!m&&!h&&(0,a.jsx)("div",{className:"text-center py-4",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No contact information available"})})]})]})]})})}function L(e){var t,s;let{closer:o,allowInteractiveToggle:m=!0,onMove:N,canMoveUp:j,canMoveDown:k,showMoveControls:C,isUpdatingOrder:A,assignedLeadName:I,onLeadClick:T,onDispositionChange:S,showDispositionSelector:L=!1,currentLeadStatus:E,leadId:U,position:O}=e,{user:M}=(0,r.A)(),{toast:P}=(0,i.dj)(),[R,_]=(0,l.useState)(!1),[F,q]=(0,l.useState)(!1),G="accepted"===E,V="scheduled"===E,z="waiting_assignment"===E,B=M&&("manager"===M.role||"admin"===M.role||"closer"===M.role&&M.uid===o.uid),W=B&&m&&!I,Q=async e=>{if(console.log("\uD83D\uDD25 CloserCard - Status toggle clicked:",{closerName:o.name,closerUid:o.uid,currentStatus:o.status,newStatus:e?"On Duty":"Off Duty",userRole:null==M?void 0:M.role}),!M||!B||I)return;_(!0);let t=e?"On Duty":"Off Duty";try{let e=(0,n.doc)(d.db,"closers",o.uid);await (0,n.updateDoc)(e,{status:t}),P({title:"Status Updated",description:"".concat(o.name||"Closer","'s status set to ").concat(t,".")})}catch(e){P({title:"Update Failed",description:"Could not update ".concat(o.name||"Closer","'s status."),variant:"destructive"})}finally{_(!1)}},$="On Duty"===o.status,Z=o.avatarUrl||"https://ui-avatars.com/api/?name=".concat((o.name||"User").replace(/\s+/g,"+"),"&background=random&color=fff"),K=o.avatarUrl?void 0:(null==(s=o.name)||null==(t=s.split(" ")[0])?void 0:t.toLowerCase())||"person";return(0,a.jsxs)(c.Zp,{className:"shadow-xl hover:shadow-2xl transition-all duration-300 border-0 hover:scale-[1.02] shadow-slate-400/20 dark:shadow-slate-900/40 bg-gradient-to-r from-blue-100/70 via-white to-blue-100/70 dark:card-glass dark:glow-turquoise dark:from-gray-900 dark:via-blue-950/20 dark:to-gray-900",children:[(0,a.jsxs)(c.Wu,{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[O&&(0,a.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center w-6 h-6 text-white text-xs font-bold rounded-full shadow-md bg-gradient-to-br from-blue-600 to-blue-700",children:O}),(0,a.jsxs)(u.eu,{className:"h-10 w-10 border-2 shadow-md flex-shrink-0 cursor-pointer transition-colors border-blue-200 dark:border-blue-700 hover:border-blue-300 dark:hover:border-blue-600",onClick:()=>{console.log("\uD83D\uDD25 CloserCard - Avatar clicked:",{closerName:o.name,closerUid:o.uid,userRole:null==M?void 0:M.role}),q(!0)},children:[(0,a.jsx)(u.BK,{src:Z,alt:o.name||"User","data-ai-hint":K}),(0,a.jsx)(u.q5,{className:"font-bold text-xs bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-800 dark:to-blue-900 text-blue-900 dark:text-blue-100",children:o.name?o.name.substring(0,2).toUpperCase():"N/A"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 pr-2",children:[(0,a.jsx)("div",{className:"flex items-center gap-1",children:(0,a.jsx)("p",{className:"text-xs font-bold font-headline text-gray-900 dark:text-gray-100 truncate",children:o.name||"Unnamed Closer"})}),I?(0,a.jsxs)("div",{className:"flex items-center text-xs mt-1 ".concat(T?"cursor-pointer hover:text-blue-600 dark:hover:text-blue-200 transition-colors":""," text-blue-700 dark:text-blue-300"),onClick:()=>{T&&(console.log("\uD83D\uDD25 CloserCard - Lead assignment clicked:",{closerName:o.name,leadName:I,userRole:null==M?void 0:M.role}),T())},role:T?"button":void 0,tabIndex:T?0:void 0,onKeyDown:T?e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),T())}:void 0,children:[(0,a.jsx)(h,{className:"mr-1 h-3 w-3 flex-shrink-0"}),(0,a.jsxs)("span",{className:"font-medium truncate text-xs",children:["Working on: ",I]})]}):W?(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsx)(b.d,{id:"status-toggle-".concat(o.uid),checked:$,onCheckedChange:Q,disabled:R||A,"aria-label":$?"Set ".concat(o.name||"Closer"," to Off Duty"):"Set ".concat(o.name||"Closer"," to On Duty"),className:"scale-75"}),(0,a.jsx)(w.J,{htmlFor:"status-toggle-".concat(o.uid),className:"text-xs font-medium ".concat($?"text-green-700 dark:text-green-400":"text-red-600 dark:text-red-400"),children:R?(0,a.jsx)(p.A,{className:"h-3 w-3 animate-spin"}):$?"Available":"Off Duty"})]}):(0,a.jsxs)("div",{className:"flex items-center text-xs mt-1 ".concat($?"text-green-700 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[$?(0,a.jsx)(x,{className:"mr-1 h-3 w-3"}):(0,a.jsx)(f,{className:"mr-1 h-3 w-3"}),(0,a.jsx)("span",{className:"font-medium",children:$?"Available":"Off Duty"})]})]})]}),(z||V||G)&&S||C&&N&&!I?(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-1 mt-2 pt-2 border-t border-blue-100 dark:border-blue-800",children:[(z||V)&&((null==M?void 0:M.role)==="manager"||(null==M?void 0:M.role)==="admin")&&S&&(0,a.jsx)(y.$,{size:"sm",className:"h-6 px-2 text-xs bg-green-600 hover:bg-green-700 text-white border border-green-800",onClick:()=>{console.log("\uD83D\uDD25 CloserCard - Accept & Start button clicked:",{closerName:o.name,leadStatus:E,leadId:U,userRole:null==M?void 0:M.role}),S("in_process"),P({title:"Lead Accepted",description:"Lead has been accepted and is now in process."})},children:"Accept & Start"}),V&&(null==M?void 0:M.role)==="closer"&&S&&(0,a.jsx)(y.$,{size:"sm",className:"h-6 px-2 text-xs bg-green-600 hover:bg-green-700 text-white border border-green-800",onClick:()=>{console.log("\uD83D\uDD25 CloserCard - Accept Job button clicked:",{closerName:o.name,leadStatus:E,leadId:U,userRole:null==M?void 0:M.role}),S("accepted"),P({title:"Job Accepted",description:"Job has been accepted."})},children:"Accept Job"}),G&&(null==M?void 0:M.role)==="closer"&&S&&(0,a.jsx)(y.$,{size:"sm",className:"h-6 px-2 text-xs bg-blue-600 hover:bg-blue-700 text-white border border-blue-800",onClick:()=>{console.log("\uD83D\uDD25 CloserCard - Start Working button clicked:",{closerName:o.name,leadStatus:E,leadId:U,userRole:null==M?void 0:M.role}),S("in_process"),P({title:"Lead Status Updated",description:"You are now actively working on this lead."})},children:"Start Working"}),C&&N&&!I&&(0,a.jsxs)("div",{className:"flex items-center space-x-1 ml-2",children:[(0,a.jsx)(y.$,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>N("up"),disabled:!j||R||A,children:(0,a.jsx)(g,{className:"h-3 w-3"})}),(0,a.jsx)(y.$,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>N("down"),disabled:!k||R||A,children:(0,a.jsx)(v.A,{className:"h-3 w-3"})})]})]}):null]}),(0,a.jsx)(D,{isOpen:F,onClose:()=>q(!1),profile:{uid:o.uid,name:o.name||"Unnamed Closer",email:null,phone:o.phone||null,avatarUrl:o.avatarUrl||"https://ui-avatars.com/api/?name=".concat((o.name||"User").replace(/\s+/g,"+"),"&background=random&color=fff"),role:"closer"}})]})}var E=s(40207);let U=(0,m.A)("Ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);var O=s(66424);let M={};function P(){let{user:e}=(0,r.A)(),{toast:t}=(0,i.dj)(),[s,u]=(0,l.useState)([]),[m,h]=(0,l.useState)(!0),[x,f]=(0,l.useState)(!0),[g,v]=(0,l.useState)([]),[b,w]=(0,l.useState)(null),[y,j]=(0,l.useState)(!1),[k,C]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(!e||!e.teamId){f(!1),v([]);return}f(!0);let s=(0,n.query)((0,n.collection)(d.db,"closers"),(0,n.where)("teamId","==",e.teamId)),a=(0,n.aQ)(s,e=>{let t=e.docs.map(e=>({uid:e.id,...e.data()}));console.log("Team closers loaded:",t.length,"closers"),t.forEach(e=>{console.log("Closer:",{uid:e.uid,name:e.name,teamId:e.teamId})}),v(t),f(!1)},e=>{console.error("Error loading team closers:",e),t({title:"Error",description:"Failed to load team closers: ".concat(e.message||"Unknown error",". Please refresh the page."),variant:"destructive"}),f(!1)});return()=>a()},[e,t]),(0,l.useEffect)(()=>{if(!e||!e.teamId||x){e&&e.teamId||h(!1),x&&u([]);return}h(!0);let s=(0,n.query)((0,n.collection)(d.db,"leads"),(0,n.where)("teamId","==",e.teamId),(0,n.My)("createdAt","desc"),(0,n.AB)(100)),a=(0,n.aQ)(s,t=>{console.log("Raw leads query results:",t.docs.length,"documents"),console.log("Current user:",{uid:e.uid,role:e.role,teamId:e.teamId}),t.docs.forEach(e=>{let t=e.data();console.log("Lead found:",{id:e.id,customerName:t.customerName,assignedCloserId:t.assignedCloserId,status:t.status,teamId:t.teamId})});let s=t.docs.filter(t=>{let s=t.data();if("closer"===e.role){if(e.uid in M){let a=M[e.uid]||[],l=(s.assignedCloserId===e.uid||a.includes(s.assignedCloserId||""))&&["waiting_assignment","accepted","in_process"].includes(s.status);return console.log("Special permissions filter for lead ".concat(t.id,":"),{assignedCloserId:s.assignedCloserId,userUid:e.uid,status:s.status,allowedCloserIds:a,canSeeThisLead:l}),l}{let a=s.assignedCloserId===e.uid&&["waiting_assignment","accepted","in_process"].includes(s.status);return console.log("Closer filter for lead ".concat(t.id,":"),{assignedCloserId:s.assignedCloserId,userUid:e.uid,status:s.status,isMatch:a}),a}}if("setter"===e.role){let a="in_process"===s.status;return console.log("Setter filter for lead ".concat(t.id,":"),{assignedCloserId:s.assignedCloserId,status:s.status,setterId:s.setterId,userUid:e.uid,isMatch:a}),a}if("manager"===e.role||"admin"===e.role){let e=s.assignedCloserId&&["waiting_assignment","accepted","in_process"].includes(s.status);return console.log("Manager filter for lead ".concat(t.id,":"),{assignedCloserId:s.assignedCloserId,status:s.status,isMatch:e}),e}return!1}),a="manager"===e.role||"admin"===e.role?20:"setter"===e.role?15:10;console.log("Filtered leads:",(s=s.slice(0,a)).length,"matches");let l=s.map(e=>{let t={id:e.id,...e.data()},s=g.find(e=>e.uid===t.assignedCloserId);return console.log("Lead ".concat(e.id," assigned closer:"),s?{uid:s.uid,name:s.name}:"not found"),{lead:t,closer:s}});console.log("Final display items:",l.length),u(l),h(!1)},e=>{console.error("Error loading in-process leads:",e),t({title:"Error",description:"Failed to load in-process leads: ".concat(e.message||"Unknown error",". Please refresh the page."),variant:"destructive"}),u([]),h(!1)});return()=>a()},[e,g,x,t]),(0,l.useEffect)(()=>{if(!(null==e?void 0:e.teamId)||0===g.length)return;let t=g.find(e=>e.name.toLowerCase().includes("richard")&&e.name.toLowerCase().includes("niger")),s=g.find(e=>e.name.toLowerCase().includes("marcelo")&&e.name.toLowerCase().includes("guerra"));t&&s?(console.log("Setting up special visibility permissions:",{marceloUid:s.uid,richardUid:t.uid}),M[s.uid]=[t.uid],console.log("Special permissions configured:",M)):console.log("Richard Niger or Marcelo Guerra not found in team closers:",{richardFound:!!t,marceloFound:!!s,allClosers:g.map(e=>e.name)})},[null==e?void 0:e.teamId,g]),null==e||e.role;let A=m||x;(null==e?void 0:e.role)==="closer"&&e.uid in M&&M[e.uid];let I=async s=>{console.log("\uD83D\uDD25 InProcessLeads - Lead clicked:",{leadId:s.id,customerName:s.customerName,leadStatus:s.status,assignedCloserId:s.assignedCloserId,userRole:null==e?void 0:e.role,userUid:null==e?void 0:e.uid});let a=(null==e?void 0:e.role)==="closer"&&e.uid in M;if((null==e?void 0:e.role)==="manager"||(null==e?void 0:e.role)==="admin"||(null==e?void 0:e.role)==="closer"&&e.uid===s.assignedCloserId||a&&(M[e.uid]||[]).includes(s.assignedCloserId||"")){if((null==e?void 0:e.role)==="closer"&&e.uid===s.assignedCloserId&&("waiting_assignment"===s.status||"scheduled"===s.status)&&!s.acceptedAt)try{let e=(await (0,d.EF)({leadId:s.id})).data;e.success&&!e.alreadyAccepted&&t({title:"Job Accepted",description:"You have accepted the job for ".concat(s.customerName,". The setter has been notified.")})}catch(e){console.error("Error accepting job:",e),t({title:"Acceptance Failed",description:"Failed to accept the job. Please try again.",variant:"destructive"});return}w(s),j(!0)}else t({title:"Access Denied",description:"You can only view details for leads assigned to you.",variant:"destructive"})},T=async(s,a)=>{if(console.log("\uD83D\uDD25 InProcessLeads - Disposition change triggered:",{leadId:s,newStatus:a,userRole:null==e?void 0:e.role,userUid:null==e?void 0:e.uid}),!e||"closer"!==e.role&&"manager"!==e.role&&"admin"!==e.role)return void t({title:"Access Denied",description:"Only closers and managers can update lead disposition.",variant:"destructive"});try{let l=(0,n.doc)(d.db,"leads",s),r=await (0,n.getDoc)(l);if(!r.exists())throw Error("Lead not found");let i=r.data();("manager"===e.role||"admin"===e.role)&&("waiting_assignment"===i.status||"scheduled"===i.status||"accepted"===i.status)&&["sold","no_sale","canceled","rescheduled","credit_fail"].includes(a)?"in_process"!==i.status&&(await (0,n.updateDoc)(l,{status:"in_process",updatedAt:(0,n.serverTimestamp)()}),await new Promise(e=>setTimeout(e,100))):"closer"===e.role&&"accepted"===i.status&&["sold","no_sale","canceled","rescheduled","credit_fail"].includes(a)&&(await (0,n.updateDoc)(l,{status:"in_process",updatedAt:(0,n.serverTimestamp)()}),await new Promise(e=>setTimeout(e,100)));let o={status:a,updatedAt:(0,n.serverTimestamp)(),dispositionUpdatedBy:e.uid,dispositionUpdatedAt:(0,n.serverTimestamp)()};("manager"===e.role||"admin"===e.role)&&"waiting_assignment"===a&&(o.assignedCloserId=null,o.assignedCloserName=null),await (0,n.updateDoc)(l,o),t({title:"Disposition Updated",description:"Lead status updated to ".concat(a.replace("_"," "),".")})}catch(e){console.error("Error updating lead disposition:",e),t({title:"Update Failed",description:"Failed to update lead disposition. Please try again.",variant:"destructive"})}};return(0,a.jsxs)(c.Zp,{className:"h-full flex flex-col bg-white dark:bg-slate-900 shadow-lg hover:shadow-xl transition-all duration-200 border-0 ring-1 ring-slate-200 dark:ring-slate-800",children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-4 px-6 pt-6",children:[(0,a.jsxs)(c.ZB,{className:"text-xl sm:text-2xl font-bold font-headline flex items-center text-slate-900 dark:text-slate-100",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg mr-3",children:(0,a.jsx)(E.A,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600 dark:text-blue-400"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{children:"In Process Leads"}),(0,a.jsx)("span",{className:"text-sm font-normal text-muted-foreground",children:"Active customer interactions"})]})]}),A&&(0,a.jsx)(p.A,{className:"h-5 w-5 animate-spin text-muted-foreground"})]}),(0,a.jsx)(c.Wu,{className:"flex-grow overflow-hidden px-6 pb-6",children:A?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(p.A,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading leads..."})]})}):0===s.length?(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center text-center py-12",children:[(0,a.jsx)("div",{className:"p-4 bg-slate-100 dark:bg-slate-800 rounded-full mb-4",children:(0,a.jsx)(U,{className:"h-8 w-8 text-muted-foreground"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"All Quiet"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm max-w-xs",children:"No leads are currently being processed. New leads will appear here when closers start working on them."})]}):(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(O.F,{className:"h-full",children:(0,a.jsx)("div",{className:"space-y-4 pr-2",children:s.map((t,s)=>{let{lead:l,closer:r}=t,i=(null==e?void 0:e.role)==="manager"||(null==e?void 0:e.role)==="admin"||(null==e?void 0:e.role)==="closer"&&("in_process"===l.status||"accepted"===l.status);return(0,a.jsx)("div",{children:r&&(0,a.jsx)(L,{closer:r,assignedLeadName:l.customerName,allowInteractiveToggle:!1,onLeadClick:()=>I(l),onDispositionChange:e=>T(l.id,e),showDispositionSelector:i,currentLeadStatus:l.status,leadId:l.id,position:s+1})},l.id)})})})})}),(0,a.jsx)(N.lG,{open:y,onOpenChange:j,children:(0,a.jsxs)(N.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(N.c7,{children:(0,a.jsx)(N.L3,{children:"Lead Details"})}),b&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(o.A,{lead:b,context:"in-process"})})]})})]})}window.addSpecialVisibilityPermission=function(e,t){M[e]||(M[e]=[]),M[e].includes(t)||M[e].push(t),console.log("Added special permission: ".concat(e," can now see leads for ").concat(t))};var R=s(50286);function _(e){let{isOpen:t,onClose:s}=e,{user:o}=(0,r.A)(),{toast:c}=(0,i.dj)(),[u,m]=(0,l.useState)([]),[h,x]=(0,l.useState)(!0),[f,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(!t||!o||!o.teamId||"manager"!==o.role&&"admin"!==o.role){x(!1),m([]);return}x(!0);let e=(0,n.query)((0,n.collection)(d.db,"closers"),(0,n.where)("teamId","==",o.teamId),(0,n.My)("name","asc")),s=(0,n.aQ)(e,e=>{let t=e.docs.map(e=>{let t=e.data();return{uid:e.id,name:t.name,status:t.status,teamId:t.teamId,role:t.role,avatarUrl:t.avatarUrl,phone:t.phone,lineupOrder:t.lineupOrder}});(t=t.map((e,t)=>({...e,lineupOrder:"number"==typeof e.lineupOrder?e.lineupOrder:(t+1)*1e5}))).sort((e,t)=>{let s=e.lineupOrder,a=t.lineupOrder;return s!==a?s-a:e.name.localeCompare(t.name)}),m(t),x(!1)},e=>{c({title:"Error",description:"Failed to load closer information. Please try again.",variant:"destructive"}),x(!1)});return()=>s()},[t,o]);let v=async(e,t)=>{g(!0);let s=u.findIndex(t=>t.uid===e);if(-1===s){c({title:"Error",description:"Closer not found.",variant:"destructive"}),g(!1);return}let a=-1;if("up"===t&&s>0?a=s-1:"down"===t&&s<u.length-1&&(a=s+1),-1===a)return void g(!1);let l=u[s],r=u[a],i=(0,n.wP)(d.db),o=l.lineupOrder,m=r.lineupOrder,h=(0,n.doc)(d.db,"closers",l.uid);i.update(h,{lineupOrder:m});let p=(0,n.doc)(d.db,"closers",r.uid);i.update(p,{lineupOrder:o});try{await i.commit(),c({title:"Lineup Updated",description:"".concat(l.name," moved.")})}catch(e){c({title:"Update Failed",description:"Could not update lineup order.",variant:"destructive"})}finally{g(!1)}};return t?(0,a.jsx)(N.lG,{open:t,onOpenChange:e=>{e||s()},children:(0,a.jsxs)(N.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(N.c7,{children:[(0,a.jsxs)(N.L3,{className:"font-headline flex items-center justify-center",children:[(0,a.jsx)(R.A,{className:"mr-2 h-6 w-6 text-primary"}),"Manage Closer Status & Lineup"]}),(0,a.jsx)(N.rr,{className:"text-center",children:"View all team closers, manage their duty status, and reorder the lineup."})]}),(0,a.jsx)("div",{className:"py-4",children:h?(0,a.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,a.jsx)(p.A,{className:"h-8 w-8 animate-spin text-primary"})}):0===u.length?(0,a.jsx)("div",{className:"flex h-40 items-center justify-center",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"No closers found for this team."})}):(0,a.jsx)(O.F,{className:"h-[calc(60vh)] max-h-[400px] pr-3",children:(0,a.jsx)("div",{className:"space-y-3",children:u.map((e,t)=>(0,a.jsx)(L,{closer:e,allowInteractiveToggle:!0,showMoveControls:(null==o?void 0:o.role)==="manager"||(null==o?void 0:o.role)==="admin",canMoveUp:t>0,canMoveDown:t<u.length-1,onMove:t=>v(e.uid,t),isUpdatingOrder:f},e.uid))})})})]})}):null}function F(){let{user:e}=(0,r.A)(),{toast:t}=(0,i.dj)(),[s,o]=(0,l.useState)([]),[u,m]=(0,l.useState)([]),[h,x]=(0,l.useState)(!0),[f,g]=(0,l.useState)(new Set),[v,b]=(0,l.useState)(!0),[w,y]=(0,l.useState)(!1),N=(null==e?void 0:e.role)==="manager"||(null==e?void 0:e.role)==="admin",j=(null==e?void 0:e.role)==="closer";(0,l.useEffect)(()=>{if(!(null==e?void 0:e.teamId)){g(new Set),b(!1);return}b(!0);let s=(0,n.query)((0,n.collection)(d.db,"leads"),(0,n.where)("teamId","==",e.teamId),(0,n.where)("status","in",["waiting_assignment","scheduled","accepted","in_process"])),a=(0,n.aQ)(s,e=>{let t=new Set;e.forEach(e=>{let s=e.data();s.assignedCloserId&&t.add(s.assignedCloserId)}),g(t),b(!1)},e=>{t({title:"Error",description:"Failed to load assigned closers. Please refresh the page.",variant:"destructive"}),g(new Set),b(!1)});return()=>a()},[null==e?void 0:e.teamId,t]),(0,l.useEffect)(()=>{if(!(null==e?void 0:e.teamId)){o([]),m([]),x(!1);return}if(v){o([]),m([]),x(!0);return}x(!0);let s=(0,n.query)((0,n.collection)(d.db,"closers"),(0,n.where)("teamId","==",e.teamId),(0,n.where)("status","==","On Duty"),(0,n.My)("name","asc")),a=(0,n.aQ)(s,e=>{let t=e.docs.map(e=>{let t=e.data();return{uid:e.id,name:t.name,status:t.status,teamId:t.teamId,role:t.role,avatarUrl:t.avatarUrl,phone:t.phone,lineupOrder:t.lineupOrder}});if(t.some(e=>"Ryan Madden"===e.name)){let e=t.find(e=>"Ryan Madden"===e.name);console.log("Ryan Madden status:",{isOnDuty:(null==e?void 0:e.status)==="On Duty",uid:null==e?void 0:e.uid,hasAssignedLead:f.has((null==e?void 0:e.uid)||""),assignedCloserIds:Array.from(f)})}let s=t.filter(e=>!f.has(e.uid)).map((e,t)=>({...e,lineupOrder:"number"==typeof e.lineupOrder?e.lineupOrder:(t+1)*1e5})).sort((e,t)=>{let s=e.lineupOrder||999999,a=t.lineupOrder||999999;return s!==a?s-a:e.name.localeCompare(t.name)}),a=t.map((e,t)=>({...e,lineupOrder:"number"==typeof e.lineupOrder?e.lineupOrder:(t+1)*1e5})).sort((e,t)=>{let s=e.lineupOrder||999999,a=t.lineupOrder||999999;return s!==a?s-a:e.name.localeCompare(t.name)});o(s),m(a),x(!1)},e=>{t({title:"Error",description:"Failed to load closer lineup. Please refresh the page.",variant:"destructive"}),o([]),m([]),x(!1)});return()=>a()},[null==e?void 0:e.teamId,f,v,t]);let k=v||h,{closers:C,emptyTitle:A,emptyDescription:I,titleSuffix:T}=e&&e.role?j?{closers:u,emptyTitle:"No On Duty Closers",emptyDescription:"No closers are currently on duty.",titleSuffix:"On duty team members"}:{closers:s,emptyTitle:"No Available Closers",emptyDescription:"All closers are currently off duty or assigned to leads.",titleSuffix:"Available team members"}:{closers:[],emptyTitle:"Loading...",emptyDescription:"Please wait while we load your data.",titleSuffix:"Loading"};return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.Zp,{className:"h-full flex flex-col bg-white dark:bg-slate-900 shadow-lg hover:shadow-xl transition-all duration-200 border-0 ring-1 ring-slate-200 dark:ring-slate-800 dark:card-glass dark:glow-cyan",children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-4 px-6 pt-6",children:[(0,a.jsxs)(c.ZB,{className:"text-xl sm:text-2xl font-bold font-headline flex items-center text-slate-900 dark:text-slate-100",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg mr-3 ".concat(N?"cursor-pointer hover:bg-blue-200 dark:hover:bg-blue-800/50 transition-colors":""),onClick:N?()=>{console.log("\uD83D\uDD25 CloserLineup - Card header clicked for manager tools:",{userRole:null==e?void 0:e.role,canManageClosers:N,modalWillOpen:N}),N&&y(!0)}:void 0,children:(0,a.jsx)(R.A,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600 dark:text-blue-400"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{children:"Closer Lineup"}),(0,a.jsx)("span",{className:"text-sm font-normal text-muted-foreground",children:N?"Click icon to manage • "+T:T})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:k&&(0,a.jsx)(p.A,{className:"h-5 w-5 animate-spin text-muted-foreground"})})]}),(0,a.jsx)(c.Wu,{className:"flex-grow overflow-hidden px-6 pb-6",children:0!==C.length||k?(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(O.F,{className:"h-full",children:(0,a.jsx)("div",{className:"space-y-4 pr-2",children:C.map((t,s)=>{let l=t.uid===(null==e?void 0:e.uid),r=f.has(t.uid);return(0,a.jsx)("div",{className:l?"ring-2 ring-blue-400 dark:ring-blue-500 rounded-lg":"",children:(0,a.jsx)(L,{closer:t,allowInteractiveToggle:!1,position:s+1,assignedLeadName:r?"Working on lead":void 0})},t.uid)})})})}):(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center text-center py-12",children:[(0,a.jsx)("div",{className:"p-4 bg-slate-100 dark:bg-slate-800 rounded-full mb-4",children:(0,a.jsx)(R.A,{className:"h-8 w-8 text-muted-foreground"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:A}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm max-w-xs",children:I}),e&&!e.teamId&&(0,a.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-950/50 px-3 py-1 rounded-md mt-2",children:"Error: User missing team assignment"})]})})]}),(0,a.jsx)(_,{isOpen:w,onClose:()=>y(!1)})]}):(0,a.jsx)(c.Zp,{className:"h-full flex flex-col bg-white dark:bg-slate-900 shadow-lg hover:shadow-xl transition-all duration-200 border-0 ring-1 ring-slate-200 dark:ring-slate-800 dark:card-glass dark:glow-cyan",children:(0,a.jsx)(c.Wu,{className:"flex-grow overflow-hidden px-6 pb-6",children:(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center text-center py-12",children:[(0,a.jsx)(p.A,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm mt-2",children:"Loading..."})]})})})}var q=s(70831),G=s(83013),V=s(76959),z=s(44598);function B(e){return(0,V.r)(e,(0,z.A)(e))}var W=s(63482),Q=s(80644),$=s(51920),Z=s(12543),K=s(19968),H=s(37648);function J(e){let{scheduledLeads:t,loading:s}=e,[r,i]=(0,l.useState)(new Date);console.log("\uD83D\uDCC5 ScheduledLeadsCalendar received ".concat(t.length," leads:"),t);let d=t.find(e=>e.customerName.toLowerCase().includes("prince")||e.customerName.toLowerCase().includes("vegeta"));d?console.log("\uD83E\uDD66 Prince Vegeta found in calendar:",d):console.log("❌ Prince Vegeta not found in calendar leads");let n=(0,l.useMemo)(()=>{let e=new Date;return Array.from({length:14},(t,s)=>(0,q.f)(e,s))},[]),c=(0,l.useMemo)(()=>{let e=new Map;return t.forEach(t=>{if(t.scheduledAppointmentTime){let s=t.scheduledAppointmentTime.toDate(),a=(0,G.GP)(s,"yyyy-MM-dd");e.has(a)||e.set(a,[]);let l=e.get(a);l&&l.push(t)}}),e.forEach(e=>{e.sort((e,t)=>{var s,a;return((null==(s=e.scheduledAppointmentTime)?void 0:s.toDate().getTime())||0)-((null==(a=t.scheduledAppointmentTime)?void 0:a.toDate().getTime())||0)})}),e},[t]),u=(0,G.GP)(r,"yyyy-MM-dd"),m=c.get(u)||[],h=!(0,V.r)(r,n[0]),p=!(0,V.r)(r,n[n.length-1]);return s?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)($.A,{className:"h-8 w-8 animate-pulse text-primary mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading calendar..."})]})}):(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3 p-2 bg-muted/30 rounded-lg",children:[(0,a.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>{let e=n.findIndex(e=>(0,V.r)(e,r));e>0&&i(n[e-1])},disabled:!h,className:"h-7 w-7 p-0 sm:h-8 sm:w-8",children:(0,a.jsx)(Z.A,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"font-semibold text-xs sm:text-sm",children:B(r)?"Today":(0,G.GP)(r,"EEEE")}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground hidden sm:block",children:(0,G.GP)(r,"MMM d, yyyy")}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground sm:hidden",children:(0,G.GP)(r,"MMM d")})]}),(0,a.jsx)(y.$,{variant:"ghost",size:"sm",onClick:()=>{let e=n.findIndex(e=>(0,V.r)(e,r));e<n.length-1&&i(n[e+1])},disabled:!p,className:"h-7 w-7 p-0 sm:h-8 sm:w-8",children:(0,a.jsx)(K.A,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]}),(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)(O.F,{className:"w-full whitespace-nowrap",children:(0,a.jsx)("div",{className:"flex space-x-1 sm:space-x-2 pb-2",children:n.map(e=>{var t;let s=(0,G.GP)(e,"yyyy-MM-dd"),l=(null==(t=c.get(s))?void 0:t.length)||0,d=(0,V.r)(e,r),n=(0,W.Y)(e,(0,Q.o)(new Date))&&!B(e);return(0,a.jsxs)(y.$,{variant:d?"default":"outline",size:"sm",onClick:()=>i(e),className:"\n                    flex-shrink-0 flex flex-col items-center p-1.5 sm:p-2 h-auto min-w-[50px] sm:min-w-[60px]\n                    ".concat(n?"opacity-60":"","\n                    ").concat(d?"ring-2 ring-primary ring-offset-1":"","\n                  "),children:[(0,a.jsx)("span",{className:"text-xs font-medium leading-tight",children:B(e)?"Today":(0,G.GP)(e,"EEE")}),(0,a.jsx)("span",{className:"text-sm font-bold leading-tight",children:(0,G.GP)(e,"d")}),l>0&&(0,a.jsx)(j.E,{variant:"secondary",className:"text-xs px-1 py-0 h-3 min-w-[12px] mt-0.5",children:l})]},s)})})})}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:0===m.length?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(H.A,{className:"h-6 w-6 sm:h-8 sm:w-8 text-muted-foreground mx-auto mb-2"}),(0,a.jsxs)("p",{className:"text-sm sm:text-base text-muted-foreground",children:["No appointments for"," ",(0,a.jsx)("span",{className:"hidden sm:inline",children:(0,G.GP)(r,"MMM d")}),(0,a.jsx)("span",{className:"sm:hidden",children:"today"})]})]})}):(0,a.jsx)(O.F,{className:"h-full pr-2 sm:pr-4",children:(0,a.jsx)("div",{className:"space-y-2 sm:space-y-3",children:m.map(e=>(0,a.jsxs)("div",{className:"border-l-2 sm:border-l-4 border-primary/20 pl-2 sm:pl-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 mb-1 sm:mb-2",children:[(0,a.jsx)(H.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:e.scheduledAppointmentTime&&(0,G.GP)(e.scheduledAppointmentTime.toDate(),"h:mm a")})]}),(0,a.jsx)(o.A,{lead:e,context:"queue-scheduled"})]},e.id))})})})]})}var X=s(17313);let Y=(0,m.A)("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);var ee=s(763);function et(e){if(!e||"string"!=typeof e)return null;let t=new Date(e);if(!isNaN(t.getTime()))return t;let s=e.match(/(\w+\s\d{1,2},\s\d{4})\s(?:at)\s(\d{1,2}:\d{2}:\d{2}\s[AP]M)/i);if(s){let e=s[1],a=s[2];if(!isNaN((t=new Date("".concat(e," ").concat(a))).getTime()))return t}return null}function es(){let{user:e}=(0,r.A)(),{toast:t}=(0,i.dj)(),[s,u]=(0,l.useState)([]),[m,h]=(0,l.useState)([]),[x,f]=(0,l.useState)(!0),[g,v]=(0,l.useState)(!0),[b,w]=(0,l.useState)(new Set),[y,N]=(0,l.useState)([]),[j,k]=(0,l.useState)(!0),[C,A]=(0,l.useState)(new Set);return(0,l.useEffect)(()=>{if(!e||!e.teamId){f(!1),u([]);return}f(!0);let s=(0,n.query)((0,n.collection)(d.db,"leads"),(0,n.where)("teamId","==",e.teamId),(0,n.where)("status","==","waiting_assignment"),(0,n.My)("createdAt","asc")),a=(0,n.aQ)(s,e=>{u(e.docs.map(e=>{let t=e.data(),s=null;if(t.submissionTime){if(t.submissionTime instanceof n.Dc)s=t.submissionTime;else if("string"==typeof t.submissionTime){let e=et(t.submissionTime);e&&(s=n.Dc.fromDate(e))}}else t.createdAt instanceof n.Dc&&(s=t.createdAt);return{id:e.id,customerName:t.clientName||t.customerName||"Unknown Customer",customerPhone:t.phone||t.customerPhone||"N/A",address:t.address,status:t.status,teamId:t.teamId,dispatchType:t.type||t.dispatchType||"immediate",assignedCloserId:t.assignedCloserId||t.assignedCloser||null,assignedCloserName:t.assignedCloserName||null,createdAt:s,updatedAt:t.updatedAt instanceof n.Dc?t.updatedAt:(0,n.serverTimestamp)(),dispositionNotes:t.dispositionNotes||"",scheduledAppointmentTime:t.scheduledAppointmentTime instanceof n.Dc?t.scheduledAppointmentTime:t.scheduledTime instanceof n.Dc?t.scheduledTime:null,setterId:t.setterId||null,setterName:t.setterName||null,setterLocation:t.setterLocation||null,setterVerified:t.setterVerified||!1,verifiedAt:t.verifiedAt||null,verifiedBy:t.verifiedBy||null,photoUrls:t.photoUrls||[]}}).filter(e=>!e.assignedCloserId)),f(!1)},e=>{t({title:"Error",description:"Failed to load waiting leads. Please refresh the page.",variant:"destructive"}),f(!1)});return()=>a()},[e,t]),(0,l.useEffect)(()=>{if(!e||!e.teamId){v(!1),h([]);return}v(!0);let s=(0,n.query)((0,n.collection)(d.db,"leads"),(0,n.where)("teamId","==",e.teamId),(0,n.where)("status","in",["rescheduled","scheduled"]),(0,n.My)("scheduledAppointmentTime","asc")),a=(0,n.aQ)(s,async e=>{h(e.docs.map(e=>{let t=e.data(),s=null;if(t.submissionTime){if(t.submissionTime instanceof n.Dc)s=t.submissionTime;else if("string"==typeof t.submissionTime){let e=et(t.submissionTime);e&&(s=n.Dc.fromDate(e))}}else t.createdAt instanceof n.Dc&&(s=t.createdAt);return{id:e.id,customerName:t.clientName||t.customerName||"Unknown Customer",customerPhone:t.phone||t.customerPhone||"N/A",address:t.address,status:t.status,teamId:t.teamId,dispatchType:t.type||t.dispatchType||"immediate",assignedCloserId:t.assignedCloserId||t.assignedCloser||null,assignedCloserName:t.assignedCloserName||null,createdAt:s,updatedAt:t.updatedAt instanceof n.Dc?t.updatedAt:(0,n.serverTimestamp)(),dispositionNotes:t.dispositionNotes||"",scheduledAppointmentTime:t.scheduledAppointmentTime instanceof n.Dc?t.scheduledAppointmentTime:t.scheduledTime instanceof n.Dc?t.scheduledTime:null,setterId:t.setterId||null,setterName:t.setterName||null,setterLocation:t.setterLocation||null,photoUrls:t.photoUrls||[]}})),v(!1);let s=new Date,a=(0,n.wP)(d.db),l=(0,n.wP)(d.db),r=0,i=0;if(e.docs.forEach(e=>{let t={id:e.id,...e.data()},o=e.data().scheduledAppointmentTime;if(o instanceof n.Dc&&("rescheduled"===t.status||"scheduled"===t.status)&&!b.has(t.id)){let e=o.toDate(),c=e.getTime()-s.getTime(),u=s.getTime()-e.getTime();if(u>=6e5&&!t.setterVerified){let e=(0,n.doc)(d.db,"leads",t.id);l.update(e,{status:"canceled",dispositionNotes:"Automatically canceled - not verified within 10 minutes of scheduled time",updatedAt:(0,n.serverTimestamp)()}),w(e=>new Set(e).add(t.id)),i++}else if(u>=9e5){let e=(0,n.doc)(d.db,"leads",t.id);l.update(e,{status:"expired",dispositionNotes:"Appointment expired - 15 minutes past scheduled time",updatedAt:(0,n.serverTimestamp)()}),w(e=>new Set(e).add(t.id)),i++}else if(c<=27e5&&!0===t.setterVerified){let e=(0,n.doc)(d.db,"leads",t.id);a.update(e,{status:"waiting_assignment",updatedAt:(0,n.serverTimestamp)()}),w(e=>new Set(e).add(t.id)),r++}}}),i>0)try{await l.commit(),t({title:"Unverified Leads Removed",description:"".concat(i," unverified lead(s) past their scheduled time were automatically canceled."),variant:"destructive"})}catch(e){console.error("Error removing unverified leads:",e),t({title:"Removal Failed",description:"Could not remove unverified leads automatically.",variant:"destructive"})}if(r>0)try{await a.commit(),t({title:"Verified Leads Updated",description:"".concat(r," verified lead(s) moved to waiting list for assignment.")})}catch(l){t({title:"Update Failed",description:"Could not move verified leads automatically.",variant:"destructive"});let a=e.docs.filter(e=>{let t=e.data(),a=t.scheduledAppointmentTime;return a instanceof n.Dc&&("rescheduled"===t.status||"scheduled"===t.status)&&a.toDate().getTime()-s.getTime()<=27e5&&!0===t.setterVerified&&b.has(e.id)}).map(e=>e.id);w(e=>{let t=new Set(e);return a.forEach(e=>t.delete(e)),t})}},e=>{t({title:"Error",description:"Failed to load scheduled leads. Please refresh the page.",variant:"destructive"}),v(!1)});return()=>a()},[e,t,b]),(0,l.useEffect)(()=>{if(!(null==e?void 0:e.teamId)){A(new Set),k(!1);return}k(!0);let t=(0,n.query)((0,n.collection)(d.db,"leads"),(0,n.where)("teamId","==",e.teamId),(0,n.where)("status","in",["waiting_assignment","scheduled","accepted","in_process"])),s=(0,n.aQ)(t,e=>{let t=new Set;e.forEach(e=>{let s=e.data();s.assignedCloserId&&t.add(s.assignedCloserId)}),A(t)},e=>{console.error("Failed to load assigned closers for auto-assignment:",e)});return()=>s()},[null==e?void 0:e.teamId]),(0,l.useEffect)(()=>{if(!(null==e?void 0:e.teamId)){N([]),k(!1);return}let t=(0,n.query)((0,n.collection)(d.db,"closers"),(0,n.where)("teamId","==",e.teamId),(0,n.where)("status","==","On Duty"),(0,n.My)("name","asc")),s=(0,n.aQ)(t,e=>{N(e.docs.map(e=>{let t=e.data();return{uid:e.id,name:t.name,status:t.status,teamId:t.teamId,role:t.role,avatarUrl:t.avatarUrl,phone:t.phone,lineupOrder:t.lineupOrder}}).filter(e=>!C.has(e.uid)).map((e,t)=>({...e,lineupOrder:"number"==typeof e.lineupOrder?e.lineupOrder:(t+1)*1e5})).sort((e,t)=>{var s,a;let l=null!=(s=e.lineupOrder)?s:((e.lineupOrder||0)+1)*1e5,r=null!=(a=t.lineupOrder)?a:((t.lineupOrder||0)+1)*1e5;return l!==r?l-r:e.name.localeCompare(t.name)})),k(!1)},e=>{console.error("Failed to load available closers for auto-assignment:",e),N([]),k(!1)});return()=>s()},[null==e?void 0:e.teamId,C]),(0,l.useEffect)(()=>{if(x||j||!(null==e?void 0:e.teamId)||0===s.length||0===y.length)return;let a=setTimeout(async()=>{try{let e=(0,n.wP)(d.db),a=0,l=[...s].filter(e=>!e.assignedCloserId&&"waiting_assignment"===e.status).sort((e,t)=>e.createdAt&&t.createdAt?e.createdAt.toMillis()-t.createdAt.toMillis():0),r=Math.min(l.length,y.length);for(let t=0;t<r;t++){let s=l[t],r=y[t];if(s&&r){let t=(0,n.doc)(d.db,"leads",s.id);e.update(t,{status:"waiting_assignment",assignedCloserId:r.uid,assignedCloserName:r.name,updatedAt:(0,n.serverTimestamp)()}),a++}}a>0&&(await e.commit(),t({title:"Leads Assigned",description:"".concat(a," lead(s) automatically assigned to available closers.")}))}catch(e){console.error("Failed to auto-assign leads:",e),t({title:"Assignment Failed",description:"Could not automatically assign leads to closers.",variant:"destructive"})}},1e3);return()=>clearTimeout(a)},[s,y,x,j,null==e?void 0:e.teamId,t]),(0,a.jsxs)(c.Zp,{className:"h-full flex flex-col bg-white dark:bg-slate-900 shadow-lg hover:shadow-xl transition-all duration-200 border-0 ring-1 ring-slate-200 dark:ring-slate-800",children:[(0,a.jsxs)(c.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-4 px-6 pt-6",children:[(0,a.jsxs)(c.ZB,{className:"text-xl sm:text-2xl font-bold font-headline flex items-center text-slate-900 dark:text-slate-100",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg mr-3",children:(0,a.jsx)(Y,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600 dark:text-blue-400"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{children:"Lead Queues"}),(0,a.jsx)("span",{className:"text-sm font-normal text-muted-foreground",children:"Waiting & scheduled leads"})]})]}),(x||g)&&(0,a.jsx)(p.A,{className:"h-5 w-5 animate-spin text-muted-foreground"})]}),(0,a.jsx)(c.Wu,{className:"flex-grow overflow-hidden px-6 pb-6",children:(0,a.jsxs)(X.tU,{defaultValue:"waiting",className:"flex flex-col h-full",children:[(0,a.jsxs)(X.j7,{className:"grid w-full grid-cols-2 mb-4 h-11 bg-slate-100 dark:bg-slate-800 rounded-lg p-1",children:[(0,a.jsxs)(X.Xi,{value:"waiting",className:"h-9 text-sm font-medium rounded-md transition-all data-[state=active]:bg-white data-[state=active]:shadow-sm dark:data-[state=active]:bg-slate-700",children:[(0,a.jsx)(Y,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Waiting List"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Waiting"})]}),(0,a.jsxs)(X.Xi,{value:"scheduled",className:"h-9 text-sm font-medium rounded-md transition-all data-[state=active]:bg-white data-[state=active]:shadow-sm dark:data-[state=active]:bg-slate-700",children:[(0,a.jsx)(ee.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Scheduled"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Scheduled"})]})]}),(0,a.jsx)(X.av,{value:"waiting",className:"flex-grow overflow-hidden",children:x?(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(p.A,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading waiting leads..."})]})}):0===s.length?(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center text-center py-12",children:[(0,a.jsx)("div",{className:"p-4 bg-slate-100 dark:bg-slate-800 rounded-full mb-4",children:(0,a.jsx)(Y,{className:"h-8 w-8 text-muted-foreground"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Queue Empty"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm max-w-xs",children:"No leads are currently waiting for assignment. New leads will appear here automatically."})]}):(0,a.jsx)(O.F,{className:"h-[280px] sm:h-[320px] md:h-[380px] lg:h-[420px] xl:h-[480px]",children:(0,a.jsx)("div",{className:"space-y-4 pr-2",children:s.map(e=>(0,a.jsx)(o.A,{lead:e,context:"queue-waiting"},e.id))})})}),(0,a.jsx)(X.av,{value:"scheduled",className:"flex-grow overflow-hidden",children:(0,a.jsx)(J,{scheduledLeads:m,loading:g})})]})})]})}function ea(){let{user:e}=(0,r.A)();return e?(0,a.jsx)("div",{className:"min-h-[calc(100vh-4rem)] p-6 space-y-6 sm:space-y-8",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:gap-8 md:grid-cols-2 lg:grid-cols-5 h-[calc(100vh-12rem)]",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 flex flex-col gap-6 min-h-0",children:[(0,a.jsx)("div",{className:"flex-1 min-h-0",children:(0,a.jsx)(P,{})}),(0,a.jsx)("div",{className:"flex-1 min-h-0",children:(0,a.jsx)(F,{})})]}),(0,a.jsx)("div",{className:"lg:col-span-3 flex flex-col min-h-0",children:(0,a.jsx)("div",{className:"h-full",children:(0,a.jsx)(es,{})})})]})}):null}},45731:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},50629:(e,t,s)=>{Promise.resolve().then(s.bind(s,45687))},60704:(e,t,s)=>{"use strict";s.d(t,{B8:()=>S,UC:()=>L,bL:()=>T,l9:()=>D});var a=s(12115),l=s(85185),r=s(46081),i=s(89196),d=s(28905),n=s(63655),o=s(94315),c=s(5845),u=s(61285),m=s(95155),h="Tabs",[p,x]=(0,r.A)(h,[i.RG]),f=(0,i.RG)(),[g,v]=p(h),b=a.forwardRef((e,t)=>{let{__scopeTabs:s,value:a,onValueChange:l,defaultValue:r,orientation:i="horizontal",dir:d,activationMode:p="automatic",...x}=e,f=(0,o.jH)(d),[v,b]=(0,c.i)({prop:a,onChange:l,defaultProp:null!=r?r:"",caller:h});return(0,m.jsx)(g,{scope:s,baseId:(0,u.B)(),value:v,onValueChange:b,orientation:i,dir:f,activationMode:p,children:(0,m.jsx)(n.sG.div,{dir:f,"data-orientation":i,...x,ref:t})})});b.displayName=h;var w="TabsList",y=a.forwardRef((e,t)=>{let{__scopeTabs:s,loop:a=!0,...l}=e,r=v(w,s),d=f(s);return(0,m.jsx)(i.bL,{asChild:!0,...d,orientation:r.orientation,dir:r.dir,loop:a,children:(0,m.jsx)(n.sG.div,{role:"tablist","aria-orientation":r.orientation,...l,ref:t})})});y.displayName=w;var N="TabsTrigger",j=a.forwardRef((e,t)=>{let{__scopeTabs:s,value:a,disabled:r=!1,...d}=e,o=v(N,s),c=f(s),u=A(o.baseId,a),h=I(o.baseId,a),p=a===o.value;return(0,m.jsx)(i.q7,{asChild:!0,...c,focusable:!r,active:p,children:(0,m.jsx)(n.sG.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":h,"data-state":p?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:u,...d,ref:t,onMouseDown:(0,l.m)(e.onMouseDown,e=>{r||0!==e.button||!1!==e.ctrlKey?e.preventDefault():o.onValueChange(a)}),onKeyDown:(0,l.m)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&o.onValueChange(a)}),onFocus:(0,l.m)(e.onFocus,()=>{let e="manual"!==o.activationMode;p||r||!e||o.onValueChange(a)})})})});j.displayName=N;var k="TabsContent",C=a.forwardRef((e,t)=>{let{__scopeTabs:s,value:l,forceMount:r,children:i,...o}=e,c=v(k,s),u=A(c.baseId,l),h=I(c.baseId,l),p=l===c.value,x=a.useRef(p);return a.useEffect(()=>{let e=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,m.jsx)(d.C,{present:r||p,children:s=>{let{present:a}=s;return(0,m.jsx)(n.sG.div,{"data-state":p?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!a,id:h,tabIndex:0,...o,ref:t,style:{...e.style,animationDuration:x.current?"0s":void 0},children:a&&i})}})});function A(e,t){return"".concat(e,"-trigger-").concat(t)}function I(e,t){return"".concat(e,"-content-").concat(t)}C.displayName=k;var T=b,S=y,D=j,L=C},80333:(e,t,s)=>{"use strict";s.d(t,{d:()=>d});var a=s(95155),l=s(12115),r=s(4884),i=s(59434);let d=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(r.bL,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...l,ref:t,children:(0,a.jsx)(r.zi,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});d.displayName=r.bL.displayName},91394:(e,t,s)=>{"use strict";s.d(t,{BK:()=>n,eu:()=>d,q5:()=>o});var a=s(95155),l=s(12115),r=s(54011),i=s(59434);let d=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(r.bL,{ref:t,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...l})});d.displayName=r.bL.displayName;let n=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(r._V,{ref:t,className:(0,i.cn)("aspect-square h-full w-full",s),...l})});n.displayName=r._V.displayName;let o=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(r.H4,{ref:t,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...l})});o.displayName=r.H4.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,3644,5769,8248,8198,8108,587,470,5152,1859,7692,381,6214,4315,8497,62,7238,5434,5146,8441,1684,7358],()=>t(50629)),_N_E=e.O()}]);