(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9337],{17313:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>c,av:()=>d,j7:()=>i,tU:()=>o});var s=a(95155),l=a(12115),r=a(60704),n=a(59434);let o=r.bL,i=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.B8,{ref:t,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...l})});i.displayName=r.B8.displayName;let c=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.l9,{ref:t,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...l})});c.displayName=r.l9.displayName;let d=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.UC,{ref:t,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...l})});d.displayName=r.UC.displayName},45255:(e,t,a)=>{Promise.resolve().then(a.bind(a,48403))},48403:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>z});var s=a(95155),l=a(12115),r=a(98030),n=a(91689),o=a(56104),i=a(35317),c=a(17313);let d=e=>{try{let t=Array.isArray(e)?e:[],a=new Map;return t.forEach(e=>{if(!e||!e.setterId||!e.setterName)return;let t=a.get(e.setterId)||{uid:e.setterId,name:e.setterName,totalLeads:0,sitCount:0,sitRate:0,failedCreditCount:0,failedCreditRate:0,immediateDispatchCount:0,scheduledDispatchCount:0,immediateDispatchPercentage:0,cancelNoShowCount:0,cancelNoShowRate:0,avgLeadsPerDay:0};t.totalLeads++,["sold","no_sale"].includes(e.status)&&t.sitCount++,"credit_fail"===e.status&&t.failedCreditCount++,"immediate"===e.dispatchType?t.immediateDispatchCount++:"scheduled"===e.dispatchType&&t.scheduledDispatchCount++,"canceled"===e.status&&t.cancelNoShowCount++,a.set(e.setterId,t)}),Array.from(a.values()).map(e=>({...e,sitRate:e.totalLeads>0?e.sitCount/e.totalLeads*100:0,failedCreditRate:e.totalLeads>0?e.failedCreditCount/e.totalLeads*100:0,immediateDispatchPercentage:e.totalLeads>0?e.immediateDispatchCount/e.totalLeads*100:0,cancelNoShowRate:e.totalLeads>0?e.cancelNoShowCount/e.totalLeads*100:0,avgLeadsPerDay:e.totalLeads/30}))}catch(e){return console.error("Error calculating setter performance:",e),[]}},h=e=>{try{let t=Array.isArray(e)?e:[],a=new Map;return t.forEach(e=>{if(!e||!e.assignedCloserId||!e.assignedCloserName)return;let t=a.get(e.assignedCloserId)||{uid:e.assignedCloserId,name:e.assignedCloserName,totalAssigned:0,soldCount:0,noSaleCount:0,failedCreditCount:0,closeRate:0,selfGenCount:0,selfGenRate:0,avgLeadsPerDay:0,conversionRate:0};t.totalAssigned++,"sold"===e.status?t.soldCount++:"no_sale"===e.status?t.noSaleCount++:"credit_fail"===e.status&&t.failedCreditCount++,a.set(e.assignedCloserId,t)}),Array.from(a.values()).map(e=>({...e,closeRate:e.totalAssigned>0?e.soldCount/e.totalAssigned*100:0,selfGenRate:e.totalAssigned>0?e.selfGenCount/e.totalAssigned*100:0,conversionRate:e.totalAssigned>0?e.soldCount/e.totalAssigned*100:0,avgLeadsPerDay:e.totalAssigned/30}))}catch(e){return console.error("Error calculating closer performance:",e),[]}},m=(e,t,a)=>{try{let s=Array.isArray(e)?e:[],l=Array.isArray(t)?t:[],r=Array.isArray(a)?a:[],n=s.filter(e=>e&&e.status&&["sold","no_sale","credit_fail"].includes(e.status)).length,o=s.filter(e=>e&&"sold"===e.status).length,i=s.filter(e=>e&&"canceled"===e.status).length,c=s.length>0?i/s.length*100:0,d=s.filter(e=>e&&"immediate"===e.dispatchType&&["sold","no_sale","credit_fail"].includes(e.status)),h=s.filter(e=>e&&"immediate"===e.dispatchType&&"sold"===e.status).length,m=d.length>0?h/d.length*100:0,x=s.filter(e=>e&&"scheduled"===e.dispatchType&&["sold","no_sale","credit_fail"].includes(e.status)),u=s.filter(e=>e&&"scheduled"===e.dispatchType&&"sold"===e.status).length,g=x.length>0?u/x.length*100:0;return{totalLeads:s.length,totalSetters:l.length,totalClosers:r.length,avgSitRate:s.length>0?n/s.length*100:0,avgCloseRate:n>0?o/n*100:0,totalRevenue:0,avgRevenuePerLead:s.length>0?0/s.length:0,conversionRate:s.length>0?o/s.length*100:0,canceledLeadRate:c,samedaySitCloseRate:m,scheduledAppointmentCloseRate:g,leadsToday:0,leadsThisWeek:0,leadsThisMonth:s.length}}catch(e){return console.error("Error calculating team metrics:",e),{totalLeads:0,totalSetters:0,totalClosers:0,avgSitRate:0,avgCloseRate:0,totalRevenue:0,avgRevenuePerLead:0,conversionRate:0,canceledLeadRate:0,samedaySitCloseRate:0,scheduledAppointmentCloseRate:0,leadsToday:0,leadsThisWeek:0,leadsThisMonth:0}}},x=e=>{try{let t=[];for(let a=6;a>=0;a--){let s=new Date;s.setDate(s.getDate()-a);let l=s.toISOString().split("T")[0],r=e.filter(e=>e.createdAt.toDate().toISOString().split("T")[0]===l);t.push({date:s.toLocaleDateString("en-US",{month:"short",day:"numeric"}),leads:r.length,sits:r.filter(e=>["sold","no_sale","credit_fail"].includes(e.status)).length,sales:r.filter(e=>"sold"===e.status).length,revenue:0,setters:new Set(r.map(e=>e.setterId).filter(Boolean)).size,closers:new Set(r.map(e=>e.assignedCloserId).filter(Boolean)).size})}return t}catch(e){return console.error("Error generating trend data:",e),[]}},u=(e,t)=>{try{let a=[["Performance Report"],["Date Range:",t],["Generated:",new Date().toLocaleString()],[""],["Team Metrics"],["Total Leads:",e.teamMetrics.totalLeads],["Avg Sit Rate:","".concat(e.teamMetrics.avgSitRate.toFixed(1),"%")],["Avg Close Rate:","".concat(e.teamMetrics.avgCloseRate.toFixed(1),"%")],["Canceled Lead Rate:","".concat(e.teamMetrics.canceledLeadRate.toFixed(1),"%")],["Sameday Sits Close Rate:","".concat(e.teamMetrics.samedaySitCloseRate.toFixed(1),"%")],["Scheduled Appointments Close Rate:","".concat(e.teamMetrics.scheduledAppointmentCloseRate.toFixed(1),"%")],[""],["Setter Performance"],["Name","Total Leads","Sits","Sit Rate","Avg/Day"],...e.setterPerformance.map(e=>[e.name,e.totalLeads,e.sitCount,"".concat(e.sitRate.toFixed(1),"%"),e.avgLeadsPerDay.toFixed(1)]),[""],["Closer Performance"],["Name","Assigned","Sold","Close Rate","Avg/Day"],...e.closerPerformance.map(e=>[e.name,e.totalAssigned,e.soldCount,"".concat(e.closeRate.toFixed(1),"%"),e.avgLeadsPerDay.toFixed(1)])].map(e=>e.join(",")).join("\n"),s=new Blob([a],{type:"text/csv"}),l=window.URL.createObjectURL(s),r=document.createElement("a");r.href=l,r.download="performance-report-".concat(t,".csv"),r.click(),window.URL.revokeObjectURL(l)}catch(e){console.error("Error exporting CSV:",e)}};var g=a(66695),p=a(40207),f=a(80659),j=a(81203),v=a(51920);function N(e){let{teamMetrics:t,loading:a}=e;if(a)return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(8)].map((e,t)=>(0,s.jsx)(g.Zp,{children:(0,s.jsx)(g.Wu,{className:"pt-6",children:(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,s.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})})},t))});let l=[{title:"Total Leads",value:t.totalLeads.toLocaleString(),icon:p.A,color:"text-blue-600"},{title:"Active Setters",value:t.totalSetters.toString(),icon:f.A,color:"text-green-600"},{title:"Active Closers",value:t.totalClosers.toString(),icon:j.A,color:"text-purple-600"},{title:"Overall Sit Rate",value:"".concat(t.avgSitRate.toFixed(1),"%"),icon:v.A,color:"text-emerald-600"},{title:"Overall Close Rate",value:"".concat(t.avgCloseRate.toFixed(1),"%"),icon:j.A,color:"text-blue-600"},{title:"Canceled Lead Rate",value:"".concat(t.canceledLeadRate.toFixed(1),"%"),icon:p.A,color:"text-red-600"},{title:"Sameday Sits That Close %",value:"".concat(t.samedaySitCloseRate.toFixed(1),"%"),icon:f.A,color:"text-orange-600"},{title:"Scheduled Appointments That Close %",value:"".concat(t.scheduledAppointmentCloseRate.toFixed(1),"%"),icon:j.A,color:"text-purple-600"}];return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:l.map((e,t)=>{let a=e.icon;return(0,s.jsxs)(g.Zp,{children:[(0,s.jsxs)(g.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(g.ZB,{className:"text-sm font-medium",children:e.title}),(0,s.jsx)(a,{className:"h-4 w-4 ".concat(e.color)})]}),(0,s.jsx)(g.Wu,{children:(0,s.jsx)("div",{className:"text-2xl font-bold ".concat(e.color),children:e.value})})]},t)})})}var C=a(59409),y=a(30285),b=a(9572),R=a(68718);function S(e){let{dateRange:t,selectedSetter:a,selectedCloser:l,setterPerformance:r,closerPerformance:n,onDateRangeChange:o,onSetterChange:i,onCloserChange:c,onExport:d}=e;return(0,s.jsx)(g.Zp,{children:(0,s.jsx)(g.Wu,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(b.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Filters:"})]}),(0,s.jsxs)(C.l6,{value:t,onValueChange:o,children:[(0,s.jsx)(C.bq,{className:"w-32",children:(0,s.jsx)(C.yv,{placeholder:"Date Range"})}),(0,s.jsxs)(C.gC,{children:[(0,s.jsx)(C.eb,{value:"7d",children:"Last 7 days"}),(0,s.jsx)(C.eb,{value:"30d",children:"Last 30 days"}),(0,s.jsx)(C.eb,{value:"90d",children:"Last 90 days"}),(0,s.jsx)(C.eb,{value:"365d",children:"Last year"})]})]}),(0,s.jsxs)(C.l6,{value:a,onValueChange:i,children:[(0,s.jsx)(C.bq,{className:"w-48",children:(0,s.jsx)(C.yv,{placeholder:"All Setters"})}),(0,s.jsxs)(C.gC,{children:[(0,s.jsx)(C.eb,{value:"all",children:"All Setters"}),r.map(e=>(0,s.jsx)(C.eb,{value:e.uid,children:e.name},e.uid))]})]}),(0,s.jsxs)(C.l6,{value:l,onValueChange:c,children:[(0,s.jsx)(C.bq,{className:"w-48",children:(0,s.jsx)(C.yv,{placeholder:"All Closers"})}),(0,s.jsxs)(C.gC,{children:[(0,s.jsx)(C.eb,{value:"all",children:"All Closers"}),n.map(e=>(0,s.jsx)(C.eb,{value:e.uid,children:e.name},e.uid))]})]}),(0,s.jsxs)(y.$,{onClick:d,variant:"outline",className:"ml-auto",children:[(0,s.jsx)(R.A,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})})})}function w(e){let{setterPerformance:t,selectedSetter:a,onSetterSelect:l}=e;return(0,s.jsxs)(g.Zp,{children:[(0,s.jsx)(g.aR,{children:(0,s.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(f.A,{className:"h-5 w-5"}),"Setter Performance"]})}),(0,s.jsx)(g.Wu,{children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left p-2",children:"Setter"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Total Leads"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Sits"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Sit Rate"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Failed Credit"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Immediate"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Scheduled"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Cancel/No Show"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Avg/Day"})]})}),(0,s.jsx)("tbody",{children:t.filter(e=>"all"===a||e.uid===a).map(e=>(0,s.jsxs)("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>l(e.uid),children:[(0,s.jsx)("td",{className:"p-2 font-medium",children:e.name}),(0,s.jsx)("td",{className:"text-right p-2",children:e.totalLeads}),(0,s.jsx)("td",{className:"text-right p-2",children:e.sitCount}),(0,s.jsxs)("td",{className:"text-right p-2",children:[e.sitRate.toFixed(1),"%"]}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsxs)("span",{className:"text-red-600",children:[e.failedCreditCount," (",e.failedCreditRate.toFixed(1),"%)"]})}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsxs)("span",{className:"text-purple-600",children:[e.immediateDispatchCount," (",e.immediateDispatchPercentage.toFixed(1),"%)"]})}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsx)("span",{className:"text-blue-600",children:e.scheduledDispatchCount})}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsxs)("span",{className:"text-orange-600",children:[e.cancelNoShowCount," (",e.cancelNoShowRate.toFixed(1),"%)"]})}),(0,s.jsx)("td",{className:"text-right p-2",children:e.avgLeadsPerDay.toFixed(1)})]},e.uid))})]})})})]})}function A(e){let{closerPerformance:t,selectedCloser:a,onCloserSelect:l}=e;return(0,s.jsxs)(g.Zp,{children:[(0,s.jsx)(g.aR,{children:(0,s.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(j.A,{className:"h-5 w-5"}),"Closer Performance"]})}),(0,s.jsx)(g.Wu,{children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left p-2",children:"Closer"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Assigned"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Sold"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Close Rate"}),(0,s.jsx)("th",{className:"text-right p-2",children:"No Sale"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Credit Fail"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Self-Gen"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Conversion"}),(0,s.jsx)("th",{className:"text-right p-2",children:"Avg/Day"})]})}),(0,s.jsx)("tbody",{children:t.filter(e=>"all"===a||e.uid===a).map(e=>(0,s.jsxs)("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>l(e.uid),children:[(0,s.jsx)("td",{className:"p-2 font-medium",children:e.name}),(0,s.jsx)("td",{className:"text-right p-2",children:e.totalAssigned}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsx)("span",{className:"text-green-600 font-semibold",children:e.soldCount})}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsxs)("span",{className:"font-semibold ".concat(e.closeRate>=20?"text-green-600":e.closeRate>=15?"text-yellow-600":"text-red-600"),children:[e.closeRate.toFixed(1),"%"]})}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsx)("span",{className:"text-red-600",children:e.noSaleCount})}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsx)("span",{className:"text-orange-600",children:e.failedCreditCount})}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsxs)("span",{className:"text-blue-600",children:[e.selfGenCount," (",e.selfGenRate.toFixed(1),"%)"]})}),(0,s.jsx)("td",{className:"text-right p-2",children:(0,s.jsxs)("span",{className:"font-semibold ".concat(e.conversionRate>=25?"text-green-600":e.conversionRate>=20?"text-yellow-600":"text-red-600"),children:[e.conversionRate.toFixed(1),"%"]})}),(0,s.jsx)("td",{className:"text-right p-2",children:e.avgLeadsPerDay.toFixed(1)})]},e.uid))})]})})})]})}var L=a(81499),D=a(83540),k=a(3401),F=a(94754),_=a(96025),P=a(16238),I=a(83394),T=a(8782),E=a(34e3),M=a(54811),W=a(93504),K=a(21374),Z=a(5263);let G=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D"];function B(e){let{setterPerformance:t,closerPerformance:a,trendData:l,chartConfig:r}=e,n=t.map(e=>({name:e.name.split(" ")[0],sitRate:e.sitRate,failedCreditRate:e.failedCreditRate,cancelNoShowRate:e.cancelNoShowRate,totalLeads:e.totalLeads})),o=a.map(e=>({name:e.name.split(" ")[0],closeRate:e.closeRate,conversionRate:e.conversionRate,selfGenRate:e.selfGenRate,totalAssigned:e.totalAssigned})),i=[{name:"Immediate Dispatch",value:t.reduce((e,t)=>e+t.immediateDispatchCount,0)},{name:"Scheduled Dispatch",value:t.reduce((e,t)=>e+t.scheduledDispatchCount,0)},{name:"Failed Credit",value:t.reduce((e,t)=>e+t.failedCreditCount,0)},{name:"Cancel/No Show",value:t.reduce((e,t)=>e+t.cancelNoShowCount,0)}].filter(e=>e.value>0);return(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(g.Zp,{children:[(0,s.jsx)(g.aR,{children:(0,s.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(Z.A,{className:"h-5 w-5"}),"Setter Performance Rates"]})}),(0,s.jsx)(g.Wu,{className:"p-4",children:(0,s.jsx)(L.at,{config:r,className:"h-[350px] w-full",children:(0,s.jsx)(D.u,{width:"100%",height:"100%",children:(0,s.jsxs)(k.E,{data:n,margin:{top:20,right:20,bottom:60,left:20},children:[(0,s.jsx)(F.d,{strokeDasharray:"3 3"}),(0,s.jsx)(_.W,{dataKey:"name",tick:{fontSize:11},interval:0,angle:-45,textAnchor:"end",height:60}),(0,s.jsx)(P.h,{tick:{fontSize:11}}),(0,s.jsx)(L.II,{}),(0,s.jsx)(L._3,{content:(0,s.jsx)(L.Hm,{}),wrapperStyle:{paddingTop:"10px"}}),(0,s.jsx)(I.y,{dataKey:"sitRate",fill:r.sitRate.color,name:"Sit Rate %"}),(0,s.jsx)(I.y,{dataKey:"failedCreditRate",fill:r.failedCredit.color,name:"Failed Credit Rate %"}),(0,s.jsx)(I.y,{dataKey:"cancelNoShowRate",fill:r.cancelNoShow.color,name:"Cancel/No Show Rate %"})]})})})})]}),(0,s.jsxs)(g.Zp,{children:[(0,s.jsx)(g.aR,{children:(0,s.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(Z.A,{className:"h-5 w-5"}),"Closer Performance Rates"]})}),(0,s.jsx)(g.Wu,{className:"p-4",children:(0,s.jsx)(L.at,{config:r,className:"h-[350px] w-full",children:(0,s.jsx)(D.u,{width:"100%",height:"100%",children:(0,s.jsxs)(k.E,{data:o,margin:{top:20,right:20,bottom:60,left:20},children:[(0,s.jsx)(F.d,{strokeDasharray:"3 3"}),(0,s.jsx)(_.W,{dataKey:"name",tick:{fontSize:11},interval:0,angle:-45,textAnchor:"end",height:60}),(0,s.jsx)(P.h,{tick:{fontSize:11}}),(0,s.jsx)(L.II,{}),(0,s.jsx)(L._3,{content:(0,s.jsx)(L.Hm,{}),wrapperStyle:{paddingTop:"10px"}}),(0,s.jsx)(I.y,{dataKey:"closeRate",fill:r.closeRate.color,name:"Close Rate %"}),(0,s.jsx)(I.y,{dataKey:"conversionRate",fill:r.selfGen.color,name:"Conversion Rate %"}),(0,s.jsx)(I.y,{dataKey:"selfGenRate",fill:r.immediate.color,name:"Self-Generated Rate %"})]})})})})]}),(0,s.jsxs)(g.Zp,{children:[(0,s.jsx)(g.aR,{children:(0,s.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(p.A,{className:"h-5 w-5"}),"Lead Distribution by Type"]})}),(0,s.jsx)(g.Wu,{className:"p-4",children:(0,s.jsx)(L.at,{config:r,className:"h-[350px] w-full",children:(0,s.jsx)(D.u,{width:"100%",height:"100%",children:(0,s.jsxs)(T.r,{margin:{top:20,right:20,bottom:20,left:20},children:[(0,s.jsx)(E.F,{data:i,cx:"50%",cy:"45%",labelLine:!1,label:e=>{let{name:t,percent:a}=e;return a>.05?"".concat(t,": ").concat((100*a).toFixed(0),"%"):""},outerRadius:100,fill:"#8884d8",dataKey:"value",children:i.map((e,t)=>(0,s.jsx)(M.f,{fill:G[t%G.length]},"cell-".concat(t)))}),(0,s.jsx)(L.II,{formatter:(e,t)=>[e,t],labelFormatter:e=>"".concat(e," Leads")}),(0,s.jsx)(L._3,{content:(0,s.jsx)(L.Hm,{}),verticalAlign:"bottom",height:36})]})})})})]}),(0,s.jsxs)(g.Zp,{children:[(0,s.jsx)(g.aR,{children:(0,s.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(v.A,{className:"h-5 w-5"}),"Performance Trends Over Time"]})}),(0,s.jsx)(g.Wu,{className:"p-4",children:(0,s.jsx)(L.at,{config:r,className:"h-[350px] w-full",children:(0,s.jsx)(D.u,{width:"100%",height:"100%",children:(0,s.jsxs)(W.b,{data:l,margin:{top:20,right:20,bottom:60,left:20},children:[(0,s.jsx)(F.d,{strokeDasharray:"3 3"}),(0,s.jsx)(_.W,{dataKey:"date",tick:{fontSize:11},interval:"preserveStartEnd",angle:-45,textAnchor:"end",height:60}),(0,s.jsx)(P.h,{tick:{fontSize:11}}),(0,s.jsx)(L.II,{formatter:(e,t)=>["number"==typeof e?e.toLocaleString():e,t],labelFormatter:e=>"Date: ".concat(e)}),(0,s.jsx)(L._3,{content:(0,s.jsx)(L.Hm,{}),wrapperStyle:{paddingTop:"10px"}}),(0,s.jsx)(K.N,{type:"monotone",dataKey:"totalLeads",stroke:r.total.color,name:"Total Leads Count",strokeWidth:2,dot:{r:3}}),(0,s.jsx)(K.N,{type:"monotone",dataKey:"sitRate",stroke:r.sitRate.color,name:"Sit Rate %",strokeWidth:2,dot:{r:3}}),(0,s.jsx)(K.N,{type:"monotone",dataKey:"closeRate",stroke:r.closeRate.color,name:"Close Rate %",strokeWidth:2,dot:{r:3}})]})})})})]})]})}let O={sitRate:{label:"Sit Rate (%)",color:"#10b981"},closeRate:{label:"Close Rate (%)",color:"#3b82f6"},failedCredit:{label:"Failed Credit Rate (%)",color:"#f59e0b"},cancelNoShow:{label:"Cancel/No Show Rate (%)",color:"#ef4444"},immediate:{label:"Immediate Dispatch",color:"#8b5cf6"},scheduled:{label:"Scheduled Dispatch",color:"#06b6d4"},selfGen:{label:"Self-Generated Leads",color:"#84cc16"},total:{label:"Total Leads Count",color:"#6b7280"},appointments:{label:"Completed Appointments",color:"#059669"},sold:{label:"Sold Leads",color:"#10b981"},no_sale:{label:"No Sale Leads",color:"#ef4444"},credit_fail:{label:"Credit Failed Leads",color:"#f97316"}};function U(e){let{className:t}=e,{user:a}=(0,r.A)(),{toast:g}=(0,n.dj)(),[p,f]=(0,l.useState)([]),[j,v]=(0,l.useState)([]),[C,y]=(0,l.useState)(!0),[b,R]=(0,l.useState)("30d"),[L,D]=(0,l.useState)("all"),[k,F]=(0,l.useState)("all");(0,l.useEffect)(()=>{if(!(null==a?void 0:a.teamId))return;let e=parseInt(b.replace("d","")),t=new Date;t.setDate(t.getDate()-e);let s=(0,i.aQ)((0,i.query)((0,i.collection)(o.db,"leads"),(0,i.where)("teamId","==",a.teamId),(0,i.where)("createdAt",">=",i.Dc.fromDate(t)),(0,i.My)("createdAt","desc")),e=>{f(e.docs.map(e=>({id:e.id,...e.data()}))),y(!1)},e=>{console.error("Error fetching leads:",e),g({title:"Error loading leads",description:"Failed to load performance data.",variant:"destructive"}),y(!1)}),l=(0,i.aQ)((0,i.query)((0,i.collection)(o.db,"closers"),(0,i.where)("teamId","==",a.teamId)),e=>{v(e.docs.map(e=>({id:e.id,...e.data()})))},e=>{console.error("Error fetching closers:",e),g({title:"Error loading closers",description:"Failed to load closer data.",variant:"destructive"})});return()=>{s(),l()}},[null==a?void 0:a.teamId,b,g]);let _=(0,l.useMemo)(()=>d(p),[p]),P=(0,l.useMemo)(()=>h(p),[p]),I=(0,l.useMemo)(()=>m(p,_,P),[p,_,P]),T=(0,l.useMemo)(()=>x(p),[p]),E=(0,l.useMemo)(()=>"all"===L?_:_.filter(e=>e.uid===L),[_,L]),M=(0,l.useMemo)(()=>"all"===k?P:P.filter(e=>e.uid===k),[P,k]),W=(0,l.useCallback)(()=>{u({setterPerformance:_,closerPerformance:P,teamMetrics:I},b),g({title:"Export successful",description:"Performance data has been exported to CSV."})},[_,P,I,b,g]);return(0,s.jsxs)("div",{className:"space-y-6 ".concat(t),children:[(0,s.jsx)(N,{teamMetrics:I,loading:C}),(0,s.jsx)(S,{dateRange:b,selectedSetter:L,selectedCloser:k,setterPerformance:_,closerPerformance:P,onDateRangeChange:R,onSetterChange:D,onCloserChange:F,onExport:W}),(0,s.jsxs)(c.tU,{defaultValue:"overview",className:"space-y-6",children:[(0,s.jsxs)(c.j7,{className:"grid w-full grid-cols-4",children:[(0,s.jsx)(c.Xi,{value:"overview",children:"Overview"}),(0,s.jsx)(c.Xi,{value:"setters",children:"Setters"}),(0,s.jsx)(c.Xi,{value:"closers",children:"Closers"}),(0,s.jsx)(c.Xi,{value:"charts",children:"Charts"})]}),(0,s.jsx)(c.av,{value:"overview",className:"space-y-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsx)(w,{setterPerformance:E.slice(0,5),selectedSetter:L,onSetterSelect:D}),(0,s.jsx)(A,{closerPerformance:M.slice(0,5),selectedCloser:k,onCloserSelect:F})]})}),(0,s.jsx)(c.av,{value:"setters",className:"space-y-6",children:(0,s.jsx)(w,{setterPerformance:E,selectedSetter:L,onSetterSelect:D})}),(0,s.jsx)(c.av,{value:"closers",className:"space-y-6",children:(0,s.jsx)(A,{closerPerformance:M,selectedCloser:k,onCloserSelect:F})}),(0,s.jsx)(c.av,{value:"charts",className:"space-y-6",children:(0,s.jsx)(B,{setterPerformance:E,closerPerformance:M,trendData:T,chartConfig:O})})]})]})}function z(){let{user:e}=(0,r.A)();return e?"setter"===e.role?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,s.jsx)(g.Zp,{className:"max-w-md mx-auto",children:(0,s.jsx)(g.Wu,{className:"flex items-center justify-center p-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(f.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Performance Analytics Not Available"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Performance analytics are available for closers and managers only."})]})})})}):(0,s.jsx)("div",{className:"flex-1 space-y-6",children:(0,s.jsx)(U,{})}):null}},81499:(e,t,a)=>{"use strict";a.d(t,{Hm:()=>f,II:()=>u,Nt:()=>g,_3:()=>p,at:()=>m});var s=a(95155),l=a(12115),r=a(83540),n=a(94517),o=a(24026),i=a(59434);let c={light:"",dark:".dark"},d=l.createContext(null);function h(){let e=l.useContext(d);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}let m=l.forwardRef((e,t)=>{let{id:a,className:n,children:o,config:c,...h}=e,m=l.useId(),u="chart-".concat(a||m.replace(/:/g,""));return(0,s.jsx)(d.Provider,{value:{config:c},children:(0,s.jsxs)("div",{"data-chart":u,ref:t,className:(0,i.cn)("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",n),...h,children:[(0,s.jsx)(x,{id:u,config:c}),(0,s.jsx)(r.u,{children:o})]})})});m.displayName="Chart";let x=e=>{let{id:t,config:a}=e,l=Object.entries(a).filter(e=>{let[,t]=e;return t.theme||t.color});return l.length?(0,s.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(c).map(e=>{let[a,s]=e;return"\n".concat(s," [data-chart=").concat(t,"] {\n").concat(l.map(e=>{var t;let[s,l]=e,r=(null==(t=l.theme)?void 0:t[a])||l.color;return r?"  --color-".concat(s,": ").concat(r,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},u=n.m,g=l.forwardRef((e,t)=>{let{active:a,payload:r,className:n,indicator:o="dot",hideLabel:c=!1,hideIndicator:d=!1,label:m,labelFormatter:x,labelClassName:u,formatter:g,color:p,nameKey:f,labelKey:v}=e,{config:N}=h(),C=l.useMemo(()=>{var e;if(c||!(null==r?void 0:r.length))return null;let[t]=r,a="".concat(v||t.dataKey||t.name||"value"),l=j(N,t,a),n=v||"string"!=typeof m?null==l?void 0:l.label:(null==(e=N[m])?void 0:e.label)||m;return x?(0,s.jsx)("div",{className:(0,i.cn)("font-medium",u),children:x(n,r)}):n?(0,s.jsx)("div",{className:(0,i.cn)("font-medium",u),children:n}):null},[m,x,r,c,u,N,v]);if(!a||!(null==r?void 0:r.length))return null;let y=1===r.length&&"dot"!==o;return(0,s.jsxs)("div",{ref:t,className:(0,i.cn)("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",n),children:[y?null:C,(0,s.jsx)("div",{className:"grid gap-1.5",children:r.map((e,t)=>{let a="".concat(f||e.name||e.dataKey||"value"),l=j(N,e,a),r=p||e.payload.fill||e.color;return(0,s.jsx)("div",{className:(0,i.cn)("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground","dot"===o&&"items-center"),children:g&&(null==e?void 0:e.value)!==void 0&&e.name?g(e.value,e.name,e,t,e.payload):(0,s.jsxs)(s.Fragment,{children:[(null==l?void 0:l.icon)?(0,s.jsx)(l.icon,{}):!d&&(0,s.jsx)("div",{className:(0,i.cn)("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":"dot"===o,"w-1":"line"===o,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===o,"my-0.5":y&&"dashed"===o}),style:{"--color-bg":r,"--color-border":r}}),(0,s.jsxs)("div",{className:(0,i.cn)("flex flex-1 justify-between leading-none",y?"items-end":"items-center"),children:[(0,s.jsxs)("div",{className:"grid gap-1.5",children:[y?C:null,(0,s.jsx)("span",{className:"text-muted-foreground",children:(null==l?void 0:l.label)||e.name})]}),e.value&&(0,s.jsx)("span",{className:"font-mono font-medium tabular-nums text-foreground",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})});g.displayName="ChartTooltip";let p=o.s,f=l.forwardRef((e,t)=>{let{className:a,hideIcon:l=!1,payload:r,verticalAlign:n="bottom",nameKey:o}=e,{config:c}=h();return(null==r?void 0:r.length)?(0,s.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center justify-center gap-4","top"===n?"pb-3":"pt-3",a),children:r.map((e,t)=>{let a="".concat(o||e.dataKey||"value"),r=j(c,e,a);return(0,s.jsxs)("div",{className:(0,i.cn)("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[(null==r?void 0:r.icon)&&!l?(0,s.jsx)(r.icon,{}):(0,s.jsx)("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:e.color}}),(null==r?void 0:r.label)||e.value]},"".concat(e.value,"-").concat(t))})}):null});function j(e,t,a){if("object"!=typeof t||null===t)return;let s="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,l=a;return a in t&&"string"==typeof t[a]?l=t[a]:s&&a in s&&"string"==typeof s[a]&&(l=s[a]),l in e?e[l]:e[a]}f.displayName="ChartLegend"}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,3644,5769,8248,8198,8108,587,470,5152,1859,2185,5434,8441,1684,7358],()=>t(45255)),_N_E=e.O()}]);