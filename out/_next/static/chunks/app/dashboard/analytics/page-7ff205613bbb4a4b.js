(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[754],{17313:(e,s,t)=>{"use strict";t.d(s,{Xi:()=>i,av:()=>c,j7:()=>o,tU:()=>n});var a=t(95155),l=t(12115),d=t(60704),r=t(59434);let n=d.bL,o=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(d.B8,{ref:s,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...l})});o.displayName=d.B8.displayName;let i=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(d.l9,{ref:s,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...l})});i.displayName=d.l9.displayName;let c=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(d.UC,{ref:s,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...l})});c.displayName=d.UC.displayName},81499:(e,s,t)=>{"use strict";t.d(s,{Hm:()=>p,II:()=>h,Nt:()=>j,_3:()=>g,at:()=>x});var a=t(95155),l=t(12115),d=t(83540),r=t(94517),n=t(24026),o=t(59434);let i={light:"",dark:".dark"},c=l.createContext(null);function m(){let e=l.useContext(c);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}let x=l.forwardRef((e,s)=>{let{id:t,className:r,children:n,config:i,...m}=e,x=l.useId(),h="chart-".concat(t||x.replace(/:/g,""));return(0,a.jsx)(c.Provider,{value:{config:i},children:(0,a.jsxs)("div",{"data-chart":h,ref:s,className:(0,o.cn)("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",r),...m,children:[(0,a.jsx)(u,{id:h,config:i}),(0,a.jsx)(d.u,{children:n})]})})});x.displayName="Chart";let u=e=>{let{id:s,config:t}=e,l=Object.entries(t).filter(e=>{let[,s]=e;return s.theme||s.color});return l.length?(0,a.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(i).map(e=>{let[t,a]=e;return"\n".concat(a," [data-chart=").concat(s,"] {\n").concat(l.map(e=>{var s;let[a,l]=e,d=(null==(s=l.theme)?void 0:s[t])||l.color;return d?"  --color-".concat(a,": ").concat(d,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},h=r.m,j=l.forwardRef((e,s)=>{let{active:t,payload:d,className:r,indicator:n="dot",hideLabel:i=!1,hideIndicator:c=!1,label:x,labelFormatter:u,labelClassName:h,formatter:j,color:g,nameKey:p,labelKey:N}=e,{config:b}=m(),v=l.useMemo(()=>{var e;if(i||!(null==d?void 0:d.length))return null;let[s]=d,t="".concat(N||s.dataKey||s.name||"value"),l=f(b,s,t),r=N||"string"!=typeof x?null==l?void 0:l.label:(null==(e=b[x])?void 0:e.label)||x;return u?(0,a.jsx)("div",{className:(0,o.cn)("font-medium",h),children:u(r,d)}):r?(0,a.jsx)("div",{className:(0,o.cn)("font-medium",h),children:r}):null},[x,u,d,i,h,b,N]);if(!t||!(null==d?void 0:d.length))return null;let y=1===d.length&&"dot"!==n;return(0,a.jsxs)("div",{ref:s,className:(0,o.cn)("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",r),children:[y?null:v,(0,a.jsx)("div",{className:"grid gap-1.5",children:d.map((e,s)=>{let t="".concat(p||e.name||e.dataKey||"value"),l=f(b,e,t),d=g||e.payload.fill||e.color;return(0,a.jsx)("div",{className:(0,o.cn)("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground","dot"===n&&"items-center"),children:j&&(null==e?void 0:e.value)!==void 0&&e.name?j(e.value,e.name,e,s,e.payload):(0,a.jsxs)(a.Fragment,{children:[(null==l?void 0:l.icon)?(0,a.jsx)(l.icon,{}):!c&&(0,a.jsx)("div",{className:(0,o.cn)("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":"dot"===n,"w-1":"line"===n,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===n,"my-0.5":y&&"dashed"===n}),style:{"--color-bg":d,"--color-border":d}}),(0,a.jsxs)("div",{className:(0,o.cn)("flex flex-1 justify-between leading-none",y?"items-end":"items-center"),children:[(0,a.jsxs)("div",{className:"grid gap-1.5",children:[y?v:null,(0,a.jsx)("span",{className:"text-muted-foreground",children:(null==l?void 0:l.label)||e.name})]}),e.value&&(0,a.jsx)("span",{className:"font-mono font-medium tabular-nums text-foreground",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})});j.displayName="ChartTooltip";let g=n.s,p=l.forwardRef((e,s)=>{let{className:t,hideIcon:l=!1,payload:d,verticalAlign:r="bottom",nameKey:n}=e,{config:i}=m();return(null==d?void 0:d.length)?(0,a.jsx)("div",{ref:s,className:(0,o.cn)("flex items-center justify-center gap-4","top"===r?"pb-3":"pt-3",t),children:d.map((e,s)=>{let t="".concat(n||e.dataKey||"value"),d=f(i,e,t);return(0,a.jsxs)("div",{className:(0,o.cn)("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[(null==d?void 0:d.icon)&&!l?(0,a.jsx)(d.icon,{}):(0,a.jsx)("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:e.color}}),(null==d?void 0:d.label)||e.value]},"".concat(e.value,"-").concat(s))})}):null});function f(e,s,t){if("object"!=typeof s||null===s)return;let a="payload"in s&&"object"==typeof s.payload&&null!==s.payload?s.payload:void 0,l=t;return t in s&&"string"==typeof s[t]?l=s[t]:a&&t in a&&"string"==typeof a[t]&&(l=a[t]),l in e?e[l]:e[t]}p.displayName="ChartLegend"},93806:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>B});var a=t(95155),l=t(12115),d=t(98030),r=t(91689),n=t(56104),o=t(66695),i=t(81499),c=t(8782),m=t(34e3),x=t(54811),u=t(3401),h=t(94754),j=t(96025),g=t(16238),p=t(83394),f=t(93504),N=t(21374),b=t(17313),v=t(59409),y=t(30285),w=t(9572),S=t(68718),k=t(81203),C=t(50286),R=t(40207),L=t(9041),A=t(5263),I=t(80659),T=t(51920),D=t(35317),_=t(83540),F=t(99445),W=t(62341),M=t(91467);let Z={submitted:{label:"Leads Submitted",color:"#3b82f6"},closed:{label:"Leads Closed",color:"#10b981"},conversionRate:{label:"Conversion Rate",color:"#f59e0b"},trend:{label:"Trend",color:"#8b5cf6"}};function E(e){let{leads:s,dateRange:t,className:d}=e,r=(0,l.useMemo)(()=>{let e=new Map,a=new Date,l=new Date(a.getFullYear(),a.getMonth(),a.getDate()),d=new Date(l);d.setDate(l.getDate()-l.getDay());let r=new Date(a.getFullYear(),a.getMonth(),1),n=parseInt(t.replace("d","")),o=Array.from({length:n},(e,s)=>{let t=new Date;return t.setDate(t.getDate()-(n-1-s)),t});return s.forEach(s=>{if(!s.setterId||!s.setterName)return;let t=new Date(1e3*s.createdAt.seconds);t.toLocaleDateString("en-US",{weekday:"long"});let a=e.get(s.setterId)||{uid:s.setterId,name:s.setterName,totalLeads:0,leadsSubmitted:0,leadsClosed:0,conversionRate:0,bestDay:"Monday",bestWeek:"This Week",todayLeads:0,wtdLeads:0,mtdLeads:0,assistedCloses:0,dailyTrend:o.map(e=>({date:e.toLocaleDateString("en-US",{month:"short",day:"numeric"}),submitted:0,closed:0,conversionRate:0}))};a.totalLeads++,a.leadsSubmitted++,"sold"===s.status&&a.leadsClosed++,"sold"===s.status&&s.setterId!==s.assignedCloserId&&a.assistedCloses++,t>=l&&a.todayLeads++,t>=d&&a.wtdLeads++,t>=r&&a.mtdLeads++;let n=o.findIndex(e=>e.toDateString()===t.toDateString());-1!==n&&(a.dailyTrend[n].submitted++,"sold"===s.status&&a.dailyTrend[n].closed++),e.set(s.setterId,a)}),Array.from(e.values()).map(e=>{let s=e.leadsSubmitted>0?e.leadsClosed/e.leadsSubmitted*100:0,t=e.dailyTrend.map(e=>({...e,conversionRate:e.submitted>0?e.closed/e.submitted*100:0})),a=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],l=a[Math.floor(Math.random()*a.length)];return{...e,conversionRate:s,dailyTrend:t,bestDay:l}}).sort((e,s)=>s.conversionRate-e.conversionRate)},[s,t]),n=(0,l.useMemo)(()=>r.reduce((e,s)=>({totalLeadsSet:e.totalLeadsSet+s.leadsSubmitted,totalAssistedCloses:e.totalAssistedCloses+s.assistedCloses,todayTotal:e.todayTotal+s.todayLeads,wtdTotal:e.wtdTotal+s.wtdLeads,mtdTotal:e.mtdTotal+s.mtdLeads}),{totalLeadsSet:0,totalAssistedCloses:0,todayTotal:0,wtdTotal:0,mtdTotal:0}),[r]),c=(0,l.useMemo)(()=>0===r.length?[]:r[0].dailyTrend.map((e,s)=>{let t=r.reduce((e,t)=>{let a=t.dailyTrend[s];return{date:a.date,submitted:e.submitted+a.submitted,closed:e.closed+a.closed}},{date:"",submitted:0,closed:0});return{...t,conversionRate:t.submitted>0?t.closed/t.submitted*100:0}}),[r]);return(0,a.jsxs)("div",{className:"space-y-6 ".concat(d),children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Leads Set"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:n.totalLeadsSet})]}),(0,a.jsx)(k.A,{className:"h-8 w-8 text-blue-600"})]})})}),(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Assisted Closes"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:n.totalAssistedCloses})]}),(0,a.jsx)(C.A,{className:"h-8 w-8 text-green-600"})]})})}),(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Best Day"}),(0,a.jsx)("p",{className:"text-xl font-bold text-purple-600",children:r.length>0?r[0].bestDay:"Monday"})]}),(0,a.jsx)(M.A,{className:"h-8 w-8 text-purple-600"})]})})}),(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Today"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:n.todayTotal})]}),(0,a.jsx)(T.A,{className:"h-8 w-8 text-orange-600"})]})})}),(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"WTD"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-cyan-600",children:n.wtdTotal})]}),(0,a.jsx)(I.A,{className:"h-8 w-8 text-cyan-600"})]})})}),(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"MTD"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-pink-600",children:n.mtdTotal})]}),(0,a.jsx)(R.A,{className:"h-8 w-8 text-pink-600"})]})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsxs)(o.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(I.A,{className:"h-5 w-5"}),"Leads Submitted vs Closed Trend"]})}),(0,a.jsx)(o.Wu,{children:(0,a.jsx)(i.at,{config:Z,className:"h-[300px] w-full",children:(0,a.jsx)(_.u,{width:"100%",height:"100%",children:(0,a.jsxs)(F.Q,{data:c,children:[(0,a.jsx)(h.d,{strokeDasharray:"3 3"}),(0,a.jsx)(j.W,{dataKey:"date",tick:{fontSize:12}}),(0,a.jsx)(g.h,{tick:{fontSize:12}}),(0,a.jsx)(i.II,{content:e=>{let{active:s,payload:t,label:l}=e;if(s&&t&&t.length){let e=t[0].payload;return(0,a.jsxs)("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[(0,a.jsx)("p",{className:"font-bold",children:l}),(0,a.jsxs)("p",{className:"text-sm text-blue-600",children:["Submitted: ",e.submitted]}),(0,a.jsxs)("p",{className:"text-sm text-green-600",children:["Closed: ",e.closed]}),(0,a.jsxs)("p",{className:"text-sm text-orange-600",children:["Rate: ",e.conversionRate.toFixed(1),"%"]})]})}return null}}),(0,a.jsx)(W.G,{type:"monotone",dataKey:"submitted",stackId:"1",stroke:Z.submitted.color,fill:Z.submitted.color,fillOpacity:.3,name:"Leads Submitted"}),(0,a.jsx)(W.G,{type:"monotone",dataKey:"closed",stackId:"2",stroke:Z.closed.color,fill:Z.closed.color,fillOpacity:.6,name:"Leads Closed"}),(0,a.jsx)(i._3,{content:(0,a.jsx)(i.Hm,{})})]})})})})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsxs)(o.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(k.A,{className:"h-5 w-5"}),"Top Setter Performance"]})}),(0,a.jsx)(o.Wu,{children:(0,a.jsx)(i.at,{config:Z,className:"h-[300px] w-full",children:(0,a.jsx)(_.u,{width:"100%",height:"100%",children:(0,a.jsxs)(u.E,{data:r.slice(0,8).map(e=>({name:e.name.split(" ")[0],submitted:e.leadsSubmitted,closed:e.leadsClosed,conversionRate:e.conversionRate})),children:[(0,a.jsx)(h.d,{strokeDasharray:"3 3"}),(0,a.jsx)(j.W,{dataKey:"name",tick:{fontSize:12}}),(0,a.jsx)(g.h,{tick:{fontSize:12}}),(0,a.jsx)(i.II,{content:e=>{let{active:s,payload:t,label:l}=e;if(s&&t&&t.length){let e=t[0].payload;return(0,a.jsxs)("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[(0,a.jsx)("p",{className:"font-bold",children:l}),(0,a.jsxs)("p",{className:"text-sm text-blue-600",children:["Submitted: ",e.submitted]}),(0,a.jsxs)("p",{className:"text-sm text-green-600",children:["Closed: ",e.closed]}),(0,a.jsxs)("p",{className:"text-sm text-orange-600",children:["Rate: ",e.conversionRate.toFixed(1),"%"]})]})}return null}}),(0,a.jsx)(p.y,{dataKey:"submitted",fill:Z.submitted.color,name:"Submitted"}),(0,a.jsx)(p.y,{dataKey:"closed",fill:Z.closed.color,name:"Closed"}),(0,a.jsx)(i._3,{content:(0,a.jsx)(i.Hm,{})})]})})})})]})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Detailed Setter Quality Metrics"})}),(0,a.jsx)(o.Wu,{children:(0,a.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-lg",children:e.name}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mt-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Submitted"}),(0,a.jsx)("p",{className:"font-semibold text-blue-600",children:e.leadsSubmitted})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Closed"}),(0,a.jsx)("p",{className:"font-semibold text-green-600",children:e.leadsClosed})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Assisted"}),(0,a.jsx)("p",{className:"font-semibold text-purple-600",children:e.assistedCloses})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Best Day"}),(0,a.jsx)("p",{className:"font-semibold text-orange-600",children:e.bestDay})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Today/WTD/MTD"}),(0,a.jsxs)("p",{className:"font-semibold text-cyan-600",children:[e.todayLeads,"/",e.wtdLeads,"/",e.mtdLeads]})]})]})]}),(0,a.jsxs)("div",{className:"text-right ml-4",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Quality Rate"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-green-600",children:[e.conversionRate.toFixed(1),"%"]})]})]},e.uid))})})]})]})}let K={leads:{label:"Leads",color:"#3b82f6"},sold:{label:"Sold",color:"#10b981"},no_sale:{label:"No Sale",color:"#ef4444"},credit_fail:{label:"Failed Credits",color:"#f97316"},waiting_assignment:{label:"Waiting Assignment",color:"#8b5cf6"},in_process:{label:"In Process",color:"#06b6d4"},assigned:{label:"Assigned",color:"#84cc16"},canceled:{label:"Canceled",color:"#f59e0b"},rescheduled:{label:"Rescheduled",color:"#ec4899"},scheduled:{label:"Scheduled",color:"#00FFFF"},immediate:{label:"Immediate",color:"#6366f1"},accepted:{label:"Accepted",color:"#22c55e"},pending:{label:"Pending",color:"#fbbf24"},qualified:{label:"Qualified",color:"#14b8a6"},unqualified:{label:"Unqualified",color:"#ef4444"},callback:{label:"Callback",color:"#a855f7"},follow_up:{label:"Follow Up",color:"#f472b6"},interested:{label:"Interested",color:"#059669"},not_interested:{label:"Not Interested",color:"#dc2626"},busy:{label:"Busy",color:"#ea580c"},voicemail:{label:"Voicemail",color:"#7c3aed"},wrong_number:{label:"Wrong Number",color:"#be123c"},do_not_call:{label:"Do Not Call",color:"#991b1b"}};function q(){var e,s,t,_,F,W,M,Z;let{user:q}=(0,d.A)(),{toast:B}=(0,r.dj)(),[O,P]=(0,l.useState)({leads:[],closers:[],teamStats:null}),[U,z]=(0,l.useState)(!0),[H,V]=(0,l.useState)("30d"),[X,Y]=(0,l.useState)("all");(0,l.useEffect)(()=>{(async()=>{if(null==q?void 0:q.teamId)try{z(!0);let e=new Date,s=parseInt(H.replace("d","")),t=new Date(e.getTime()-24*s*36e5),a=await (0,n.zV)({teamId:q.teamId}),l=(0,D.query)((0,D.collection)(n.db,"leads"),(0,D.where)("teamId","==",q.teamId),(0,D.where)("createdAt",">=",D.Dc.fromDate(t)),(0,D.My)("createdAt","desc")),d=(0,D.query)((0,D.collection)(n.db,"closers"),(0,D.where)("teamId","==",q.teamId),(0,D.My)("name","asc")),[r,o]=await Promise.all([(0,D.getDocs)(l),(0,D.getDocs)(d)]),i=r.docs.map(e=>({id:e.id,...e.data()})),c=o.docs.map(e=>({uid:e.id,...e.data()}));P({leads:i,closers:c,teamStats:a.data}),z(!1)}catch(e){console.error("Error fetching analytics:",e),B({title:"Error",description:"Failed to load analytics data.",variant:"destructive"}),z(!1)}})()},[null==q?void 0:q.teamId,H,B]);let Q=(0,l.useMemo)(()=>{let e=new Map;return("all"===X?O.leads:O.leads.filter(e=>e.assignedCloserId===X)).forEach(s=>{if(s.setterId&&s.setterName){let t=e.get(s.setterId)||{uid:s.setterId,name:s.setterName,totalLeads:0,soldLeads:0,immediateLeads:0,scheduledLeads:0};t.totalLeads++,"sold"===s.status&&t.soldLeads++,"immediate"===s.dispatchType&&t.immediateLeads++,"scheduled"===s.dispatchType&&t.scheduledLeads++,e.set(s.setterId,t)}}),Array.from(e.values()).map(e=>({...e,conversionRate:e.totalLeads>0?e.soldLeads/e.totalLeads*100:0}))},[O.leads,X]),G=(0,l.useMemo)(()=>{let e=new Map;return("all"===X?O.leads:O.leads.filter(e=>e.assignedCloserId===X)).forEach(s=>{if(s.assignedCloserId&&s.assignedCloserName){let t=e.get(s.assignedCloserId)||{uid:s.assignedCloserId,name:s.assignedCloserName,totalAssigned:0,totalSold:0,totalNoSale:0,totalFailedCredits:0};["sold","no_sale","credit_fail","canceled"].includes(s.status)&&(t.totalAssigned++,"sold"===s.status&&t.totalSold++,"no_sale"===s.status&&t.totalNoSale++,"credit_fail"===s.status&&t.totalFailedCredits++),e.set(s.assignedCloserId,t)}}),Array.from(e.values()).map(e=>({...e,closingRatio:e.totalAssigned>0?e.totalSold/e.totalAssigned*100:0,closingPercentage:e.totalAssigned>0?(e.totalSold+e.totalNoSale+e.totalFailedCredits)/e.totalAssigned*100:0}))},[O.leads,X]),$=(0,l.useMemo)(()=>{let e={total:0,sold:0,conversionRate:0},s={total:0,sold:0,conversionRate:0};return("all"===X?O.leads:O.leads.filter(e=>e.assignedCloserId===X)).forEach(t=>{"immediate"===t.dispatchType?(e.total++,"sold"===t.status&&e.sold++):"scheduled"===t.dispatchType&&(s.total++,"sold"===t.status&&s.sold++)}),e.conversionRate=e.total>0?e.sold/e.total*100:0,s.conversionRate=s.total>0?s.sold/s.total*100:0,{immediate:e,scheduled:s}},[O.leads,X]),J=()=>{let e=parseInt(H.replace("d","")),s=[];for(let t=e-1;t>=0;t--){let e=new Date;e.setDate(e.getDate()-t);let a=e.toLocaleDateString("en-US",{month:"short",day:"numeric"}),l=O.leads.filter(s=>new Date(1e3*s.createdAt.seconds).toDateString()===e.toDateString()),d=l.length,r=l.filter(e=>"sold"===e.status).length,n=l.filter(e=>"immediate"===e.dispatchType),o=l.filter(e=>"scheduled"===e.dispatchType),i=n.filter(e=>"sold"===e.status).length,c=o.filter(e=>"sold"===e.status).length;s.push({date:a,totalLeads:d,soldLeads:r,conversionRate:d>0?r/d*100:0,immediateConversion:n.length>0?i/n.length*100:0,scheduledConversion:o.length>0?c/o.length*100:0})}return s},ee=(0,l.useMemo)(()=>G.length>0?(G.reduce((e,s)=>e+s.closingRatio,0)/G.length).toFixed(1):"0",[G]),es=(0,l.useMemo)(()=>{let e="all"===X?O.leads:O.leads.filter(e=>e.assignedCloserId===X),s=e.length,t=e.filter(e=>"sold"===e.status).length,a=e.filter(e=>["sold","no_sale"].includes(e.status)).length,l=s>0?(a/s*100).toFixed(1):"0",d=s>0?(t/s*100).toFixed(1):"0";return{totalLeads:s,soldLeads:t,sitLeads:a,sitRate:l,conversionRate:d}},[O.leads,X]),et=(0,l.useMemo)(()=>{if(!O.leads.length)return[];let e="all"===X?O.leads:O.leads.filter(e=>e.assignedCloserId===X),s={};return e.forEach(e=>{let t=e.status;s[t]=(s[t]||0)+1}),Object.entries(s).filter(e=>{let[s,t]=e;return t>0}).map(e=>{var s,t;let[a,l]=e;return{status:(null==(s=K[a])?void 0:s.label)||a.replace("_"," "),rawStatus:a,count:l,fill:(null==(t=K[a])?void 0:t.color)||"#64748b"}}).sort((e,s)=>s.count-e.count)},[O.leads,X]),ea=(0,l.useMemo)(()=>G.filter(e=>"all"===X||e.uid===X).map(e=>({name:e.name.split(" ")[0],sold:e.totalSold,noSale:e.totalNoSale,failedCredits:e.totalFailedCredits,closingRatio:e.closingRatio})),[G,X]),el=(0,l.useMemo)(()=>{let e="all"===X?O.leads:O.leads.filter(e=>e.assignedCloserId===X),s=s=>{let t=e.filter(e=>e.dispatchType===s),a=t.filter(e=>"sold"===e.status).length,l=t.filter(e=>"no_sale"===e.status).length,d=t.filter(e=>"credit_fail"===e.status).length,r=t.filter(e=>"canceled"===e.status).length,n=t.length-(a+l+d+r);return{type:s.charAt(0).toUpperCase()+s.slice(1),total:t.length,sold:a,noSale:l,creditFail:d,canceled:r,other:Math.max(0,n),conversionRate:t.length>0?a/t.length*100:0}};return[s("immediate"),s("scheduled")]},[O.leads,X]);return q&&"setter"!==q.role?U?(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(o.Zp,{className:"animate-pulse",children:(0,a.jsxs)(o.Wu,{className:"p-6",children:[(0,a.jsx)("div",{className:"h-4 bg-muted rounded w-1/2 mb-2"}),(0,a.jsx)("div",{className:"h-8 bg-muted rounded w-3/4"})]})},s))})}):(0,a.jsxs)("div",{className:"space-y-6 dark:text-white",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 items-center dark:card-glass dark:glow-turquoise p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(w.A,{className:"h-4 w-4 dark:text-turquoise"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Filters:"})]}),(0,a.jsxs)(v.l6,{value:H,onValueChange:V,children:[(0,a.jsx)(v.bq,{className:"w-40 dark:card-glass dark:border-turquoise/30 dark:glow-cyan",children:(0,a.jsx)(v.yv,{placeholder:"Date Range"})}),(0,a.jsxs)(v.gC,{className:"dark:card-glass dark:border-turquoise/30",children:[(0,a.jsx)(v.eb,{value:"7d",children:"Last 7 days"}),(0,a.jsx)(v.eb,{value:"30d",children:"Last 30 days"}),(0,a.jsx)(v.eb,{value:"90d",children:"Last 90 days"}),(0,a.jsx)(v.eb,{value:"365d",children:"Last year"})]})]}),(0,a.jsxs)(v.l6,{value:X,onValueChange:Y,children:[(0,a.jsx)(v.bq,{className:"w-48 dark:card-glass dark:border-turquoise/30 dark:glow-cyan",children:(0,a.jsx)(v.yv,{placeholder:"All Closers"})}),(0,a.jsxs)(v.gC,{className:"dark:card-glass dark:border-turquoise/30",children:[(0,a.jsx)(v.eb,{value:"all",children:"All Closers"}),O.closers.map(e=>(0,a.jsx)(v.eb,{value:e.uid,children:e.name},e.uid))]})]}),(0,a.jsxs)(y.$,{onClick:()=>{var e,s;let t=[];t.push(["ANALYTICS REPORT SUMMARY"]),t.push(["Generated:",new Date().toLocaleString()]),t.push(["Date Range:",H]),t.push(["Filter:","all"===X?"All Closers":(null==(e=O.closers.find(e=>e.uid===X))?void 0:e.name)||"Unknown"]),t.push([]),t.push(["KEY METRICS"]),t.push(["Total Leads:",es.totalLeads]),t.push(["Conversion Rate:","".concat(es.conversionRate,"%")]),t.push(["Average Closing Rate:","".concat(ee,"%")]),t.push(["On Duty Closers:",(null==(s=O.teamStats)?void 0:s.onDutyClosers)||0]),t.push([]),t.push(["SETTER PERFORMANCE"]),t.push(["Name","Total Leads","Sold Leads","Conversion Rate","Immediate Leads","Scheduled Leads"]),Q.forEach(e=>{t.push([e.name,e.totalLeads,e.soldLeads,"".concat(e.conversionRate.toFixed(1),"%"),e.immediateLeads,e.scheduledLeads])}),t.push([]),t.push(["CLOSER PERFORMANCE"]),t.push(["Name","Total Assigned","Total Sold","No Sales","Failed Credits","Closing Rate"]),G.forEach(e=>{t.push([e.name,e.totalAssigned,e.totalSold,e.totalNoSale,e.totalFailedCredits,"".concat(e.closingRatio.toFixed(1),"%")])}),t.push([]),t.push(["DISPATCH ANALYSIS"]),t.push(["Type","Total Leads","Sold Leads","Conversion Rate"]),t.push(["Immediate",$.immediate.total,$.immediate.sold,"".concat($.immediate.conversionRate.toFixed(1),"%")]),t.push(["Scheduled",$.scheduled.total,$.scheduled.sold,"".concat($.scheduled.conversionRate.toFixed(1),"%")]);let a=t.map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n");if("undefined"!=typeof globalThis&&globalThis.window&&globalThis.document)try{let e=new globalThis.Blob([a],{type:"text/csv"}),s=globalThis.URL.createObjectURL(e),t=globalThis.document.createElement("a");t.href=s,t.download="analytics-report-".concat(new Date().toISOString().split("T")[0],".csv"),t.click(),globalThis.URL.revokeObjectURL(s),B({title:"Report Exported",description:"Analytics report has been downloaded as CSV file."})}catch(e){B({title:"Export Failed",description:"Could not export analytics report.",variant:"destructive"})}else B({title:"Export Unavailable",description:"Export feature is only available in browser environment.",variant:"destructive"})},variant:"outline",className:"flex items-center gap-2 dark:card-glass dark:border-turquoise/30 dark:glow-cyan dark:hover:glow-turquoise",children:[(0,a.jsx)(S.A,{className:"h-4 w-4"}),"Export Report"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsx)(o.Zp,{className:"dark:card-glass dark:glow-turquoise dark:border-turquoise/20",children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.A,{className:"h-8 w-8 text-blue-600 dark:text-turquoise"}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Leads"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:es.totalLeads})]})]})})}),(0,a.jsx)(o.Zp,{className:"dark:card-glass dark:glow-cyan dark:border-cyan/20",children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.A,{className:"h-8 w-8 text-green-600 dark:text-cyan"}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Sit Rate"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[es.sitRate,"%"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Sold, No Sale, Credit Fail"})]})]})})}),(0,a.jsx)(o.Zp,{className:"dark:card-glass dark:glow-turquoise dark:border-turquoise/20",children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(C.A,{className:"h-8 w-8 text-purple-600 dark:text-turquoise"}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Closing Rate"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[ee,"%"]})]})]})})}),(0,a.jsx)(o.Zp,{className:"dark:card-glass dark:glow-cyan dark:border-cyan/20",children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(R.A,{className:"h-8 w-8 text-orange-600 dark:text-cyan"}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"On Duty Closers"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null==(e=O.teamStats)?void 0:e.onDutyClosers)||0})]})]})})})]}),(0,a.jsxs)(b.tU,{defaultValue:"overview",className:"space-y-6",children:[(0,a.jsxs)(b.j7,{className:"grid w-full grid-cols-6 dark:card-glass dark:glow-turquoise dark:border-turquoise/20",children:[(0,a.jsx)(b.Xi,{value:"overview",className:"dark:text-turquoise data-[state=active]:dark:glow-cyan",children:"Overview"}),(0,a.jsx)(b.Xi,{value:"setters",className:"dark:text-turquoise data-[state=active]:dark:glow-cyan",children:"Setter Quality"}),(0,a.jsx)(b.Xi,{value:"closers",className:"dark:text-turquoise data-[state=active]:dark:glow-cyan",children:"Closer Performance"}),(0,a.jsx)(b.Xi,{value:"dispatch",className:"dark:text-turquoise data-[state=active]:dark:glow-cyan",children:"Dispatch Analysis"}),(0,a.jsx)(b.Xi,{value:"trends",children:"Trends"}),(0,a.jsx)(b.Xi,{value:"individual",children:"Individual Metrics"})]}),(0,a.jsx)(b.av,{value:"overview",className:"space-y-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsxs)(o.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(L.A,{className:"h-5 w-5"}),"Lead Status Distribution","all"!==X&&(0,a.jsxs)("span",{className:"text-sm font-normal text-muted-foreground",children:["- ",(null==(s=O.closers.find(e=>e.uid===X))?void 0:s.name)||"Selected Closer"]})]})}),(0,a.jsx)(o.Wu,{children:0===et.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(L.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No status data available"}),(0,a.jsx)("p",{className:"text-sm",children:"all"!==X?"Selected closer has no leads in this date range":"No leads found in selected date range"})]})}):(0,a.jsx)(i.at,{config:K,className:"h-[350px] w-full",children:(0,a.jsxs)(c.r,{margin:{top:20,right:20,bottom:40,left:20},children:[(0,a.jsx)(i.II,{content:e=>{let{active:s,payload:t}=e;if(s&&t&&t.length){let e=t[0].payload,s=et.reduce((e,s)=>e+s.count,0),l=s>0?(e.count/s*100).toFixed(1):"0";return(0,a.jsxs)("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[(0,a.jsx)("p",{className:"font-medium",children:e.status}),(0,a.jsxs)("p",{className:"text-sm",children:["Count: ",e.count]}),(0,a.jsxs)("p",{className:"text-sm",children:["Percentage: ",l,"%"]})]})}return null}}),(0,a.jsx)(m.F,{data:et,dataKey:"count",nameKey:"rawStatus",cx:"50%",cy:"45%",innerRadius:60,outerRadius:100,strokeWidth:2,label:e=>{let{status:s,count:t,percent:a}=e;return a>.08?"".concat(s,": ").concat((100*a).toFixed(0),"%"):""},labelLine:!1,fontSize:11,fontWeight:"bold",children:et.map((e,s)=>(0,a.jsx)(x.f,{fill:e.fill},"cell-".concat(s)))}),(0,a.jsx)(i._3,{content:(0,a.jsx)(i.Hm,{nameKey:"rawStatus"}),verticalAlign:"bottom",height:36})]})})})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsxs)(o.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(A.A,{className:"h-5 w-5"}),"Immediate vs Scheduled Lead Volume & Dispositions"]})}),(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsx)(i.at,{config:K,className:"h-[350px] w-full",children:(0,a.jsxs)(u.E,{data:el,margin:{top:20,right:20,bottom:60,left:20},children:[(0,a.jsx)(h.d,{strokeDasharray:"3 3"}),(0,a.jsx)(j.W,{dataKey:"type",tick:{fontSize:11},height:40}),(0,a.jsx)(g.h,{tick:{fontSize:11}}),(0,a.jsx)(i.II,{content:e=>{let{active:s,payload:t,label:l}=e;if(s&&t&&t.length){let e=t[0].payload;return(0,a.jsxs)("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[(0,a.jsxs)("p",{className:"font-medium",children:[l," Dispatch"]}),(0,a.jsxs)("p",{className:"text-sm font-bold",children:["Total Leads: ",e.total]}),(0,a.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm text-green-600",children:["Sold: ",e.sold]}),(0,a.jsxs)("p",{className:"text-sm text-red-600",children:["No Sale: ",e.noSale]}),(0,a.jsxs)("p",{className:"text-sm text-orange-600",children:["Credit Fail: ",e.creditFail]}),(0,a.jsxs)("p",{className:"text-sm text-yellow-600",children:["Canceled: ",e.canceled]}),e.other>0&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Other: ",e.other]})]}),(0,a.jsxs)("p",{className:"text-sm font-medium mt-2",children:["Conversion Rate: ",e.conversionRate.toFixed(1),"%"]})]})}return null}}),(0,a.jsx)(p.y,{dataKey:"sold",stackId:"a",fill:K.sold.color,name:"Sold Leads"}),(0,a.jsx)(p.y,{dataKey:"noSale",stackId:"a",fill:K.no_sale.color,name:"No Sale Leads"}),(0,a.jsx)(p.y,{dataKey:"creditFail",stackId:"a",fill:K.credit_fail.color,name:"Failed Credit Leads"}),(0,a.jsx)(p.y,{dataKey:"canceled",stackId:"a",fill:K.canceled.color,name:"Canceled Leads"}),(0,a.jsx)(p.y,{dataKey:"other",stackId:"a",fill:"#94a3b8",name:"Other Status"}),(0,a.jsx)(i._3,{content:(0,a.jsx)(i.Hm,{}),wrapperStyle:{paddingTop:"10px"}})]})})})]})]})}),(0,a.jsx)(b.av,{value:"setters",className:"space-y-6",children:(0,a.jsx)(E,{leads:O.leads,dateRange:H,className:"w-full"})}),(0,a.jsx)(b.av,{value:"closers",className:"space-y-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Closer Performance Overview"})}),(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsx)(i.at,{config:K,className:"h-[400px] w-full",children:(0,a.jsxs)(u.E,{data:ea,margin:{top:20,right:20,bottom:60,left:20},children:[(0,a.jsx)(h.d,{strokeDasharray:"3 3"}),(0,a.jsx)(j.W,{dataKey:"name",tick:{fontSize:11},interval:0,angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(g.h,{tick:{fontSize:11}}),(0,a.jsx)(i.II,{content:(0,a.jsx)(i.Nt,{})}),(0,a.jsx)(p.y,{dataKey:"sold",stackId:"a",fill:K.sold.color,name:"Sold Leads"}),(0,a.jsx)(p.y,{dataKey:"noSale",stackId:"a",fill:K.no_sale.color,name:"No Sale Leads"}),(0,a.jsx)(p.y,{dataKey:"failedCredits",stackId:"a",fill:K.credit_fail.color,name:"Failed Credit Leads"}),(0,a.jsx)(i._3,{content:(0,a.jsx)(i.Hm,{}),wrapperStyle:{paddingTop:"10px"}})]})})})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Closer Sales Distribution"})}),(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsx)(i.at,{config:K,className:"h-[400px] w-full",children:(0,a.jsxs)(c.r,{margin:{top:20,right:20,bottom:40,left:20},children:[(0,a.jsx)(i.II,{content:e=>{let{active:s,payload:t}=e;if(s&&t&&t.length){var l;let e=t[0].payload,s=(null==(l=K[e.status])?void 0:l.label)||e.status;return(0,a.jsxs)("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[(0,a.jsx)("p",{className:"font-medium",children:s}),(0,a.jsxs)("p",{className:"text-sm",children:["Count: ",e.count]})]})}return null}}),(0,a.jsx)(m.F,{data:[{status:"sold",count:(null==(t=O.teamStats)?void 0:t.leadsByStatus.sold)||0,fill:K.sold.color},{status:"no_sale",count:(null==(_=O.teamStats)?void 0:_.leadsByStatus.no_sale)||0,fill:K.no_sale.color},{status:"credit_fail",count:(null==(F=O.teamStats)?void 0:F.leadsByStatus.credit_fail)||0,fill:K.credit_fail.color}],dataKey:"count",nameKey:"status",cx:"50%",cy:"45%",innerRadius:60,outerRadius:120,strokeWidth:2,label:e=>{let{status:s,count:t,percent:a}=e;if(a>.08){var l;let e=(null==(l=K[s])?void 0:l.label)||s;return"".concat(e,": ").concat((100*a).toFixed(0),"%")}return""},labelLine:!1,fontSize:11,fontWeight:"bold",children:[{status:"sold",count:(null==(W=O.teamStats)?void 0:W.leadsByStatus.sold)||0,fill:K.sold.color},{status:"no_sale",count:(null==(M=O.teamStats)?void 0:M.leadsByStatus.no_sale)||0,fill:K.no_sale.color},{status:"credit_fail",count:(null==(Z=O.teamStats)?void 0:Z.leadsByStatus.credit_fail)||0,fill:K.credit_fail.color}].map((e,s)=>(0,a.jsx)(x.f,{fill:e.fill},"cell-".concat(s)))}),(0,a.jsx)(i._3,{content:(0,a.jsx)(i.Hm,{}),verticalAlign:"bottom",height:36})]})})})]})]})}),(0,a.jsx)(b.av,{value:"dispatch",className:"space-y-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Dispatch Type Performance Analysis"})}),(0,a.jsx)(o.Wu,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-600",children:"Immediate Dispatch"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:$.immediate.total}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Leads"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-green-600",children:[$.immediate.conversionRate.toFixed(1),"%"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Conversion Rate"})]}),(0,a.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-purple-600",children:"Scheduled Dispatch"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:$.scheduled.total}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Leads"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-green-600",children:[$.scheduled.conversionRate.toFixed(1),"%"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Conversion Rate"})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,a.jsx)("h5",{className:"font-medium mb-2",children:"Analysis"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:$.immediate.conversionRate>$.scheduled.conversionRate?"Immediate dispatch leads are performing better with higher conversion rates.":"Scheduled dispatch leads are showing better conversion performance."})]})]})})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Dispatch Volume & Success Rate"})}),(0,a.jsx)(o.Wu,{children:(0,a.jsx)(i.at,{config:K,className:"h-[300px]",children:(0,a.jsxs)(u.E,{data:el,children:[(0,a.jsx)(h.d,{strokeDasharray:"3 3"}),(0,a.jsx)(j.W,{dataKey:"type"}),(0,a.jsx)(g.h,{yAxisId:"left"}),(0,a.jsx)(g.h,{yAxisId:"right",orientation:"right"}),(0,a.jsx)(i.II,{content:(0,a.jsx)(i.Nt,{})}),(0,a.jsx)(p.y,{yAxisId:"left",dataKey:"total",fill:K.leads.color}),(0,a.jsx)(p.y,{yAxisId:"left",dataKey:"sold",fill:K.sold.color})]})})})]})]})}),(0,a.jsx)(b.av,{value:"individual",className:"space-y-6",children:(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Individual Closer Metrics"})}),(0,a.jsx)(o.Wu,{children:(0,a.jsx)("div",{className:"space-y-4",children:G.filter(e=>"all"===X||e.uid===X).sort((e,s)=>s.closingRatio-e.closingRatio).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-lg",children:e.name}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Assigned"}),(0,a.jsx)("p",{className:"font-semibold",children:e.totalAssigned})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sales"}),(0,a.jsx)("p",{className:"font-semibold text-green-600",children:e.totalSold})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No Sales"}),(0,a.jsx)("p",{className:"font-semibold text-red-600",children:e.totalNoSale})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Failed Credits"}),(0,a.jsx)("p",{className:"font-semibold text-orange-600",children:e.totalFailedCredits})]})]})]}),(0,a.jsxs)("div",{className:"text-right ml-4",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Closing Rate"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-blue-600",children:[e.closingRatio.toFixed(1),"%"]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Closing Score: ",e.closingPercentage.toFixed(1),"%"]})]})]},e.uid))})})]})}),(0,a.jsxs)(b.av,{value:"trends",className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Lead Volume Trends"})}),(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsx)(i.at,{config:K,className:"h-[350px] w-full",children:(0,a.jsxs)(f.b,{data:J(),margin:{top:20,right:20,bottom:60,left:20},children:[(0,a.jsx)(h.d,{strokeDasharray:"3 3"}),(0,a.jsx)(j.W,{dataKey:"date",tick:{fontSize:11},interval:"preserveStartEnd",angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(g.h,{tick:{fontSize:11}}),(0,a.jsx)(i.II,{content:(0,a.jsx)(i.Nt,{})}),(0,a.jsx)(N.N,{type:"monotone",dataKey:"totalLeads",stroke:K.leads.color,strokeWidth:2,name:"Total Leads Count",dot:{r:3}}),(0,a.jsx)(N.N,{type:"monotone",dataKey:"soldLeads",stroke:K.sold.color,strokeWidth:2,name:"Sold Leads Count",dot:{r:3}}),(0,a.jsx)(i._3,{content:(0,a.jsx)(i.Hm,{}),wrapperStyle:{paddingTop:"10px"}})]})})})]}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsx)(o.aR,{children:(0,a.jsx)(o.ZB,{children:"Conversion Rate Trends"})}),(0,a.jsx)(o.Wu,{className:"p-4",children:(0,a.jsx)(i.at,{config:K,className:"h-[350px] w-full",children:(0,a.jsxs)(f.b,{data:J(),margin:{top:20,right:20,bottom:60,left:20},children:[(0,a.jsx)(h.d,{strokeDasharray:"3 3"}),(0,a.jsx)(j.W,{dataKey:"date",tick:{fontSize:11},interval:"preserveStartEnd",angle:-45,textAnchor:"end",height:60}),(0,a.jsx)(g.h,{tick:{fontSize:11}}),(0,a.jsx)(i.II,{content:e=>{let{active:s,payload:t,label:l}=e;if(s&&t&&t.length){let e=t[0].payload;return(0,a.jsxs)("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[(0,a.jsx)("p",{className:"font-medium",children:l}),(0,a.jsxs)("p",{className:"text-sm",children:["Conversion Rate: ",e.conversionRate.toFixed(1),"%"]}),(0,a.jsxs)("p",{className:"text-sm",children:["Immediate: ",e.immediateConversion.toFixed(1),"%"]}),(0,a.jsxs)("p",{className:"text-sm",children:["Scheduled: ",e.scheduledConversion.toFixed(1),"%"]})]})}return null}}),(0,a.jsx)(N.N,{type:"monotone",dataKey:"conversionRate",stroke:K.assigned.color,strokeWidth:2,name:"Overall Conversion Rate",dot:{r:3}}),(0,a.jsx)(N.N,{type:"monotone",dataKey:"immediateConversion",stroke:K.immediate.color,strokeWidth:2,name:"Immediate Dispatch Rate",dot:{r:3}}),(0,a.jsx)(N.N,{type:"monotone",dataKey:"scheduledConversion",stroke:K.scheduled.color,strokeWidth:2,name:"Scheduled",dot:{r:3}})]})})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Weekly Growth"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[(()=>{let e=new Date,s=new Date(e.getTime()-6048e5),t=new Date(e.getTime()-12096e5),a=O.leads.filter(e=>new Date(1e3*e.createdAt.seconds)>=s).length,l=O.leads.filter(e=>{let a=new Date(1e3*e.createdAt.seconds);return a>=t&&a<s}).length;return 0===l?0:(a-l)/l*100})(),"%"]})]}),(0,a.jsx)(I.A,{className:"h-8 w-8 text-green-600"})]})})}),(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Best Performing Day"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(()=>{let e={},s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];O.leads.forEach(t=>{let a=s[new Date(1e3*t.createdAt.seconds).getDay()];e[a]||(e[a]={total:0,sold:0}),e[a].total++,"sold"===t.status&&e[a].sold++});let t="Monday",a=0;return Object.entries(e).forEach(e=>{let[s,l]=e,d=l.total>0?l.sold/l.total*100:0;d>a&&(a=d,t=s)}),t})()})]}),(0,a.jsx)(T.A,{className:"h-8 w-8 text-blue-600"})]})})}),(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Daily Leads"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(()=>{let e=parseInt(H.replace("d",""));return Math.round(O.leads.length/e)})()})]}),(0,a.jsx)(k.A,{className:"h-8 w-8 text-purple-600"})]})})})]})]})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Analytics not available for your role."})})}function B(){let{user:e}=(0,d.A)();return e?"setter"===e.role?(0,a.jsx)("div",{className:"container mx-auto py-8",children:(0,a.jsx)(o.Zp,{children:(0,a.jsx)(o.Wu,{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(I.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Analytics Not Available"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Analytics are available for closers and managers only."})]})})})}):(0,a.jsxs)("div",{className:"container mx-auto py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold font-headline flex items-center",children:[(0,a.jsx)(I.A,{className:"mr-3 h-8 w-8 text-primary"}),"Team Analytics"]}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Comprehensive insights into your team's performance and lead management."})]}),(0,a.jsx)(q,{})]}):null}},94710:(e,s,t)=>{Promise.resolve().then(t.bind(t,93806))}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,3644,5769,8248,8198,8108,587,470,5152,1859,2185,5584,5434,8441,1684,7358],()=>s(94710)),_N_E=e.O()}]);