(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8734],{17759:(e,a,s)=>{"use strict";s.d(a,{C5:()=>v,MJ:()=>f,Rr:()=>j,eI:()=>h,lR:()=>p,lV:()=>o,zB:()=>m});var t=s(95155),r=s(12115),l=s(99708),i=s(62177),n=s(59434),d=s(85057);let o=i.Op,c=r.createContext({}),m=e=>{let{...a}=e;return(0,t.jsx)(c.Provider,{value:{name:a.name},children:(0,t.jsx)(i.xI,{...a})})},u=()=>{let e=r.useContext(c),a=r.useContext(x),{getFieldState:s,formState:t}=(0,i.xW)(),l=s(e.name,t);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=a;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...l}},x=r.createContext({}),h=r.forwardRef((e,a)=>{let{className:s,...l}=e,i=r.useId();return(0,t.jsx)(x.Provider,{value:{id:i},children:(0,t.jsx)("div",{ref:a,className:(0,n.cn)("space-y-2",s),...l})})});h.displayName="FormItem";let p=r.forwardRef((e,a)=>{let{className:s,...r}=e,{error:l,formItemId:i}=u();return(0,t.jsx)(d.J,{ref:a,className:(0,n.cn)(l&&"text-destructive",s),htmlFor:i,...r})});p.displayName="FormLabel";let f=r.forwardRef((e,a)=>{let{...s}=e,{error:r,formItemId:i,formDescriptionId:n,formMessageId:d}=u();return(0,t.jsx)(l.DX,{ref:a,id:i,"aria-describedby":r?"".concat(n," ").concat(d):"".concat(n),"aria-invalid":!!r,...s})});f.displayName="FormControl";let j=r.forwardRef((e,a)=>{let{className:s,...r}=e,{formDescriptionId:l}=u();return(0,t.jsx)("p",{ref:a,id:l,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});j.displayName="FormDescription";let v=r.forwardRef((e,a)=>{var s;let{className:r,children:l,...i}=e,{error:d,formMessageId:o}=u(),c=d?String(null!=(s=null==d?void 0:d.message)?s:""):l;return c?(0,t.jsx)("p",{ref:a,id:o,className:(0,n.cn)("text-sm font-medium text-destructive",r),...i,children:c}):null});v.displayName="FormMessage"},44838:(e,a,s)=>{"use strict";s.d(a,{SQ:()=>u,_2:()=>x,mB:()=>h,rI:()=>c,ty:()=>m});var t=s(95155),r=s(12115),l=s(48698),i=s(73158),n=s(10518),d=s(70154),o=s(59434);let c=l.bL,m=l.l9;l.YJ,l.ZL,l.Pb,l.z6,r.forwardRef((e,a)=>{let{className:s,inset:r,children:n,...d}=e;return(0,t.jsxs)(l.ZP,{ref:a,className:(0,o.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...d,children:[n,(0,t.jsx)(i.A,{className:"ml-auto"})]})}).displayName=l.ZP.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.G5,{ref:a,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=l.G5.displayName;let u=r.forwardRef((e,a)=>{let{className:s,sideOffset:r=4,...i}=e;return(0,t.jsx)(l.ZL,{children:(0,t.jsx)(l.UC,{ref:a,sideOffset:r,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})})});u.displayName=l.UC.displayName;let x=r.forwardRef((e,a)=>{let{className:s,inset:r,...i}=e;return(0,t.jsx)(l.q7,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...i})});x.displayName=l.q7.displayName,r.forwardRef((e,a)=>{let{className:s,children:r,checked:i,...d}=e;return(0,t.jsxs)(l.H_,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:i,...d,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(l.VF,{children:(0,t.jsx)(n.A,{className:"h-4 w-4"})})}),r]})}).displayName=l.H_.displayName,r.forwardRef((e,a)=>{let{className:s,children:r,...i}=e;return(0,t.jsxs)(l.hN,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(l.VF,{children:(0,t.jsx)(d.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=l.hN.displayName,r.forwardRef((e,a)=>{let{className:s,inset:r,...i}=e;return(0,t.jsx)(l.JU,{ref:a,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...i})}).displayName=l.JU.displayName;let h=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.wv,{ref:a,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})});h.displayName=l.wv.displayName},71537:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>ei});var t=s(95155),r=s(98030),l=s(35695),i=s(12115),n=s(50172),d=s(28044),o=s(50286),c=s(66695),m=s(56104),u=s(35317),x=s(30285),h=s(62523),p=s(91394),f=s(44838),j=s(83173),v=s(75074),g=s(67933),N=s(76570),y=s(54683),w=s(79556),b=s(77223),C=s(91689),A=s(54165),k=s(85057),I=s(59409);let P=["setter","closer","manager","admin"];function U(e){let{userToEdit:a,isOpen:s,onClose:l,managerTeamId:d}=e,{user:o}=(0,r.A)(),{toast:c}=(0,C.dj)(),[h,p]=(0,i.useState)(a.role),[f,j]=(0,i.useState)(!1);(0,i.useEffect)(()=>{s&&p(a.role)},[s,a.role]);let v=async()=>{if(!h)return void c({title:"No Role Selected",description:"Please select a new role.",variant:"destructive"});if(!o||"manager"!==o.role&&"admin"!==o.role)return void c({title:"Unauthorized",description:"Only managers and admins can change roles.",variant:"destructive"});if(a.uid===o.uid)return void c({title:"Action Not Allowed",description:"You cannot change your own role here.",variant:"destructive"});if("manager"===a.role&&"manager"!==h&&"admin"!==o.role)return void c({title:"Action Not Allowed",description:"Only admins can demote managers.",variant:"destructive"});if("admin"===a.role&&"admin"!==h&&"admin"!==o.role)return void c({title:"Action Not Allowed",description:"Only admins can change admin roles.",variant:"destructive"});j(!0);let e=(0,u.wP)(m.db),s=(0,u.doc)(m.db,"users",a.uid);e.update(s,{role:h});let t="closer"===a.role||"manager"===a.role||"admin"===a.role,r="closer"===h||"manager"===h||"admin"===h;if(r&&!t){let s=(0,u.doc)(m.db,"closers",a.uid);e.set(s,{uid:a.uid,name:a.displayName||a.email||"Unknown User",teamId:a.teamId,status:"Off Duty",role:h,avatarUrl:a.avatarUrl||null,phone:null,lineupOrder:new Date().getTime(),createdAt:(0,u.serverTimestamp)(),updatedAt:(0,u.serverTimestamp)()})}else if(t&&!r){let s=(0,u.doc)(m.db,"closers",a.uid);e.delete(s)}else if(t&&r&&a.role!==h){let s=(0,u.doc)(m.db,"closers",a.uid);e.update(s,{role:h,updatedAt:(0,u.serverTimestamp)()})}try{await e.commit(),c({title:"Role Updated",description:"".concat(a.displayName||a.email,"'s role changed to ").concat(h,".")}),l()}catch(e){c({title:"Update Failed",description:"Could not update user role. Please try again.",variant:"destructive"})}finally{j(!1)}};return s?(0,t.jsx)(A.lG,{open:s,onOpenChange:l,children:(0,t.jsxs)(A.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(A.c7,{children:[(0,t.jsxs)(A.L3,{className:"font-headline",children:["Change Role for ",a.displayName||a.email]}),(0,t.jsx)(A.rr,{children:"Select the new role for this user. This will affect their permissions and access."})]}),(0,t.jsx)("div",{className:"grid gap-4 py-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(k.J,{htmlFor:"role-select",children:"New Role"}),(0,t.jsxs)(I.l6,{value:h,onValueChange:e=>p(e),children:[(0,t.jsx)(I.bq,{id:"role-select",className:"w-full",children:(0,t.jsx)(I.yv,{placeholder:"Select a role"})}),(0,t.jsx)(I.gC,{children:P.map(e=>(0,t.jsx)(I.eb,{value:e,className:"capitalize",children:e},e))})]})]})}),(0,t.jsxs)(A.Es,{children:[(0,t.jsx)(A.HM,{asChild:!0,children:(0,t.jsx)(x.$,{variant:"outline",onClick:l,disabled:f,children:"Cancel"})}),(0,t.jsx)(x.$,{onClick:v,disabled:f||!h||h===a.role,children:f?(0,t.jsx)(n.A,{className:"mr-2 h-5 w-5 animate-spin"}):"Save Changes"})]})]})}):null}var R=s(17649),F=s(59434);let S=R.bL;R.l9;let T=R.ZL,E=i.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(R.hJ,{className:(0,F.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:a})});E.displayName=R.hJ.displayName;let z=i.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsxs)(T,{children:[(0,t.jsx)(E,{}),(0,t.jsx)(R.UC,{ref:a,className:(0,F.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});z.displayName=R.UC.displayName;let D=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,F.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...s})};D.displayName="AlertDialogHeader";let q=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,F.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};q.displayName="AlertDialogFooter";let L=i.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(R.hE,{ref:a,className:(0,F.cn)("text-lg font-semibold",s),...r})});L.displayName=R.hE.displayName;let M=i.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(R.VY,{ref:a,className:(0,F.cn)("text-sm text-muted-foreground",s),...r})});M.displayName=R.VY.displayName;let _=i.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(R.rc,{ref:a,className:(0,F.cn)((0,x.r)(),s),...r})});_.displayName=R.rc.displayName;let B=i.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(R.ZD,{ref:a,className:(0,F.cn)((0,x.r)({variant:"outline"}),"mt-2 sm:mt-0",s),...r})});function O(e){let{userToDelete:a,isOpen:s,onClose:r,onConfirmDelete:l}=e,[o,c]=(0,i.useState)(!1),m=async()=>{c(!0),await l(),c(!1)};return s?(0,t.jsx)(S,{open:s,onOpenChange:r,children:(0,t.jsxs)(z,{children:[(0,t.jsxs)(D,{children:[(0,t.jsx)(L,{className:"font-headline",children:"Confirm User Deletion"}),(0,t.jsxs)(M,{children:["Are you sure you want to delete the user: ",(0,t.jsx)("strong",{children:a.displayName||a.email}),"? This action will remove their records from the application. This action cannot be undone."]})]}),(0,t.jsxs)("div",{className:"my-4 p-3 bg-destructive/10 border border-destructive/30 rounded-md text-sm text-destructive flex items-start",children:[(0,t.jsx)(d.A,{className:"h-5 w-5 mr-2 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Warning:"})," This will delete the user's data from Firestore (user profile, closer record if applicable). However, it will ",(0,t.jsx)("strong",{children:"not"})," delete their Firebase Authentication account. Full account deletion requires backend admin privileges."]})]}),(0,t.jsxs)(q,{children:[(0,t.jsx)(B,{onClick:r,disabled:o,children:"Cancel"}),(0,t.jsx)(_,{onClick:m,disabled:o,className:"bg-destructive hover:bg-destructive/90",children:o?(0,t.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}):"Yes, Delete User Records"})]})]})}):null}B.displayName=R.ZD.displayName;var J=s(90858),V=s(93004),Y=s(16923),Z=s(25318),$=s(93576);function G(e){let{isOpen:a,onClose:s,user:l}=e,{user:d}=(0,r.A)(),{toast:o}=(0,C.dj)(),[c,h]=(0,i.useState)(null),[f,j]=(0,i.useState)(null),[v,N]=(0,i.useState)(!1),[y,w]=(0,i.useState)(0),[b,k]=(0,i.useState)(!1),I=async()=>{if(c&&d){if("manager"!==d.role&&"admin"!==d.role)return void o({title:"Unauthorized",description:"Only managers and admins can upload user photos.",variant:"destructive"});N(!0),w(0);try{let e=Date.now(),a=c.name.split(".").pop(),s="avatars/".concat(l.uid,"_").concat(e,".").concat(a),t=(0,J.KR)(m.IG,s),r=(0,J.bp)(t,c);r.on("state_changed",e=>{let a=e.bytesTransferred/e.totalBytes*100;w(a)},e=>{console.error("Upload error:",e),o({title:"Upload Failed",description:"Failed to upload image. Please try again.",variant:"destructive"}),N(!1)},async()=>{try{let e=await (0,J.qk)(r.snapshot.ref),a=(0,u.doc)(m.db,"users",l.uid);if(await (0,u.updateDoc)(a,{avatarUrl:e,updatedAt:new Date}),"closer"===l.role||"manager"===l.role||"admin"===l.role){let a=(0,u.doc)(m.db,"closers",l.uid);await (0,u.updateDoc)(a,{avatarUrl:e,updatedAt:new Date})}o({title:"Photo Updated",description:"".concat(l.displayName||l.email,"'s profile photo has been updated.")}),P()}catch(e){console.error("Error updating user:",e),o({title:"Update Failed",description:"Photo uploaded but failed to update user profile.",variant:"destructive"})}finally{N(!1)}})}catch(e){console.error("Upload error:",e),o({title:"Upload Failed",description:"Failed to upload image. Please try again.",variant:"destructive"}),N(!1)}}},P=()=>{v||b||(h(null),j(null),w(0),s())},U=async()=>{if(!l.email)return void o({title:"Error",description:"Email address not found for this user.",variant:"destructive"});k(!0);try{await (0,V.J1)(m.j2,l.email),o({title:"Password Reset Email Sent",description:"Password reset email sent to ".concat(l.email,". They will need to check their inbox.")})}catch(e){console.error("Password reset error:",e),o({title:"Reset Failed",description:"Could not send password reset email. Please try again.",variant:"destructive"})}finally{k(!1)}},R=(null==d?void 0:d.role)==="manager"||(null==d?void 0:d.role)==="admin";return(0,t.jsx)(A.lG,{open:a,onOpenChange:e=>{e||v||b||P()},children:(0,t.jsxs)(A.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(A.c7,{children:[(0,t.jsxs)(A.L3,{className:"font-headline flex items-center",children:[(0,t.jsx)(g.A,{className:"mr-2 h-5 w-5 text-primary"}),"Update Profile Photo"]}),(0,t.jsxs)(A.rr,{children:["Upload a new profile photo for ",l.displayName||l.email]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Current Photo:"}),(0,t.jsxs)(p.eu,{className:"h-20 w-20",children:[(0,t.jsx)(p.BK,{src:l.avatarUrl||void 0,alt:l.displayName||l.email||"User"}),(0,t.jsx)(p.q5,{className:"text-lg",children:l.displayName?l.displayName.substring(0,2).toUpperCase():l.email?l.email.substring(0,2).toUpperCase():"??"})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Select New Photo:"}),(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;let s=null==(a=e.target.files)?void 0:a[0];return s?s.type.startsWith("image/")?s.size>5242880?void o({title:"File Too Large",description:"Please select an image smaller than 5MB.",variant:"destructive"}):void(h(s),j(URL.createObjectURL(s))):void o({title:"Invalid File",description:"Please select an image file.",variant:"destructive"}):void 0},disabled:!R||v,className:"hidden",id:"avatar-upload"}),(0,t.jsxs)("label",{htmlFor:"avatar-upload",className:"cursor-pointer border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center transition-colors hover:border-gray-400 dark:hover:border-gray-500 ".concat(!R||v?"opacity-50 cursor-not-allowed":""),children:[(0,t.jsx)(Y.A,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),(0,t.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Click to select an image"}),(0,t.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"Max 5MB • JPG, PNG, GIF"})]}),f&&(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.eu,{className:"h-20 w-20",children:(0,t.jsx)(p.BK,{src:f,alt:"Preview"})}),!v&&(0,t.jsx)("button",{onClick:()=>{h(null),j(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,t.jsx)(Z.A,{className:"h-3 w-3"})})]})]})]}),v&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{children:"Uploading..."}),(0,t.jsxs)("span",{children:[Math.round(y),"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(y,"%")}})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)(x.$,{variant:"outline",onClick:P,disabled:v||b,className:"flex-1",children:"Cancel"}),(0,t.jsx)(x.$,{onClick:I,disabled:!c||v||b||!R,className:"flex-1",children:v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Y.A,{className:"mr-2 h-4 w-4"}),"Upload Photo"]})})]}),R&&l.email&&(0,t.jsxs)("div",{className:"border-t pt-3",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground mb-2",children:"Account Management:"}),(0,t.jsx)(x.$,{variant:"outline",onClick:U,disabled:v||b,className:"w-full",children:b?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending Reset Email..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.A,{className:"mr-2 h-4 w-4"}),"Send Password Reset Email"]})})]})]}),!R&&(0,t.jsx)("div",{className:"text-xs text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-950/50 px-3 py-2 rounded-md",children:"Only managers and admins can upload user photos."})]})]})})}var H=s(90678),W=s(45731);function Q(){let{user:e}=(0,r.A)(),{toast:a}=(0,C.dj)(),[s,l]=(0,i.useState)([]),[d,c]=(0,i.useState)(!0),[x,h]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=(0,u.query)((0,u.collection)(m.db,"teams")),s=(0,u.aQ)(e,e=>{l(e.docs.map(e=>({id:e.id,...e.data()}))),c(!1)},e=>{a({title:"Error",description:"Failed to load teams. Please refresh the page.",variant:"destructive"}),c(!1)});return()=>s()},[a]),(0,i.useEffect)(()=>{(async()=>{if(!d&&0===s.length&&((null==e?void 0:e.role)==="manager"||(null==e?void 0:e.role)==="admin"))try{await (0,H.TA)(),a({title:"Teams Initialized",description:"Empire team has been created successfully."})}catch(e){a({title:"Error",description:"Failed to initialize teams.",variant:"destructive"})}})()},[d,s.length,null==e?void 0:e.role,a]);let p=async t=>{if(e&&t&&t!==e.teamId){h(!0);try{let r=(0,u.doc)(m.db,"users",e.uid);if(await (0,u.updateDoc)(r,{teamId:t,updatedAt:(0,u.serverTimestamp)()}),"closer"===e.role){let a=(0,u.doc)(m.db,"closers",e.uid);await (0,u.updateDoc)(a,{teamId:t,updatedAt:(0,u.serverTimestamp)()})}let l=s.find(e=>e.id===t);a({title:"Team Switched",description:"Successfully switched to ".concat((null==l?void 0:l.name)||"new team",".")})}catch(e){a({title:"Switch Failed",description:"Failed to switch teams. Please try again.",variant:"destructive"})}finally{h(!1)}}};if(!e||"setter"===e.role)return null;let f=s.find(a=>a.id===(null==e?void 0:e.teamId));return(0,t.jsx)("div",{className:"w-full max-w-md",children:(0,t.jsxs)("div",{className:"space-y-2",children:[d?(0,t.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,t.jsx)(n.A,{className:"h-5 w-5 animate-spin mr-2 dark:text-turquoise"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground dark:text-gray-400",children:"Loading teams..."})]}):(0,t.jsxs)(I.l6,{value:e.teamId,onValueChange:p,disabled:x,children:[(0,t.jsx)(I.bq,{className:"w-full dark:card-glass dark:border-turquoise/20 dark:glow-turquoise",children:(0,t.jsx)(I.yv,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.A,{className:"h-4 w-4 text-primary dark:text-turquoise"}),(0,t.jsx)("span",{className:"font-medium dark:text-gray-200",children:(null==f?void 0:f.name)||"Unknown Team"}),(null==f?void 0:f.description)&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground dark:text-gray-400",children:["- ",f.description]})]})})}),(0,t.jsx)(I.gC,{className:"dark:card-glass dark:border-turquoise/20 dark:glow-turquoise",children:s.filter(e=>e.isActive).map(e=>(0,t.jsx)(I.eb,{value:e.id,className:"dark:hover:bg-turquoise/10 dark:focus:bg-turquoise/10",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.A,{className:"h-4 w-4 dark:text-cyan"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium dark:text-gray-200",children:e.name}),e.description&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground dark:text-gray-400",children:e.description})]})]})},e.id))})]}),x&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(n.A,{className:"h-4 w-4 animate-spin"}),"Switching teams..."]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground p-2 bg-muted/50 rounded border",children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Role:"}),(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 ml-1",children:[("manager"===e.role||"admin"===e.role)&&(0,t.jsx)(W.A,{className:"h-3 w-3 text-blue-600"}),"closer"===e.role&&(0,t.jsx)(o.A,{className:"h-3 w-3 text-green-600"}),(0,t.jsx)("span",{className:"capitalize font-medium",children:e.role})]})]})})})]})})}var K=s(17759),X=s(13896),ee=s(62177),ea=s(90221),es=s(71153);let et=es.Ik({email:es.Yj().email("Please enter a valid email address"),displayName:es.Yj().min(2,"Name must be at least 2 characters").optional().or(es.eu("")),phoneNumber:es.Yj().min(10,"Please enter a valid phone number").optional().or(es.eu("")),tempPassword:es.Yj().min(6,"Password must be at least 6 characters"),role:es.k5(["setter","closer","manager"],{required_error:"Please select a role"}),teamId:es.Yj().min(1,"Please select a team")});function er(e){let{className:a="",size:s="sm",variant:l="primary-solid"}=e,[d,o]=(0,i.useState)(!1),[c,p]=(0,i.useState)(!1),[f,v]=(0,i.useState)([]),[g,N]=(0,i.useState)(!0),{toast:y}=(0,C.dj)(),{user:w}=(0,r.A)();(0,i.useEffect)(()=>{let e=(0,u.query)((0,u.collection)(m.db,"teams")),a=(0,u.aQ)(e,e=>{v(e.docs.map(e=>({id:e.id,...e.data()})).filter(e=>e.isActive)),N(!1)},e=>{console.error("Error loading teams:",e),y({title:"Error",description:"Failed to load teams.",variant:"destructive"}),N(!1)});return()=>a()},[y]);let b=(0,ee.mN)({resolver:(0,ea.u)(et),defaultValues:{email:"",displayName:"",phoneNumber:"",tempPassword:"",role:void 0,teamId:(null==w?void 0:w.teamId)||""}}),k=()=>{c||(b.reset(),o(!1))},P=async e=>{var a,s,t;p(!0),console.log("Submitting invite user form with data:",{email:e.email,displayName:e.displayName,phoneNumber:e.phoneNumber,role:e.role,tempPasswordLength:null==(a=e.tempPassword)?void 0:a.length});try{if(!e.email.trim())throw Error("Email address is required");if(!e.tempPassword.trim())throw Error("Temporary password is required");if(!e.role)throw Error("Role selection is required");console.log("Calling inviteUserFunction...");let a=await (0,m.V$)({email:e.email.trim(),displayName:(null==(s=e.displayName)?void 0:s.trim())||void 0,phoneNumber:(null==(t=e.phoneNumber)?void 0:t.trim())||void 0,tempPassword:e.tempPassword,role:e.role,teamId:e.teamId});console.log("inviteUserFunction result:",a);let r=a.data;if(null==r?void 0:r.success)y({title:"Invitation Sent! ✉️",description:r.message||"User invitation sent successfully",duration:5e3}),k();else throw Error("Invitation failed")}catch(a){console.error("Invite user error:",a);let e="Failed to send invitation. Please try again.";(null==a?void 0:a.code)==="functions/already-exists"?e="This user is already a member of your team.":(null==a?void 0:a.code)==="functions/failed-precondition"?e=a.message||"User is already a member of another team.":(null==a?void 0:a.code)==="functions/invalid-argument"?e=a.message||"Invalid invitation data provided.":(null==a?void 0:a.code)==="functions/permission-denied"?e="You don't have permission to invite users.":(null==a?void 0:a.code)==="functions/unauthenticated"?e="Authentication required. Please log in and try again.":(null==a?void 0:a.code)==="functions/not-found"?e="User profile not found. Please contact support.":(null==a?void 0:a.code)==="functions/internal"?e=a.message||"Internal server error. Please try again.":(null==a?void 0:a.code)==="functions/unavailable"?e="Service temporarily unavailable. Please try again later.":(null==a?void 0:a.message)&&(e=a.message),y({title:"Invitation Failed",description:e,variant:"destructive",duration:6e3})}finally{p(!1)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.$,{onClick:()=>o(!0),variant:l,size:s,className:a,children:[(0,t.jsx)(X.A,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),(0,t.jsx)("span",{className:"hidden md:inline",children:"Invite New User"}),(0,t.jsx)("span",{className:"md:hidden",children:"Invite"})]}),(0,t.jsx)(A.lG,{open:d,onOpenChange:k,children:(0,t.jsxs)(A.Cf,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(A.c7,{children:[(0,t.jsxs)(A.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(X.A,{className:"h-5 w-5 text-primary"}),"Invite New Team Member"]}),(0,t.jsx)(A.rr,{children:"Send an invitation to add a new member to your team. They will receive their login credentials and can start using the system immediately."})]}),(0,t.jsx)(K.lV,{...b,children:(0,t.jsxs)("form",{onSubmit:b.handleSubmit(P),className:"space-y-6",children:[(0,t.jsx)(K.zB,{control:b.control,name:"email",render:e=>{let{field:a}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Email Address *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{placeholder:"user@company.com",type:"email",...a,disabled:c})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsx)(K.zB,{control:b.control,name:"displayName",render:e=>{let{field:a}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Display Name"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{placeholder:"John Doe (optional)",...a,disabled:c})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsx)(K.zB,{control:b.control,name:"phoneNumber",render:e=>{let{field:a}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Phone Number"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{placeholder:"(555) 123-4567 (optional)",type:"tel",...a,disabled:c})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsx)(K.zB,{control:b.control,name:"tempPassword",render:e=>{let{field:a}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Temporary Password *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{placeholder:"Enter temporary password",type:"password",...a,disabled:c})}),(0,t.jsx)(K.C5,{}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Minimum 6 characters. User will be able to change this password after first login."})]})}}),(0,t.jsx)(K.zB,{control:b.control,name:"role",render:e=>{let{field:a}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Role *"}),(0,t.jsxs)(I.l6,{onValueChange:a.onChange,value:a.value,disabled:c,children:[(0,t.jsx)(K.MJ,{children:(0,t.jsx)(I.bq,{children:(0,t.jsx)(I.yv,{placeholder:"Select a role for this user"})})}),(0,t.jsxs)(I.gC,{children:[(0,t.jsx)(I.eb,{value:"setter",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium",children:"Setter"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Can create and manage leads"})]})}),(0,t.jsx)(I.eb,{value:"closer",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium",children:"Closer"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Can accept and process assigned leads"})]})}),(0,t.jsx)(I.eb,{value:"manager",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium",children:"Manager"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Full access to team management"})]})})]})]}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsx)(K.zB,{control:b.control,name:"teamId",render:e=>{let{field:a}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Team *"}),(0,t.jsxs)(I.l6,{onValueChange:a.onChange,value:a.value,disabled:c||g,children:[(0,t.jsx)(K.MJ,{children:(0,t.jsx)(I.bq,{children:(0,t.jsx)(I.yv,{placeholder:"Select a team"})})}),(0,t.jsx)(I.gC,{children:f.map(e=>(0,t.jsx)(I.eb,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.A,{className:"h-4 w-4"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium",children:e.name}),e.description&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.description})]})]})},e.id))})]}),(0,t.jsx)(K.C5,{}),g&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)(n.A,{className:"h-3 w-3 animate-spin"}),"Loading teams..."]})]})}}),(0,t.jsxs)(A.Es,{className:"flex flex-col-reverse sm:flex-row gap-2",children:[(0,t.jsx)(x.$,{type:"button",variant:"outline",onClick:k,disabled:c,className:"w-full sm:w-auto",children:"Cancel"}),(0,t.jsx)(x.$,{type:"submit",disabled:c,className:"w-full sm:w-auto",children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending Invitation..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.A,{className:"mr-2 h-4 w-4"}),"Send Invitation"]})})]})]})})]})})]})}function el(){let{user:e}=(0,r.A)(),{toast:a}=(0,C.dj)(),[s,l]=(0,i.useState)([]),[A,k]=(0,i.useState)([]),[I,P]=(0,i.useState)(!0),[R,F]=(0,i.useState)(""),[S,T]=(0,i.useState)(null),[E,z]=(0,i.useState)(null),[D,q]=(0,i.useState)(null);(0,i.useEffect)(()=>{let s=(0,u.query)((0,u.collection)(m.db,"teams")),t=(0,u.aQ)(s,a=>{let s=a.docs.map(e=>({id:e.id,...e.data()}));k(s),((null==e?void 0:e.role)==="manager"||(null==e?void 0:e.role)==="admin")&&(s.some(e=>"empire"===e.id)||(0,H.TA)().catch(()=>{}))},e=>{a({title:"Error",description:"Failed to load teams.",variant:"destructive"})});return()=>t()},[a,e]),(0,i.useEffect)(()=>{if((null==e?void 0:e.role)==="manager"||(null==e?void 0:e.role)==="admin"){P(!0);let e=(0,u.query)((0,u.collection)(m.db,"users")),s=(0,u.aQ)(e,e=>{let a=e.docs.map(e=>({uid:e.id,...e.data()}));a.sort((e,a)=>{let s=e.displayName||e.email||"",t=a.displayName||a.email||"";return s.localeCompare(t)}),l(a),P(!1)},e=>{a({title:"Error",description:"Could not fetch team users.",variant:"destructive"}),P(!1)});return()=>s()}P(!1),l([])},[e,a]);let L=async s=>{if(!e||"manager"!==e.role&&"admin"!==e.role)return void a({title:"Unauthorized",description:"Only managers and admins can delete users.",variant:"destructive"});if(s.uid===e.uid)return void a({title:"Action Not Allowed",description:"You cannot delete yourself.",variant:"destructive"});let t=(0,u.wP)(m.db),r=(0,u.doc)(m.db,"users",s.uid);if(t.delete(r),"closer"===s.role||"manager"===s.role||"admin"===s.role){let e=(0,u.doc)(m.db,"closers",s.uid);t.delete(e)}try{await t.commit(),a({title:"User Records Deleted",description:"".concat(s.displayName||s.email,"'s records have been removed from the application. Note: Full Firebase Authentication account deletion requires backend admin privileges."),duration:7e3}),z(null)}catch(e){a({title:"Deletion Failed",description:"Could not delete user records. Please try again.",variant:"destructive"})}},M=async(s,t)=>{if(!e||"manager"!==e.role&&"admin"!==e.role)return void a({title:"Unauthorized",description:"Only managers and admins can change user teams.",variant:"destructive"});if(s.teamId===t)return void a({title:"No Change",description:"User is already on that team.",variant:"default"});try{let e=(0,u.doc)(m.db,"users",s.uid);if(await (0,u.updateDoc)(e,{teamId:t,updatedAt:new Date}),"closer"===s.role||"manager"===s.role||"admin"===s.role){let e=(0,u.doc)(m.db,"closers",s.uid);await (0,u.updateDoc)(e,{teamId:t,updatedAt:new Date})}let r=A.find(e=>e.id===t);a({title:"Team Changed",description:"".concat(s.displayName||s.email," has been moved to ").concat((null==r?void 0:r.name)||t,".")})}catch(e){a({title:"Error",description:"Failed to change user's team. Please try again.",variant:"destructive"})}};if(I)return(0,t.jsxs)(c.Zp,{className:"shadow-xl",children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"text-2xl font-bold font-headline flex items-center justify-center",children:[(0,t.jsx)(o.A,{className:"mr-3 h-7 w-7 text-primary"}),"Team Management"]}),(0,t.jsx)(c.BT,{className:"text-center",children:"Loading team members..."})]}),(0,t.jsx)(c.Wu,{className:"flex justify-center items-center h-32",children:(0,t.jsx)(n.A,{className:"h-8 w-8 animate-spin text-primary"})})]});if(!e||"manager"!==e.role&&"admin"!==e.role)return null;let _=""===R.trim()?s:s.filter(e=>{var a;let s=R.toLowerCase(),t=(e.displayName||"").toLowerCase(),r=(e.email||"").toLowerCase(),l=(e.role||"").toLowerCase(),i=((null==(a=A.find(a=>a.id===e.teamId))?void 0:a.name)||"").toLowerCase();return t.includes(s)||r.includes(s)||l.includes(s)||i.includes(s)});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(j.A,{className:"h-6 w-6 text-primary"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold font-headline",children:"Current Team"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select the team you want to manage"})]})]}),(0,t.jsx)(Q,{}),(0,t.jsx)("div",{className:"flex justify-start",children:(0,t.jsx)(er,{variant:"outline",className:"border-emerald-500/60 bg-gradient-to-r from-emerald-50/80 to-green-50/80 text-emerald-700 hover:from-emerald-100/90 hover:to-green-100/90 hover:text-emerald-800 hover:border-emerald-500 dark:border-emerald-400/60 dark:from-emerald-950/40 dark:to-green-950/40 dark:text-emerald-300 dark:hover:from-emerald-900/60 dark:hover:to-green-900/60 dark:hover:text-emerald-200 shadow-sm shadow-emerald-200/20 hover:shadow-md hover:shadow-emerald-200/30 transition-all duration-300"})})]}),(0,t.jsxs)(c.Zp,{className:"shadow-xl",children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)("div",{className:"flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(o.A,{className:"mr-3 h-7 w-7 text-primary"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.ZB,{className:"text-2xl font-bold font-headline",children:"Team Management"}),(0,t.jsx)(c.BT,{children:"Manage roles, teams, and access for your team members."})]})]}),(0,t.jsx)("div",{className:"w-full sm:max-w-xs",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(v.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(h.p,{type:"search",placeholder:"Search by name, email, role or team...",className:"w-full pl-9 bg-background",value:R,onChange:e=>F(e.target.value)})]})})]})}),(0,t.jsx)(c.Wu,{className:"space-y-4",children:0===_.length?(0,t.jsx)("p",{className:"text-muted-foreground text-center py-4",children:""!==R.trim()?"No matching team members found.":"No team members found."}):(0,t.jsx)("ul",{className:"divide-y divide-border",children:_.map(a=>{var s,r;return(0,t.jsxs)("li",{className:"py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 ".concat(a.uid===(null==e?void 0:e.uid)?"bg-blue-50 dark:bg-blue-900/20 rounded-lg px-3":""),children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsxs)(p.eu,{className:"h-10 w-10 border cursor-pointer transition-all duration-200 hover:ring-2 hover:ring-primary hover:ring-offset-2 ".concat(a.uid===(null==e?void 0:e.uid)?"ring-2 ring-primary ring-offset-2":""),onClick:()=>q(a),children:[(0,t.jsx)(p.BK,{src:a.avatarUrl||void 0,alt:a.displayName||a.email||"User"}),(0,t.jsx)(p.q5,{children:a.displayName?a.displayName.substring(0,2).toUpperCase():a.email?a.email.substring(0,2).toUpperCase():"??"})]}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer",onClick:()=>q(a),children:(0,t.jsx)(g.A,{className:"h-4 w-4 text-white"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("p",{className:"font-semibold",children:a.displayName||a.email||"Unnamed User"}),a.uid===(null==e?void 0:e.uid)&&(0,t.jsx)("span",{className:"ml-2 px-1.5 py-0.5 text-xs rounded-md bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100",children:"You"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:a.email}),(0,t.jsxs)("div",{className:"flex flex-col xs:flex-row xs:gap-3",children:[(0,t.jsxs)("p",{className:"text-xs text-muted-foreground capitalize flex items-center",children:["manager"===a.role||"admin"===a.role?(0,t.jsx)(N.A,{className:"mr-1 h-3 w-3 text-primary"}):(0,t.jsx)(y.A,{className:"mr-1 h-3 w-3"}),"Role: ",a.role]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center",children:[(0,t.jsx)(j.A,{className:"mr-1 h-3 w-3"}),"Team: ",(null==(s=A.find(e=>e.id===a.teamId))?void 0:s.name)||"Unknown"]})]})]})]}),(0,t.jsxs)("div",{className:"flex space-x-2 mt-2 sm:mt-0 self-end sm:self-center",children:[(0,t.jsxs)(f.rI,{children:[(0,t.jsx)(f.ty,{asChild:!0,children:(0,t.jsxs)(x.$,{variant:"secondary",size:"sm",className:"empire"===a.teamId?"bg-indigo-100 hover:bg-indigo-200 text-indigo-700 dark:bg-indigo-900/30 dark:hover:bg-indigo-800/40 dark:text-indigo-400":"bg-slate-100 dark:bg-slate-800",children:[(0,t.jsx)(j.A,{className:"mr-1.5 h-4 w-4"}),"Team: ",(null==(r=A.find(e=>e.id===a.teamId))?void 0:r.name)||"Unknown",(0,t.jsx)(w.A,{className:"ml-1.5 h-4 w-4"})]})}),(0,t.jsx)(f.SQ,{align:"end",children:A.filter(e=>e.isActive).map(e=>(0,t.jsxs)(f._2,{onClick:()=>M(a,e.id),disabled:a.teamId===e.id,className:"empire"===e.id?"text-indigo-700 dark:text-indigo-400 font-medium":"",children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4 ".concat("empire"===e.id?"text-indigo-600 dark:text-indigo-400":"")}),e.name,a.teamId===e.id&&(0,t.jsx)(N.A,{className:"ml-auto h-4 w-4 text-primary"})]},e.id))})]}),(0,t.jsxs)(x.$,{variant:"outline",size:"sm",onClick:()=>T(a),children:[(0,t.jsx)(y.A,{className:"mr-1.5 h-4 w-4"})," Change Role"]}),(0,t.jsxs)(x.$,{variant:"destructive",size:"sm",onClick:()=>z(a),disabled:"manager"===a.role||"admin"===a.role||a.uid===(null==e?void 0:e.uid),children:[(0,t.jsx)(b.A,{className:"mr-1.5 h-4 w-4"})," Delete"]}),("manager"===a.role||"admin"===a.role)&&a.uid!==(null==e?void 0:e.uid)&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center ml-2",children:[(0,t.jsx)(d.A,{className:"h-3 w-3 mr-1 text-orange-500"})," Cannot delete other managers/admins."]}),a.uid===(null==e?void 0:e.uid)&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center ml-2",children:[(0,t.jsx)(d.A,{className:"h-3 w-3 mr-1 text-orange-500"})," Cannot delete yourself."]})]})]},a.uid)})})})]})]}),S&&(0,t.jsx)(U,{userToEdit:S,isOpen:!!S,onClose:()=>T(null),managerTeamId:e.teamId}),E&&(0,t.jsx)(O,{userToDelete:E,isOpen:!!E,onClose:()=>z(null),onConfirmDelete:()=>L(E)}),D&&(0,t.jsx)(G,{user:D,isOpen:!!D,onClose:()=>q(null)})]})}function ei(){let{user:e,loading:a}=(0,r.A)(),s=(0,l.useRouter)();return((0,i.useEffect)(()=>{!a&&e&&"manager"!==e.role&&"admin"!==e.role&&s.replace("/dashboard")},[e,a,s]),a)?(0,t.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,t.jsx)(n.A,{className:"h-10 w-10 animate-spin text-primary"})}):e&&("manager"===e.role||"admin"===e.role)?(0,t.jsxs)("div",{className:"container py-10 space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[(0,t.jsx)(o.A,{className:"h-8 w-8 text-primary"}),"Manage Teams"]}),(0,t.jsx)("p",{className:"text-muted-foreground mt-2",children:"Manage team members, roles, and assignments"})]})}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(o.A,{className:"h-5 w-5 text-primary"}),"Team Management"]}),(0,t.jsx)(c.BT,{children:"View and manage your team members, assign roles, and control access permissions"})]}),(0,t.jsx)(c.Wu,{children:(0,t.jsx)(el,{})})]})]}):(0,t.jsx)("div",{className:"container py-10",children:(0,t.jsx)(c.Zp,{children:(0,t.jsxs)(c.Wu,{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)(d.A,{className:"h-16 w-16 text-destructive mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Access Restricted"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to access team management. Manager or admin access required."})]})})})}},82350:(e,a,s)=>{Promise.resolve().then(s.bind(s,71537))},90678:(e,a,s)=>{"use strict";s.d(a,{TA:()=>i});var t=s(56104),r=s(35317);let l=[{id:"empire",name:"Empire",description:"Elite sales team for enterprise-level opportunities",isActive:!0,settings:{autoAssignment:!0,maxLeadsPerCloser:12,workingHours:{start:"07:00",end:"22:00",timezone:"America/Los_Angeles"}}}];async function i(){console.log("Initializing teams collection...");try{let e=(0,r.collection)(t.db,"teams"),a=await (0,r.getDocs)(e),s=new Set(a.docs.map(e=>e.id));console.log("Found ".concat(a.size," existing teams: ").concat(Array.from(s).join(", ")));let i=l.filter(e=>!s.has(e.id)).map(async a=>{let s=(0,r.doc)(e,a.id),t={...a,createdAt:new Date,updatedAt:new Date};await (0,r.setDoc)(s,t),console.log("Created team: ".concat(a.name," (").concat(a.id,")"))});0===i.length?console.log("All default teams already exist. No action needed."):(await Promise.all(i),console.log("Created ".concat(i.length," new teams. Teams initialization completed successfully!")))}catch(e){throw console.error("Error initializing teams:",e),e}}},91394:(e,a,s)=>{"use strict";s.d(a,{BK:()=>d,eu:()=>n,q5:()=>o});var t=s(95155),r=s(12115),l=s(54011),i=s(59434);let n=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.bL,{ref:a,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});n.displayName=l.bL.displayName;let d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l._V,{ref:a,className:(0,i.cn)("aspect-square h-full w-full",s),...r})});d.displayName=l._V.displayName;let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.H4,{ref:a,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});o.displayName=l.H4.displayName}},e=>{var a=a=>e(e.s=a);e.O(0,[2992,3644,5769,8248,8198,8108,587,470,5152,1859,861,8497,8698,9189,3588,8441,1684,7358],()=>a(82350)),_N_E=e.O()}]);