"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5146],{14636:(e,a,s)=>{s.d(a,{AM:()=>i,Wv:()=>d,hl:()=>o});var t=s(95155),r=s(12115),l=s(20547),n=s(59434);let i=l.bL,d=l.l9,o=r.forwardRef((e,a)=>{let{className:s,align:r="center",sideOffset:i=4,...d}=e;return(0,t.jsx)(l.ZL,{children:(0,t.jsx)(l.UC,{ref:a,align:r,sideOffset:i,className:(0,n.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...d})})});o.displayName=l.UC.displayName},22715:(e,a,s)=>{s.d(a,{A:()=>K});var t=s(95155),r=s(66695),l=s(30285),n=s(40207),i=s(58127),d=s(24371),o=s(76603),c=s(763),m=s(6160),u=s(35079),x=s(91721),h=s(73926),f=s(31554),p=s(19637),g=s(89829),v=s(37648),b=s(83662),N=s(79311),j=s(98030),w=s(12115),y=s(54165),k=s(30356),A=s(85057),C=s(88539),_=s(91689),L=s(56104),S=s(35317),D=s(50172),E=s(51920),U=s(14636),R=s(85511),z=s(59409),I=s(83013),P=s(59434);let F=["sold","no_sale","canceled","rescheduled","credit_fail","waiting_assignment"],T=(()=>{let e=[];for(let a=8;a<=22;a++){let s=a.toString().padStart(2,"0");e.push("".concat(s,":00")),a<22&&e.push("".concat(s,":30"))}return e})();function q(e){let{lead:a,isOpen:s,onClose:r}=e,[n,i]=(0,w.useState)(void 0),[d,o]=(0,w.useState)(""),[c,m]=(0,w.useState)(!1),{toast:u}=(0,_.dj)(),{user:x}=(0,j.A)(),[h,f]=(0,w.useState)(void 0),[p,g]=(0,w.useState)("17:00"),[v,b]=(0,w.useState)([]),[N,q]=(0,w.useState)(void 0),[V,O]=(0,w.useState)(!1);(0,w.useEffect)(()=>{s&&(i(void 0),o(""),f(void 0),g("17:00"),q(void 0))},[s]);let M=(null==x?void 0:x.role)==="manager"||(null==x?void 0:x.role)==="admin"?F:F.filter(e=>"waiting_assignment"!==e);(0,w.useEffect)(()=>{s&&(i(void 0),o(""),f(void 0),g("17:00"),q(void 0),b([]))},[s]),(0,w.useEffect)(()=>{if("waiting_assignment"===n&&((null==x?void 0:x.role)==="manager"||(null==x?void 0:x.role)==="admin")&&(null==x?void 0:x.teamId)){O(!0);let e=(0,S.query)((0,S.collection)(L.db,"closers"),(0,S.where)("teamId","==",x.teamId),(0,S.where)("status","==","On Duty")),s=(0,S.aQ)(e,e=>{b(e.docs.map(e=>{let a=e.data();return{uid:e.id,name:a.name,status:a.status,teamId:a.teamId,role:a.role,avatarUrl:a.avatarUrl,phone:a.phone,lineupOrder:a.lineupOrder}}).filter(e=>e.uid!==a.assignedCloserId).sort((e,a)=>{let s=e.lineupOrder||999999,t=a.lineupOrder||999999;return s!==t?s-t:e.name.localeCompare(a.name)})),O(!1)},e=>{console.error("Error loading available closers:",e),u({title:"Error Loading Closers",description:"Could not load available closers for reassignment.",variant:"destructive"}),O(!1)});return()=>s()}b([]),q(void 0)},[n,null==x?void 0:x.role,null==x?void 0:x.teamId,a.assignedCloserId,u]);let $=async()=>{let e;if(!n)return void u({title:"No Status Selected",description:"Please select a disposition status.",variant:"destructive"});if("waiting_assignment"===n&&((null==x?void 0:x.role)==="manager"||(null==x?void 0:x.role)==="admin")&&v.length>0&&!N)return void u({title:"No Closer Selected",description:"Please select a closer to reassign this lead to.",variant:"destructive"});if("rescheduled"===n){if(!h||!p)return void u({title:"Missing Appointment Time",description:"Please select a date and time for the appointment.",variant:"destructive"});let[a,s]=p.split(":").map(Number),t=new Date(h);if(t.setHours(a,s,0,0),t<=new Date)return void u({title:"Invalid Appointment Time",description:"Scheduled appointment time must be in the future.",variant:"destructive"});e=S.Dc.fromDate(t)}m(!0);try{var s;let t=(0,S.doc)(L.db,"leads",a.id),l={status:n,dispositionNotes:d,updatedAt:(0,S.serverTimestamp)()};if("rescheduled"===n&&e?l.scheduledAppointmentTime=e:l.scheduledAppointmentTime=null,"waiting_assignment"===n)if(N&&((null==x?void 0:x.role)==="manager"||(null==x?void 0:x.role)==="admin")){let e=v.find(e=>e.uid===N);e&&(l.assignedCloserId=e.uid,l.assignedCloserName=e.name)}else l.assignedCloserId=null,l.assignedCloserName=null;await (0,S.updateDoc)(t,l);let i="waiting_assignment"===n&&N?"Lead reassigned to ".concat(null==(s=v.find(e=>e.uid===N))?void 0:s.name,"."):"Lead marked as ".concat(n.replace("_"," "),".");u({title:"Disposition Updated",description:i}),r()}catch(e){u({title:"Update Failed",description:"Could not update lead disposition.",variant:"destructive"})}finally{m(!1)}};return(0,t.jsx)(y.lG,{open:s,onOpenChange:e=>{e||r()},children:(0,t.jsxs)(y.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(y.c7,{children:[(0,t.jsx)(y.L3,{className:"font-headline",children:(null==x?void 0:x.role)==="manager"||(null==x?void 0:x.role)==="admin"?"Manager Disposition":"Update Lead Disposition"}),(0,t.jsx)(y.rr,{children:(null==x?void 0:x.role)==="manager"||(null==x?void 0:x.role)==="admin"?"Set the status for lead: ".concat(a.customerName,". As a manager/admin, you can set any disposition or reassign the lead."):"Select the outcome for lead: ".concat(a.customerName,".")})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsx)(k.z,{onValueChange:e=>i(e),value:n,children:M.map(e=>(0,t.jsxs)("div",{className:(0,P.cn)("flex items-center space-x-2 rounded-md p-2","waiting_assignment"===e&&((null==x?void 0:x.role)==="manager"||(null==x?void 0:x.role)==="admin")?"bg-amber-50 border border-amber-200 dark:bg-amber-950/20 dark:border-amber-800/30":""),children:[(0,t.jsx)(k.C,{value:e,id:"status-".concat(e)}),(0,t.jsx)(A.J,{htmlFor:"status-".concat(e),className:"capitalize flex-1",children:"waiting_assignment"===e&&((null==x?void 0:x.role)==="manager"||(null==x?void 0:x.role)==="admin")?(0,t.jsx)("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Reassign Closer"}):e.replace("_"," ")})]},e))}),"waiting_assignment"===n&&((null==x?void 0:x.role)==="manager"||(null==x?void 0:x.role)==="admin")&&(0,t.jsxs)("div",{className:"space-y-3 rounded-md border border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800/30 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"h-2 w-2 rounded-full bg-amber-500"}),(0,t.jsx)(A.J,{className:"text-sm font-medium text-amber-700 dark:text-amber-300",children:"Reassign to Available Closer"})]}),V?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(D.A,{className:"h-4 w-4 animate-spin"}),(0,t.jsx)("span",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Loading available closers..."})]}):v.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Select a closer to reassign this lead to, or leave unselected to move to general assignment queue."}),(0,t.jsxs)(z.l6,{onValueChange:q,value:N,children:[(0,t.jsx)(z.bq,{className:"w-full",children:(0,t.jsx)(z.yv,{placeholder:"Select a closer (or leave blank for general queue)"})}),(0,t.jsx)(z.gC,{children:v.map(e=>(0,t.jsx)(z.eb,{value:e.uid,children:e.name},e.uid))})]})]}):(0,t.jsx)("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"No available closers found. This will move the lead to the general assignment queue."})]}),"rescheduled"===n&&(0,t.jsxs)("div",{className:"space-y-3 rounded-md border border-border p-3",children:[(0,t.jsx)(A.J,{className:"text-sm font-medium",children:"Set Appointment Time"}),(0,t.jsxs)(U.AM,{children:[(0,t.jsx)(U.Wv,{asChild:!0,children:(0,t.jsxs)(l.$,{variant:"outline",className:(0,P.cn)("w-full justify-start text-left font-normal",!h&&"text-muted-foreground"),children:[(0,t.jsx)(E.A,{className:"mr-2 h-4 w-4"}),h?(0,I.GP)(h,"PPP"):(0,t.jsx)("span",{children:"Pick a date"})]})}),(0,t.jsx)(U.hl,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(R.V,{mode:"single",selected:h,onSelect:e=>{console.log("Date selected:",e),f(e)},initialFocus:!0,disabled:e=>{let a=new Date;return a.setHours(0,0,0,0),e<a}})})]}),(0,t.jsx)("div",{className:"w-full",children:(0,t.jsxs)(z.l6,{onValueChange:g,value:p,children:[(0,t.jsx)(z.bq,{children:(0,t.jsx)(z.yv,{placeholder:"Select time"})}),(0,t.jsx)(z.gC,{children:T.map(e=>{let[a,s]=e.split(":"),r=parseInt(a)>12?parseInt(a)-12:parseInt(a),l=parseInt(a)>=12?"PM":"AM",n="".concat(0===r?12:r,":").concat(s," ").concat(l);return(0,t.jsx)(z.eb,{value:e,children:n},e)})})]})})]}),(0,t.jsx)(C.T,{placeholder:"Add any relevant notes...",value:d,onChange:e=>o(e.target.value),rows:3})]}),(0,t.jsxs)(y.Es,{children:[(0,t.jsx)(l.$,{variant:"outline",onClick:r,disabled:c,children:"Cancel"}),(0,t.jsx)(l.$,{onClick:$,disabled:c||!n,children:c?(0,t.jsx)(D.A,{className:"mr-2 h-5 w-5 animate-spin"}):"Save Disposition"})]})]})})}var V=s(26126),O=s(12543),M=s(19968),$=s(61840),Z=s(68718),J=s(25318);function B(e){let{photoUrls:a,customerName:s,isOpen:r,onClose:n}=e,[i,d]=(0,w.useState)(0),[o,c]=(0,w.useState)(!1),[m,u]=(0,w.useState)(!0),{toast:x}=(0,_.dj)(),h=async(e,a)=>{c(!0);try{let t=await fetch(e,{mode:"cors",credentials:"same-origin",headers:{Accept:"image/*"}});if(!t.ok)if(403===t.status)throw Error("Access denied - insufficient permissions");else if(404===t.status)throw Error("Image not found");else throw Error("Failed to fetch image (".concat(t.status,")"));let r=await t.blob(),l="".concat(s.replace(/\s+/g,"_"),"_photo_").concat(a+1,".jpg");{let e=window.URL.createObjectURL(r),a=document.createElement("a");a.href=e,a.download=l,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e)}x({title:"Download Complete",description:"Photo ".concat(a+1," has been downloaded.")})}catch(e){console.error("Download failed:",e),x({title:"Download Failed",description:e instanceof Error?e.message:"Unable to download the photo. Please try again.",variant:"destructive"})}finally{c(!1)}},f=async()=>{c(!0);try{for(let e=0;e<a.length;e++)await h(a[e],e),e<a.length-1&&await new Promise(e=>setTimeout(e,500));x({title:"All Downloads Complete",description:"".concat(a.length," photos have been downloaded.")})}catch(e){console.error("Download all failed:",e),x({title:"Download Failed",description:"Some photos may not have downloaded. Please try again.",variant:"destructive"})}finally{c(!1)}},p=e=>{window.open(e,"_blank","noopener,noreferrer")};return a&&0!==a.length?(0,t.jsx)(y.lG,{open:r,onOpenChange:n,children:(0,t.jsxs)(y.Cf,{className:"max-w-4xl max-h-[90vh] p-0",children:[(0,t.jsx)(y.c7,{className:"p-6 pb-0",children:(0,t.jsxs)(y.L3,{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(N.A,{className:"h-5 w-5"}),"Photos for ",s]}),(0,t.jsxs)(V.E,{variant:"secondary",className:"text-xs",children:[i+1," of ",a.length]})]})}),(0,t.jsxs)("div",{className:"relative flex-1 min-h-[400px] max-h-[60vh] bg-black/5 dark:bg-black/20 mx-6",children:[(0,t.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center",children:[m&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)(D.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})}),(0,t.jsx)("img",{src:a[i],alt:"Photo ".concat(i+1," for ").concat(s),className:"max-w-full max-h-full object-contain rounded-lg",onLoad:()=>{u(!1)},onError:()=>{u(!1),x({title:"Image Load Error",description:"Unable to load this image.",variant:"destructive"})},style:{display:m?"none":"block"}})]}),a.length>1&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.$,{variant:"outline",size:"icon",className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-white/90 dark:bg-black/90 hover:bg-white dark:hover:bg-black",onClick:()=>{d(e=>0===e?a.length-1:e-1),u(!0)},disabled:m,children:(0,t.jsx)(O.A,{className:"h-4 w-4"})}),(0,t.jsx)(l.$,{variant:"outline",size:"icon",className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-white/90 dark:bg-black/90 hover:bg-white dark:hover:bg-black",onClick:()=>{d(e=>e===a.length-1?0:e+1),u(!0)},disabled:m,children:(0,t.jsx)(M.A,{className:"h-4 w-4"})})]})]}),a.length>1&&(0,t.jsx)("div",{className:"px-6 py-4 border-t",children:(0,t.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2",children:a.map((e,a)=>(0,t.jsx)("button",{onClick:()=>{d(a),u(!0)},className:"flex-shrink-0 w-16 h-16 rounded-md overflow-hidden border-2 transition-all ".concat(a===i?"border-primary ring-2 ring-primary/20":"border-border hover:border-primary/50"),children:(0,t.jsx)("img",{src:e,alt:"Thumbnail ".concat(a+1),className:"w-full h-full object-cover"})},a))})}),(0,t.jsxs)(y.Es,{className:"p-6 pt-0 flex flex-col sm:flex-row gap-2",children:[(0,t.jsxs)("div",{className:"flex gap-2 flex-1",children:[(0,t.jsxs)(l.$,{variant:"outline",size:"sm",onClick:()=>p(a[i]),className:"flex items-center gap-2",children:[(0,t.jsx)($.A,{className:"h-4 w-4"}),"Open in New Tab"]}),(0,t.jsxs)(l.$,{variant:"outline",size:"sm",onClick:()=>h(a[i],i),disabled:o,className:"flex items-center gap-2",children:[o?(0,t.jsx)(D.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(Z.A,{className:"h-4 w-4"}),"Download This Photo"]}),a.length>1&&(0,t.jsxs)(l.$,{variant:"outline",size:"sm",onClick:f,disabled:o,className:"flex items-center gap-2",children:[o?(0,t.jsx)(D.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(Z.A,{className:"h-4 w-4"}),"Download All (",a.length,")"]})]}),(0,t.jsxs)(l.$,{variant:"outline",onClick:n,size:"sm",children:[(0,t.jsx)(J.A,{className:"h-4 w-4 mr-2"}),"Close"]})]})]})}):null}var G=s(76430),H=s(35714);let W=e=>{switch(e){case"in_process":return(0,t.jsx)(n.A,{className:"h-5 w-5 text-blue-500"});case"accepted":return(0,t.jsx)(i.A,{className:"h-5 w-5 text-green-600"});case"sold":return(0,t.jsx)(i.A,{className:"h-5 w-5 text-green-500"});case"no_sale":return(0,t.jsx)(d.A,{className:"h-5 w-5 text-red-500"});case"canceled":return(0,t.jsx)(o.A,{className:"h-5 w-5 text-yellow-500"});case"rescheduled":return(0,t.jsx)(c.A,{className:"h-5 w-5 text-purple-500"});case"scheduled":return(0,t.jsx)(c.A,{className:"h-5 w-5 text-blue-500"});case"credit_fail":return(0,t.jsx)(m.A,{className:"h-5 w-5 text-blue-500"});case"waiting_assignment":return(0,t.jsx)(u.A,{className:"h-5 w-5 text-gray-500"});default:return(0,t.jsx)(n.A,{className:"h-5 w-5 text-gray-500"})}},Y=e=>{switch(e){case"sold":return"default";case"accepted":case"in_process":return"secondary";case"no_sale":case"credit_fail":case"canceled":return"destructive";default:return"outline"}};function K(e){let{lead:a,context:s="in-process",onLeadClick:n}=e,{user:i}=(0,j.A)(),[d,o]=(0,w.useState)(!1),[c,m]=(0,w.useState)(!1),u=(null==i?void 0:i.role)==="closer"&&("in_process"===a.status||"accepted"===a.status)||((null==i?void 0:i.role)==="manager"||(null==i?void 0:i.role)==="admin")&&("all-leads"===s||"in-process"===s||"queue-scheduled"===s),y=a.createdAt?(0,H.m)(a.createdAt.toDate(),{addSuffix:!0}):"N/A",k=("rescheduled"===a.status||"scheduled"===a.status)&&a.scheduledAppointmentTime?(0,I.GP)(a.scheduledAppointmentTime.toDate(),"MMM d, p"):null;return"queue-scheduled"===s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.Zp,{className:"shadow-md hover:shadow-lg transition-shadow duration-200 flex flex-col dark:card-glass dark:glow-turquoise dark:border-turquoise/20 ".concat(u?"cursor-pointer hover:dark:glow-cyan":""),onClick:u?()=>{console.log("\uD83D\uDD25 LeadCard - Card clicked for lead details:",{leadId:a.id,customerName:a.customerName,context:s,userRole:null==i?void 0:i.role}),null==n||n(a)}:void 0,children:[(0,t.jsx)(r.aR,{className:"pb-2 pt-3 px-3 sm:pb-3 sm:pt-4 sm:px-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex items-center flex-1 min-w-0",children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)(r.ZB,{className:"text-sm sm:text-base font-semibold font-headline text-left truncate",children:a.customerName}),(0,t.jsxs)(r.BT,{className:"text-xs text-muted-foreground text-left",children:[a.setterName&&(0,t.jsxs)("span",{className:"truncate",children:["Set by: ",a.setterName]}),"rescheduled"===a.status&&a.assignedCloserName&&(0,t.jsxs)("span",{className:"ml-2 text-blue-600 font-bold truncate",children:["• Assigned: ",a.assignedCloserName]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 ml-2 flex-shrink-0",children:[(0,t.jsx)(G.A,{leadId:a.id,className:"text-xs"}),"rescheduled"!==a.status&&(0,t.jsxs)(V.E,{variant:Y(a.status),className:"capitalize text-xs flex items-center gap-1 whitespace-nowrap",children:[W(a.status),(0,t.jsx)("span",{className:"hidden sm:inline",children:a.status.replace("_"," ")})]})]})]})}),"            ",u&&(0,t.jsx)(r.wL,{className:"pt-0 pb-2 px-3 sm:pb-3 sm:px-4",children:(0,t.jsxs)(l.$,{onClick:e=>{console.log("\uD83D\uDD25 LeadCard - Update status button clicked:",{leadId:a.id,customerName:a.customerName,context:s,userRole:null==i?void 0:i.role}),e.stopPropagation(),o(!0)},size:"sm",variant:"secondary",className:"w-full text-xs sm:text-sm dark:card-glass dark:glow-cyan dark:hover:glow-turquoise transition-all duration-300",children:[(0,t.jsx)(h.A,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"Update Status"]})})]}),u&&(0,t.jsx)(q,{lead:a,isOpen:d,onClose:()=>o(!1)})]}):"queue-waiting"===s?(0,t.jsx)(r.Zp,{className:"shadow-md hover:shadow-lg transition-shadow duration-200 flex flex-col dark:card-glass dark:glow-cyan dark:border-white/[.08]",children:(0,t.jsx)(r.aR,{className:"pb-2 pt-3 px-3 sm:pb-3 sm:pt-4 sm:px-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex items-center flex-1 min-w-0",children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)(r.ZB,{className:"text-sm sm:text-base font-semibold font-headline text-left truncate",children:a.customerName}),(0,t.jsx)(r.BT,{className:"text-xs text-muted-foreground text-left",children:a.setterName&&(0,t.jsxs)("span",{className:"truncate",children:["Set by: ",a.setterName]})})]})]}),"rescheduled"!==a.status&&(0,t.jsxs)(V.E,{variant:Y(a.status),className:"capitalize text-xs flex items-center gap-1 whitespace-nowrap ml-2 flex-shrink-0",children:[W(a.status),(0,t.jsx)("span",{className:"hidden sm:inline",children:a.status.replace("_"," ")})]})]})})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.Zp,{className:"shadow-md hover:shadow-lg transition-shadow duration-200 flex flex-col dark:card-glass dark:glow-cyan dark:border-white/[.08]",children:[(0,t.jsx)(r.aR,{className:"pb-3 pt-4 px-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(x.A,{className:"mr-2 h-5 w-5 text-primary flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(r.ZB,{className:"text-base font-semibold font-headline text-left",children:a.customerName}),(0,t.jsxs)(r.BT,{className:"text-xs text-muted-foreground text-left",children:["Created ",y]})]})]}),"rescheduled"!==a.status&&(0,t.jsxs)(V.E,{variant:Y(a.status),className:"capitalize text-xs flex items-center gap-1 whitespace-nowrap ml-2",children:[W(a.status),a.status.replace("_"," ")]})]})}),(0,t.jsxs)(r.Wu,{className:"text-sm space-y-1.5 pb-3 px-4 flex-grow",children:[(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,t.jsx)(f.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsx)("span",{children:a.customerPhone})]}),a.address&&(0,t.jsxs)("div",{className:"flex items-start text-muted-foreground",children:[(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4 flex-shrink-0 mt-0.5"}),(0,t.jsx)("span",{className:"truncate",title:a.address,children:a.address})]}),(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,t.jsx)(g.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsxs)("span",{className:"capitalize",children:[a.dispatchType," Dispatch"]})]}),a.assignedCloserName&&"in_process"===a.status&&(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsxs)("span",{children:["Assigned: ",a.assignedCloserName]})]}),a.assignedCloserName&&"rescheduled"===a.status&&(0,t.jsxs)("div",{className:"flex items-center text-blue-600",children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsxs)("span",{className:"font-bold",children:["Assigned: ",a.assignedCloserName]})]}),k&&(0,t.jsxs)("div",{className:"flex items-center text-blue-600",children:[(0,t.jsx)(v.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsxs)("span",{className:"font-bold",children:["Scheduled: ",k]})]}),((null==i?void 0:i.role)==="manager"||(null==i?void 0:i.role)==="admin")&&a.setterName&&(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground text-xs mt-1",children:[(0,t.jsx)(x.A,{className:"mr-2 h-3 w-3 text-gray-400 flex-shrink-0"}),(0,t.jsxs)("span",{children:["Set by: ",a.setterName]})]}),((null==i?void 0:i.role)==="manager"||(null==i?void 0:i.role)==="admin")&&a.setterLocation&&(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground text-xs mt-1",children:[(0,t.jsx)(b.A,{className:"mr-2 h-3 w-3 text-gray-400 flex-shrink-0"}),(0,t.jsxs)("span",{children:["Loc: ",a.setterLocation.latitude.toFixed(2),", ",a.setterLocation.longitude.toFixed(2)," ",(0,t.jsx)("a",{href:"https://www.google.com/maps?q=".concat(a.setterLocation.latitude,",").concat(a.setterLocation.longitude),target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline","aria-label":"View location on map",children:"(Map)"})]})]}),a.photoUrls&&a.photoUrls.length>0&&(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground text-xs mt-1",children:[(0,t.jsx)(N.A,{className:"mr-2 h-3 w-3 text-gray-400 flex-shrink-0"}),(0,t.jsxs)("button",{onClick:()=>{var e;console.log("\uD83D\uDD25 LeadCard - Photo gallery clicked:",{leadId:a.id,customerName:a.customerName,photoCount:(null==(e=a.photoUrls)?void 0:e.length)||0,userRole:null==i?void 0:i.role}),m(!0)},className:"text-primary hover:underline cursor-pointer",children:[a.photoUrls.length," photo(s) attached - Click to view"]})]})]}),u&&(0,t.jsx)(r.wL,{className:"pt-0 pb-3 px-4",children:(0,t.jsx)(l.$,{onClick:()=>{console.log("\uD83D\uDD25 LeadCard - Disposition modal trigger clicked:",{leadId:a.id,customerName:a.customerName,context:s,userRole:null==i?void 0:i.role}),o(!0)},size:"sm",variant:"secondary",className:"w-full dark:card-glass dark:glow-cyan dark:hover:glow-turquoise transition-all duration-300",children:(0,t.jsx)(h.A,{className:"h-4 w-4"})})})]}),u&&(0,t.jsx)(q,{lead:a,isOpen:d,onClose:()=>o(!1)}),a.photoUrls&&a.photoUrls.length>0&&(0,t.jsx)(B,{photoUrls:a.photoUrls,customerName:a.customerName,isOpen:c,onClose:()=>m(!1)})]})}},26126:(e,a,s)=>{s.d(a,{E:()=>i});var t=s(95155);s(12115);var r=s(74466),l=s(59434);let n=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:a,variant:s,...r}=e;return(0,t.jsx)("div",{className:(0,l.cn)(n({variant:s}),a),...r})}},30356:(e,a,s)=>{s.d(a,{C:()=>o,z:()=>d});var t=s(95155),r=s(12115),l=s(54059),n=s(70154),i=s(59434);let d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.bL,{className:(0,i.cn)("grid gap-2",s),...r,ref:a})});d.displayName=l.bL.displayName;let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.q7,{ref:a,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...r,children:(0,t.jsx)(l.C1,{className:"flex items-center justify-center",children:(0,t.jsx)(n.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});o.displayName=l.q7.displayName},54165:(e,a,s)=>{s.d(a,{Cf:()=>x,Es:()=>f,HM:()=>m,L3:()=>p,c7:()=>h,lG:()=>d,rr:()=>g,zM:()=>o});var t=s(95155),r=s(12115),l=s(15452),n=s(25318),i=s(59434);let d=l.bL,o=l.l9,c=l.ZL,m=l.bm,u=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.hJ,{ref:a,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});u.displayName=l.hJ.displayName;let x=r.forwardRef((e,a)=>{let{className:s,children:r,...d}=e;return(0,t.jsxs)(c,{children:[(0,t.jsx)(u,{}),(0,t.jsxs)(l.UC,{ref:a,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:card-glass dark:glow-turquoise",s),...d,children:[r,(0,t.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(n.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=l.UC.displayName;let h=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...s})};h.displayName="DialogHeader";let f=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};f.displayName="DialogFooter";let p=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.hE,{ref:a,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});p.displayName=l.hE.displayName;let g=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.VY,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});g.displayName=l.VY.displayName},66424:(e,a,s)=>{s.d(a,{F:()=>i});var t=s(95155),r=s(12115),l=s(47655),n=s(59434);let i=r.forwardRef((e,a)=>{let{className:s,children:r,...i}=e;return(0,t.jsxs)(l.bL,{ref:a,className:(0,n.cn)("relative overflow-hidden",s),...i,children:[(0,t.jsx)(l.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,t.jsx)(d,{}),(0,t.jsx)(l.OK,{})]})});i.displayName=l.bL.displayName;let d=r.forwardRef((e,a)=>{let{className:s,orientation:r="vertical",...i}=e;return(0,t.jsx)(l.VM,{ref:a,orientation:r,className:(0,n.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...i,children:(0,t.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=l.VM.displayName},76430:(e,a,s)=>{s.d(a,{A:()=>p});var t=s(95155),r=s(12115),l=s(35317),n=s(56104),i=s(76981),d=s(10518),o=s(59434);let c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(i.bL,{ref:a,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,t.jsx)(i.C1,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(d.A,{className:"h-4 w-4"})})})});c.displayName=i.bL.displayName;var m=s(85057),u=s(50172),x=s(8376),h=s(24371),f=s(91689);function p(e){let{leadId:a,disabled:s=!1,className:i=""}=e,[d,o]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!0),[v,b]=(0,r.useState)(!1),{toast:N}=(0,f.dj)();(0,r.useEffect)(()=>{(async()=>{try{let e=(0,l.doc)(n.db,"leads",a),s=await (0,l.getDoc)(e);if(s.exists()){let e=s.data();o(e.isVerified||e.setterVerified||!1)}g(!1)}catch(e){console.error("Error fetching verification status:",e),N({title:"Error",description:"Failed to load verification status",variant:"destructive"}),g(!1)}})()},[a,N]);let j=async e=>{if(!s)try{b(!0),o(e),await (0,l.updateDoc)((0,l.doc)(n.db,"leads",a),{isVerified:e,setterVerified:e,verifiedAt:e?new Date:null,updatedAt:new Date}),N({title:e?"Lead Verified":"Lead Unverified",description:e?"Lead is now verified and can be assigned to closers":"Lead verification removed",variant:e?"default":"destructive"})}catch(a){console.error("Error updating verification status:",a),o(!e),N({title:"Update Failed",description:"Failed to update verification status. Please try again.",variant:"destructive"})}finally{b(!1)}};return p?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(u.A,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading..."})]}):(0,t.jsxs)("div",{className:"flex items-center space-x-2 ".concat(i),children:[(0,t.jsx)(c,{id:"verified-".concat(a),checked:d,onCheckedChange:j,disabled:s||v,className:"data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),(0,t.jsxs)(m.J,{htmlFor:"verified-".concat(a),className:"cursor-pointer text-sm flex items-center gap-1 ".concat(s?"opacity-50 cursor-not-allowed":""),children:[v?(0,t.jsx)(u.A,{className:"h-3 w-3 animate-spin"}):d?(0,t.jsx)(x.A,{className:"h-3 w-3 text-green-600"}):(0,t.jsx)(h.A,{className:"h-3 w-3 text-red-500"}),(0,t.jsx)("span",{className:d?"text-green-600 font-medium":"text-red-500",children:d?"Verified":"Not Verified"})]})]})}},85057:(e,a,s)=>{s.d(a,{J:()=>o});var t=s(95155),r=s(12115),l=s(40968),n=s(74466),i=s(59434);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.b,{ref:a,className:(0,i.cn)(d(),s),...r})});o.displayName=l.b.displayName},85511:(e,a,s)=>{s.d(a,{V:()=>o});var t=s(95155);s(12115);var r=s(965),l=s(73158),n=s(25358),i=s(59434),d=s(30285);function o(e){let{className:a,classNames:s,showOutsideDays:o=!0,...c}=e;return(0,t.jsx)(n.hv,{showOutsideDays:o,className:(0,i.cn)("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:a,...s}=e;return(0,t.jsx)(r.A,{className:(0,i.cn)("h-4 w-4",a),...s})},IconRight:e=>{let{className:a,...s}=e;return(0,t.jsx)(l.A,{className:(0,i.cn)("h-4 w-4",a),...s})}},...c})}o.displayName="Calendar"},88539:(e,a,s)=>{s.d(a,{T:()=>n});var t=s(95155),r=s(12115),l=s(59434);let n=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...r})});n.displayName="Textarea"}}]);